var GameConst=function(){function e(){}var t=(__define,e);return p=t.prototype,e}();egret.registerClass(GameConst,"GameConst");var Example=function(e){function t(){e.call(this),this.createWorld(),this.createGround(),this.createFlyRect(),this.world.on("beginContact",this.onBeginContact,this),this.world.on("endContact",this.onEndContact,this),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.addOne,this)}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onBeginContact=function(e){var t=e.bodyA,i=e.bodyB;t.displays[0].alpha=.5,i.displays[0].alpha=.5},p.onEndContact=function(e){var t=e.bodyA,i=e.bodyB;t.displays[0].alpha=1,i.displays[0].alpha=1},p.onEnterFrame=function(){this.world.step(.06);for(var e=this.world.bodies.length,t=0;e>t;t++){var i=this.world.bodies[t],a=i.displays[0];a.x=i.position[0],a.y=i.position[1],a.rotation=180*i.angle/Math.PI}},p.addOne=function(e){var t=new p2.Rectangle(50,50),i=new p2.Body({mass:10,position:[e.stageX,e.stageY]});i.addShape(t),this.world.addBody(i);var a=this.createRect(50,50);a.x=e.stageX,a.y=e.stageY,this.addChild(a),i.displays=[a]},p.createWorld=function(){this.world=new p2.World,this.world.sleepMode=p2.World.BODY_SLEEPING,this.world.gravity=[0,10]},p.createGround=function(){var e=new p2.Plane,t=new p2.Body;t.position[1]=GameConst.stage.stageHeight-100,t.angle=Math.PI,t.addShape(e),this.world.addBody(t);var i=this.createRect(500,100);t.displays=[i],this.addChild(i)},p.createFlyRect=function(){var e=new p2.Rectangle(50,50),t=new p2.Body({mass:1,position:[100,100],angularVelocity:1,force:[100,-10]});t.addShape(e),this.world.addBody(t);var i=this.createRect(50,50);i.x=100,i.y=100,this.addChild(i),t.displays=[i]},p.createRect=function(e,t){var i=new egret.Sprite;return i.graphics.beginFill(16711680),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i},t}(egret.Sprite);egret.registerClass(Example,"Example");var Example1=function(e){function t(){e.call(this),this.isDebug=!1,this.createGameScene()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.createGameScene=function(){function e(e){var a,n=Math.floor(e.stageX/t),s=Math.floor((egret.MainContext.instance.stage.stageHeight-e.stageY)/t);if(Math.random()>.5){var r=new p2.Rectangle(2,1),d=new p2.Body({mass:1,position:[n,s],angularVelocity:1});d.addShape(r),i.addBody(d),a=o.isDebug?o.createBox(r.width*t,r.height*t):o.createBitmapByName("rect_jpg"),a.width=r.width*t,a.height=r.height*t}else{var r=new p2.Circle(1),d=new p2.Body({mass:1,position:[n,s]});d.addShape(r),i.addBody(d),a=o.isDebug?o.createBall(r.radius*t):o.createBitmapByName("circle_jpg"),a.width=2*r.radius*t,a.height=2*r.radius*t}a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,d.displays=[a],o.addChild(a)}var t=50,i=new p2.World;i.sleepMode=p2.World.BODY_SLEEPING;var a=new p2.Plane,n=new p2.Body;n.addShape(a),n.displays=[],i.addBody(n),egret.Ticker.getInstance().register(function(e){if(!(10>e||e>1e3)){i.step(e/1e3);for(var a=egret.MainContext.instance.stage.stageHeight,n=i.bodies.length,o=0;n>o;o++){var s=i.bodies[o],r=s.displays[0];r&&(r.x=s.position[0]*t,r.y=a-s.position[1]*t,r.rotation=360-180*(s.angle+s.shapeAngles[0])/Math.PI,r.alpha=s.sleepState==p2.Body.SLEEPING?.5:1)}}},this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e,this);var o=this},p.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},p.createBall=function(e){var t=new egret.Shape;return t.graphics.beginFill(16773120),t.graphics.drawCircle(e,e,e),t.graphics.endFill(),t},p.createBox=function(e,t){var i=new egret.Shape;return i.graphics.beginFill(16773120),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i},t}(egret.Sprite);egret.registerClass(Example1,"Example1");var Example2=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.addOneBox,this),this.createWorld(),this.createGround(),this.createBodies(),this.createDebug()},p.createWorld=function(){var e=new p2.World;e.sleepMode=p2.World.BODY_SLEEPING,e.gravity=[0,10],this.world=e},p.createGround=function(){var e=egret.MainContext.instance.stage.stageHeight,t=new p2.Plane,i=new p2.Body;i.position[1]=e-100,i.angle=Math.PI,i.addShape(t),this.world.addBody(i)},p.createBodies=function(){var e=new p2.Rectangle(100,50),t=new p2.Body({mass:1,position:[200,200]});t.addShape(e),this.world.addBody(t);var e=new p2.Rectangle(50,50),t=new p2.Body({mass:1,position:[200,180],angularVelocity:1});t.addShape(e),this.world.addBody(t)},p.loop=function(){this.world.step(.06),this.debugDraw.drawDebug()},p.addOneBox=function(e){var t=Math.floor(e.stageX),i=Math.floor(e.stageY);if(Math.random()>.5){var a=new p2.Rectangle(150*Math.random()+50,100),n=new p2.Body({mass:1,position:[t,i],angularVelocity:1});n.addShape(a),this.world.addBody(n)}else{var a=new p2.Circle(50),n=new p2.Body({mass:1,position:[t,i]});n.addShape(a),this.world.addBody(n)}},p.createDebug=function(){this.debugDraw=new p2DebugDraw(this.world);var e=new egret.Sprite;this.addChild(e),this.debugDraw.setSprite(e)},t}(egret.Sprite);egret.registerClass(Example2,"Example2");var p2DebugDraw=function(){function e(e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=8355813,this.COLOR_S=8381823,this.world=e}var t=(__define,e);return p=t.prototype,p.setSprite=function(e){this.sprite=e},p.drawDebug=function(){this.sprite.graphics.clear();for(var e=this.world.bodies.length,t=0;e>t;t++)for(var i=this.world.bodies[t],a=0;a<i.shapes.length;a++){var n=i.shapes[a];n instanceof p2.Convex?this.drawConvex(n,i):n instanceof p2.Plane?this.drawPlane(n,i):n instanceof p2.Circle&&this.drawCircle(n,i)}},p.drawConvex=function(e,t){var i=this.getColor(t),a=e.vertices.length,n=this.sprite.graphics;n.lineStyle(1,i),n.beginFill(i,.5);var o=new Array;t.toWorldFrame(o,e.vertices[0]),n.moveTo(t.position[0],t.position[1]),n.lineTo(o[0],o[1]);for(var s=1;a>=s;s++)t.toWorldFrame(o,e.vertices[s%a]),n.lineTo(o[0],o[1]);n.endFill()},p.drawCircle=function(e,t){var i=this.getColor(t),a=this.sprite.graphics;a.lineStyle(1,i),a.beginFill(i,.5),a.drawCircle(t.position[0],t.position[1],e.radius);var n=new Array;t.toWorldFrame(n,[e.radius,0]),a.moveTo(t.position[0],t.position[1]),a.lineTo(n[0],n[1]),a.endFill()},p.drawPlane=function(e,t){var i=this.COLOR_D_SLEEP,a=this.sprite.graphics;a.lineStyle(1,i),a.beginFill(i,1);var n=new Array,o=new Array;t.toWorldFrame(n,[-1e3,0]),a.moveTo(n[0],n[1]),t.toWorldFrame(o,[1e3,0]),a.lineTo(o[0],o[1]),t.toWorldFrame(o,[1e3,-1e3]),a.lineTo(o[0],o[1]),t.toWorldFrame(o,[-1e3,-1e3]),a.lineTo(o[0],o[1]),t.toWorldFrame(o,[-1e3,-0]),a.lineTo(o[0],o[1]),a.endFill()},p.getColor=function(e){var t=this.COLOR_D_SLEEP;return e.type==p2.Body.KINEMATIC?t=this.COLOR_K:e.type==p2.Body.STATIC?t=this.COLOR_S:e.sleepState==p2.Body.AWAKE&&(t=this.COLOR_D_WAKE),t},e}();egret.registerClass(p2DebugDraw,"p2DebugDraw");var Example3=function(e){function t(){e.call(this),this.gX=50,this.gY=50,this.isDebug=!1,this.isMobile=egret.Capabilities.isMobile;var t=new egret.Bitmap(RES.getRes("bg_png"));if(this.addChild(t),this.textField=new egret.TextField,this.textField.text="点击屏幕生成一个冰块",this.addChild(this.textField),this.createWorld(),this.createGround(),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.addOneBox,this),this.isMobile){var i=new egret.DeviceOrientation;i.addEventListener(egret.Event.CHANGE,this.onOrientation,this),i.start()}}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onOrientation=function(e){this.isMobile&&(this.world.gravity=[e.gamma/90*this.gX,e.beta/90*this.gY])},p.onEnterFrame=function(){this.world.step(.1);for(var e=this.world.bodies.length,t=0;e>t;t++){var i=this.world.bodies[t];if(i.displays){var a=i.displays[0];a.x=i.position[0],a.y=i.position[1],a.rotation=180*i.angle/Math.PI}}},p.addOneBox=function(e){var t=Math.floor(7*Math.random()),i=new egret.Bitmap(RES.getRes("ice00"+t));i.x=e.stageX,i.y=e.stageY,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.cacheAsBitmap=!0,this.addChild(i);var a=this.getOneRectBody(i.width,i.height);a.position=[e.stageX,e.stageY],a.displays=[i]},p.createWorld=function(){this.world=new p2.World,this.world.gravity=[0,30]},p.createGround=function(){var e=this.getOneRectBody(GameConst.stage.stageWidth,1);e.type=p2.Body.KINEMATIC,e.position=[GameConst.stage.stageWidth/2,GameConst.stage.stageHeight];var t=this.getOneRectBody(GameConst.stage.stageWidth,1);t.type=p2.Body.KINEMATIC,t.position=[GameConst.stage.stageWidth/2,0];var i=this.getOneRectBody(1,GameConst.stage.stageHeight);i.type=p2.Body.KINEMATIC,i.position=[0,GameConst.stage.stageHeight/2];var a=this.getOneRectBody(1,GameConst.stage.stageHeight);a.type=p2.Body.KINEMATIC,a.position=[GameConst.stage.stageWidth,GameConst.stage.stageHeight/2]},p.getOneRectBody=function(e,t){var i=new p2.Rectangle(e,t),a=new p2.Body({mass:100});return a.addShape(i),this.world.addBody(a),a},p.getOnePlaneBody=function(){var e=new p2.Plane,t=new p2.Body;return t.addShape(e),this.world.addBody(t),t},p.getOneRectSkin=function(e,t,i){void 0===i&&(i=16711680);var a=new egret.Sprite;return a.graphics.beginFill(i),a.graphics.drawRect(0,0,e,t),a.graphics.endFill(),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a},t}(egret.Sprite);egret.registerClass(Example3,"Example3");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t);return p=i.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t);return p=i.prototype,p.onAddToStage=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},p.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},p.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.createGameScene())},p.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},p.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},p.createGameScene=function(){GameConst.stage=this.stage;var e=new Example3;this.addChild(e)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");