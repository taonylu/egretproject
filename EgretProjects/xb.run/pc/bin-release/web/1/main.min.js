var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var n=RES.getRes(e);n?s(n):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e.debug=!1,e}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function e(){this.homeScene=new HomeScene,this.gameScene=new GameScene,this.lockScene=new LockScene,this.resultScene=new ResultScene}var t=(__define,e),i=t.prototype;return i.startup=function(e){GameConst.stage=e.stage,GameConst.gameCofig=window.gameConfig,GameConst.debug=GameConst.gameCofig.debug,console.log("调试模式:",GameConst.debug),console.log("主页倒计时:",GameConst.gameCofig.homeTime),console.log("校准倒计时:",GameConst.gameCofig.lockTime),console.log("游戏计时:",GameConst.gameCofig.gameTime),console.log("结果倒计时:",GameConst.gameCofig.resultTime),LayerManager.getInstance().initialize(e),LayerManager.getInstance().runScene(this.homeScene);var t=ClientSocket.getInstance();t.gameManager=this,t.homeScene=this.homeScene,t.gameScene=this.gameScene,t.lockScene=this.lockScene,t.startConnect()},i.connect=function(){this.homeScene.sendLogin()},i.disconnect=function(){},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var ClientSocket=function(){function e(){}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.isConnected=function(){return this.socket&&this.socket.connected?!0:!1},i.closeSocket=function(){egret.log("主动断开连接"),this.socket.disconnect()},i.startConnect=function(){this.socket=io.connect(GameConst.gameCofig.server,{reconnection:!1,"force new connection":!0}),console.log("connect:",GameConst.gameCofig.server);var e=this;this.socket.on("connect",function(){egret.log("connenct succss"),e.gameManager.connect()}),this.socket.on("error",function(e){egret.log("connenct erro")}),this.socket.on("disconnect",function(){egret.log("connenct close"),e.gameManager.disconnect()}),this.socket.on("reconnect_attempt",function(){egret.log("reconnect")}),this.socket.on("connect_timeout",function(){}),this.socket.on("userJoin",function(t){e.homeScene.revUserJoin(t)}),this.socket.on("lock",function(t){e.lockScene.revLock(t)}),this.socket.on("action",function(t){e.gameScene.revAction(t)}),this.socket.on("userQuit",function(t){e.homeScene.revUserQuit(t)})},i.sendMessage=function(e,t,i,s){void 0===t&&(t=null),void 0===i&&(i=null),void 0===s&&(s=null),this.socket&&this.socket.connected&&this.socket.emit(e,t,function(e){i&&s&&i.call(s,e)})},e}();egret.registerClass(ClientSocket,"ClientSocket");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),i=t.prototype;return i.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.popLayer.touchThrough=!0,this.main.addChild(this.popLayer)},i.runScene=function(e,t){void 0===t&&(t=!1),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.curScene=e,this.sceneLayer.addChild(e),e.inited&&e.onEnable()},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.loadGroup=function(e,t,i,s,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),this.loadComplete[e]=i,this.loadError[e]=n,this.loadProgress[e]=s,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},i.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var i=this.loadComplete[t];null!=i&&i.call(this.thisObject[t],e),this.clearCallBack(t)},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},i.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},i.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var SoundManager=function(){function e(){this.die0="die0_mp3",this.die1="die1_mp3",this.die2="die2_mp3",this.bgm_home="bgm_home_mp3",this.bgm_game="bgm_game_mp3",this.gameover="gameover_mp3",this.coin="coin_mp3",this.countDown1="1_mp3",this.countDown2="2_mp3",this.countDown3="3_mp3",this.jump0="jump0_mp3",this.jump1="jump1_mp3",this.jump2="jump2_mp3",this.jump3="jump3_mp3",this.jump4="jump4_mp3",this.jumpList=[],this.soundList={},this.channelList={},this.addSound(this.bgm_home),this.addSound(this.bgm_game),this.addSound(this.gameover),this.addSound(this.die0),this.addSound(this.die1),this.addSound(this.die2),this.addSound(this.countDown1),this.addSound(this.countDown2),this.addSound(this.countDown3),this.addSound(this.coin),this.addSound(this.jump0),this.addSound(this.jump1),this.addSound(this.jump2),this.addSound(this.jump3),this.addSound(this.jump4),this.jumpList.push(this.jump0,this.jump1,this.jump2,this.jump3,this.jump4)}var t=(__define,e),i=t.prototype;return i.addSound=function(e){this.soundList[e]=RES.getRes(e)},i.play=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=1);var s=this.soundList[e];s&&(this.channelList[e]=s.play(0,i),this.channelList[e].volume=t)},i.playDie=function(){var e=Math.random();.5>e?this.play(this.die0):this.play(this.die1)},i.playJump=function(){this.play(this.jumpList[NumberTool.getRandomInt(0,this.jumpList.length-1)])},i.playCountDown=function(e){3==e?this.play(this.countDown3):2==e?this.play(this.countDown2):1==e&&this.play(this.countDown1)},i.stop=function(e){var t=this.channelList[e];t&&t.stop()},i.playBgm=function(e,t){void 0===t&&(t=1),this.bgmChannel&&this.bgmChannel.stop();var i=this.soundList[e];i&&(this.bgmChannel=i.play(),this.bgmChannel.volume=t)},i.stopBgm=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(SoundManager,"SoundManager");var UserManager=function(){function e(){this.userList=new Array,this.userLimit=3}var t=(__define,e),i=t.prototype;return i.addUser=function(e){return this.userList.length<this.userLimit&&0==this.isExsit(e.openid)?(this.userList.push(e),!0):!1},i.deleteUser=function(e){for(var t=this.userList.length,i=0;t>i;i++)this.userList[i].openid==e&&this.userList.splice(i,1)},i.getUser=function(e){for(var t=this.userList.length,i=0;t>i;i++)if(this.userList[i].openid==e)return this.userList[i];return null},i.isExsit=function(e){for(var t=this.userList.length,i=0;t>i;i++)if(this.userList[i].openid==e)return!0;return!1},i.isOverUserLimit=function(){return this.userList.length>this.userLimit?!0:!1},i.getUserNum=function(){return this.userList.length},i.clearAllUser=function(){this.userList.length=0},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(UserManager,"UserManager");var UserVO=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(UserVO,"UserVO");var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},s.onEnable=function(){},s.onRemove=function(){},s.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var ArrayTool=function(){function e(){}var t=(__define,e);t.prototype;return e.randomArr=function(e){for(var t,i,s,n=e.length;n;)i=n-1,s=Math.floor(Math.random()*n),n--,i!=s&&(t=e[i],e[i]=e[s],e[s]=t)},e.random2DArr=function(t){for(var i=[],s=t.length,n=t[0].length,r=0;s>r;r++)for(var o=0;n>o;o++)i.push(t[r][o]);e.randomArr(i);for(var r=0;s>r;r++)for(var o=0;n>o;o++)t[r][o]=i[r*n+o]},e.copy2DArr=function(e){for(var t=new Array,i=e.length,s=e[0].length,n=0;i>n;n++){var r=new Array;t.push(r);for(var o=0;s>o;o++)r.push(e[n][o])}return t},e.getObjectLen=function(e){var t=0;for(var i in e)t++;return t},e}();egret.registerClass(ArrayTool,"ArrayTool");var HttpUtil=function(){function e(){this.httpMethod=egret.HttpMethod.GET,this.request=new egret.HttpRequest,this.request.responseType=egret.HttpResponseType.TEXT,this.request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),this.request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this)}var t=(__define,e),i=t.prototype;return i.send=function(e,t,i){this.thisObject=i,this.request.open(e,this.httpMethod),this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),""!=t?this.request.send(t):this.request.send()},i.onPostComplete=function(e){this.completeHandler&&this.completeHandler.call(this.thisObject,this.request.response)},i.onPostIOError=function(e){egret.log("http error"),this.errorHandler&&this.errorHandler.call(this.thisObject,e)},e}();egret.registerClass(HttpUtil,"HttpUtil");var NumberTool=function(){function e(){}var t=(__define,e);t.prototype;return e.getRandomInt=function(e,t){return Math.round(Math.random()*(t-e))+e},e.getVerificationCode=function(t){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",s=i.length,n="",r=0;t>r;r++)n+=i.charAt(e.getRandomInt(0,s));return n},e}();egret.registerClass(NumberTool,"NumberTool");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),i=t.prototype;return i.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},i.returnObject=function(e){this.list.push(e)},e.getPool=function(t,i){if(void 0===i&&(i=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=i))for(var s=egret.getDefinitionByName(t),n=e.pool[t],r=0;i>r;r++)n.returnObject(new s);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var QRCodeLoader=function(e){function t(){e.apply(this,arguments),this.logoUrl=""}__extends(t,e);var i=(__define,t),s=i.prototype;return s.load=function(e,t,i,s){void 0===s&&(s=""),this.qrcodeWidth=t,this.qrcodeHeight=i,this.logoUrl=s;var n=new egret.ImageLoader;n.addEventListener(egret.Event.COMPLETE,this.onQRCodeComplete,this),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onQRCodeError,this),n.load(e)},s.onQRCodeError=function(){console.log("加载二维码错误")},s.onQRCodeComplete=function(e){var t=e.currentTarget,i=new egret.Bitmap(t.data);if(i.width=this.qrcodeWidth,i.height=this.qrcodeHeight,this.addChild(i),""!=this.logoUrl){var t=new egret.ImageLoader;t.addEventListener(egret.Event.COMPLETE,this.onlogoComplete,this),t.load(this.logoUrl)}},s.onlogoComplete=function(e){var t=e.currentTarget,i=new egret.Bitmap(t.data);i.width=this.qrcodeWidth/4,i.height=this.qrcodeHeight/4,i.x=(this.qrcodeWidth-i.width)/2,i.y=(this.qrcodeHeight-i.height)/2,this.addChild(i)},s.destroy=function(){for(var e=this.numChildren,t=e-1;t>=0;t--){var i=this.getChildAt(t);i.parent&&i.parent.removeChild(i)}},t}(egret.DisplayObjectContainer);egret.registerClass(QRCodeLoader,"QRCodeLoader");var ShakeTool=function(){function e(){this.count=0,this.timer=new egret.Timer(1e3)}var t=(__define,e),i=t.prototype;return i.shakeObj=function(e,t,i,s){this.target=e,this.initX=e.x,this.initY=e.y,this.maxDis=s,this.count=t*i,this.rate=i,this.timer.delay=1e3/i,this.timer.repeatCount=this.count,this.timer.addEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this),this.timer.reset(),this.timer.start()},i.shaking=function(){egret.Tween.removeTweens(this),this.target.x=this.initX-this.maxDis+Math.random()*this.maxDis*2,this.target.y=this.initY-this.maxDis+Math.random()*this.maxDis*2,egret.Tween.get(this.target).to({x:this.initX,y:this.initY},999/this.rate)},i.shakeComplete=function(){egret.Tween.removeTweens(this),this.target.x=this.initX,this.target.y=this.initY,this.timer.removeEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this)},e}();egret.registerClass(ShakeTool,"ShakeTool");var StringTool=function(){function e(){}var t=(__define,e);t.prototype;return e.getTimeString=function(e){var t="";return t=10>e?"0"+e:e.toString()},e}();egret.registerClass(StringTool,"StringTool");var SimpleMC=function(e){function t(t,i,s){var n=RES.getRes(t),r=RES.getRes(i),o=new egret.MovieClipDataFactory(r,n);e.call(this,o.generateMovieClipData(s))}__extends(t,e);var i=(__define,t);i.prototype;return t}(egret.MovieClip);egret.registerClass(SimpleMC,"SimpleMC");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin"),this.farPotList=new Array,this.nearPotList=new Array,this.trackXList=[],this.trackYList=[],this.roleList=new Array,this.playerLimit=3,this.playerList=new Array,this.trackDataList=new Array,this.curTimeCount=0,this.curTimeLimit=0,this.mapCreateTimeList=[30,20,15],this.mapFruitList=[],this.mapBarrList=[],this.mapMultiFruit=[],this.curLevel=1,this.moveSpeed=0,this.accList=[],this.moveAcc=0,this.gameHeadList=new Array,this.gameHeadPosList=[],this.carrotPool=ObjectPool.getPool(Carrot.NAME,1),this.bananaPool=ObjectPool.getPool(Banana.NAME,1),this.stonePool=ObjectPool.getPool(Stone.NAME,1),this.micePool=ObjectPool.getPool(Mice.NAME,1),this.highWoodPool=ObjectPool.getPool(HighWood.NAME,1),this.lowWoodPool=ObjectPool.getPool(LowWood.NAME,1),this.waterPool=ObjectPool.getPool(Water.NAME,1),this.scorePoolList=[this.carrotPool,this.bananaPool],this.numPoolList=ObjectPool.getPool(ScoreUI.NAME,2),this.zhangAiPoolList=[this.stonePool,this.micePool,this.highWoodPool,this.lowWoodPool,this.waterPool],this.itemList=[],this.isSingleMode=!0,this.singleTrackNum=3,this.multiTrackNum=7,this.grassFarList=new Array,this.grassNearList=new Array,this.grassPool=ObjectPool.getPool(Grass.NAME),this.grassList=new Array,this.gameTimer=new egret.Timer(1e3),this.gameTimeLimit=60,this.countDownTimer=new egret.Timer(1e3),this.countDownLimit=1,this.snd=SoundManager.getInstance(),this.status_free=0,this.status_gameing=1,this.status_gameover=2,this.grassCount=0,this.resultData={scoreList:[],rankList:[],gameRankList:[]}}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.initView()},s.onEnable=function(){window.changeBgColor("#0cb859"),this.gameStatus=this.status_free,this.resetGame(),this.startCountDown(),this.snd.playBgm(this.snd.bgm_game)},s.onRemove=function(){},s.startGame=function(){this.configListeners(),this.startGameTimer(),this.runAllPlayer(),this.startBgAnim(),this.startProgressAnim(),this.gameStatus=this.status_gameing},s.resetGame=function(){this.clearPlayerList(),this.initMap(),this.initFarAndNear(),this.initGrassPot(),this.resetAllPlayer(),this.clearItem(),this.clearGrass(),this.resetProgressBar(),this.resetGameHead()},s.gameOver=function(){this.stopGameTimer(),this.deConfigListeners(),this.stopAllPlayer(),this.stopBgAnim(),this.stopProgressAnim(),this.sendGameOver(),this.gameStatus=this.status_gameover},s.initView=function(){this.socket=ClientSocket.getInstance(),this.stageWidth=GameConst.stage.stageWidth,this.stageHeight=GameConst.stage.stageHeight,this.mapCreateTimeList=GameConst.gameCofig.mapCreateTimeList,this.mapFruitList=GameConst.gameCofig.mapFruitList,this.mapBarrList=GameConst.gameCofig.mapBarrList,this.mapMultiFruit=GameConst.gameCofig.mapMultiFruit,this.accList=GameConst.gameCofig.accList,this.gameTimeLimit=GameConst.gameCofig.gameTime,this.moveSpeed=GameConst.gameCofig.moveSpeed,this.gameOverLabel.visible=!1,this.initRole(),this.initGameHead(),this.initTrackData()},s.configListeners=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},s.deConfigListeners=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},s.onEnterFrame=function(){this.createItem(),this.moveItem(),this.createGrass(),this.moveGrass()},s.initRole=function(){for(var e=0;e<this.playerLimit;e++){var t=new Player("player"+e+"_png","player"+e+"_json","player"+e);this.roleList.push(t),t.offerX=-90,t.offerY=-250}},s.initMap=function(){var e=UserManager.getInstance().getUserNum();1>=e?(this.isSingleMode=!0,this.bg0Group.visible=!0,this.bg1Group.visible=!1):(this.isSingleMode=!1,this.bg0Group.visible=!1,this.bg1Group.visible=!0),this.trackNum=this.isSingleMode?this.singleTrackNum:this.multiTrackNum,this.curTimeCount=0,this.curTimeLimit=this.mapCreateTimeList[0],this.curLevel=0,this.moveAcc=this.accList[0];for(var t=0;t<this.multiTrackNum;t++)this.trackDataList[t].clear()},s.initFarAndNear=function(){this.farPotList.length=0,this.nearPotList.length=0,this.trackXList.length=0;for(var e,t,i=this.trackNum,s=0;i>s;s++){this.isSingleMode?(e=this["singleFar"+s],t=this["singleNear"+s]):(e=this["far0"+s],t=this["near0"+s]);var n=new egret.Point(e.x,e.y),r=new egret.Point(t.x,t.y);this.farPotList.push(n),this.nearPotList.push(r),e.parent&&e.parent.removeChild(e),t.parent&&t.parent.removeChild(t);var o=egret.Point.distance(n,r),a=Math.pow(o,2),h=Math.pow(n.y-t.y,2),c=Math.sqrt(a-h);i/2>s&&(c=-c),this.trackXList.push(c),this.trackYList.push(t.y-n.y)}},s.initGrassPot=function(){this.grassFarList.length=0,this.grassNearList.length=0;var e,t;if(this.trackNum==this.singleTrackNum)for(var i=0;2>i;i++)e=this["grassFarPot"+i],t=this["grassNearPot"+i],this.grassFarList.push(e),this.grassNearList.push(t),e.parent&&e.parent.removeChild(e),t.parent&&t.parent.removeChild(t);else for(var i=2;4>i;i++)e=this["grassFarPot"+i],t=this["grassNearPot"+i],this.grassFarList.push(e),this.grassNearList.push(t),e.parent&&e.parent.removeChild(e),t.parent&&t.parent.removeChild(t)},s.initGameHead=function(){for(var e=0;e<this.playerLimit;e++){var t=this["gameHead"+e];this.gameHeadList.push(t),t.bg.texture=RES.getRes("scoreBg"+e+"_png"),this.gameHeadPosList.push(t.y)}},s.initTrackData=function(){for(var e=0;e<this.multiTrackNum;e++)this.trackDataList.push(new TrackData)},s.resetGameHead=function(){for(var e=this.gameHeadList.length,t=0;e>t;t++){var i=this.gameHeadList[t];i.clear(),i.hide()}e=this.playerList.length;for(var t=0;e>t;t++){var s=this.playerList[t],i=this.gameHeadList[s.roleID];s.gameHead=i;var n=UserManager.getInstance().getUser(s.openid);i.loadImg(n.headUrl),i.setNameLabel(n.nickName),i.openid=n.openid,i.y=this.gameHeadPosList[t],this.scoreGroup.addChild(i)}},s.clearPlayerList=function(){this.playerList.length=0},s.resetAllPlayer=function(){for(var e=this.roleList.length,t=0;e>t;t++){var i=this.roleList[t];i.hide()}for(var s=UserManager.getInstance().userList,n=s.length,t=0;n>t;t++){var r=s[t],o=this.roleList[r.role];o.roleID=r.role,o.openid=r.openid,this.playerList.push(o)}for(var t=0;n>t;t++){var o=this.playerList[t];0==t?o.track=Math.floor(this.trackNum/2):1==t?o.track=Math.floor(this.trackNum/2)-2:2==t&&(o.track=Math.floor(this.trackNum/2)+2),this.trackNum==this.singleTrackNum?(o.scaleX=1.2,o.scaleY=1.2,o.offerX=-108,o.offerY=-306):(o.scaleX=1,o.scaleY=1,o.offerX=-90,o.offerY=-250),o.x=this.nearPotList[o.track].x,o.y=this.nearPotList[o.track].y,o.shadow.x=o.x,o.shadow.y=o.y,o.modifyPos(),o.initY=o.y,o.clearStatus(),o.score=0,o.gameHead=null,o.stand(),this.playerGroup.addChild(o.shadow),this.playerGroup.addChild(o)}},s.getPlayerByOpenid=function(e){for(var t=this.playerList.length,i=0;t>i;i++){var s=this.playerList[i];if(s.openid==e)return s}return null},s.resetPlayer=function(e){e.track=Math.floor(this.trackNum/2);for(var t=0;t<this.playerList.length;t++)e.openid!=this.playerList[t].openid&&e.track==this.playerList[t].track&&(e.track=(e.track+1)%this.trackNum,t=-1);e.x=this.nearPotList[e.track].x,e.y=this.nearPotList[e.track].y,e.shadow.x=e.x,e.shadow.y=e.y,e.modifyPos(),e.run(),e.clearStatus()},s.stopAllPlayer=function(){for(var e=this.playerList.length,t=0;e>t;t++){var i=this.playerList[t];i.stand()}},s.runAllPlayer=function(){for(var e=this.playerList.length,t=0;e>t;t++){var i=this.playerList[t];i.run()}},s.startBgAnim=function(){var e=1e3*this.gameTimeLimit;this.sky.y=0,egret.Tween.get(this.sky).to({y:this.sky.y-70},e),this.treeLeftGroup.x=0,this.treeLeftGroup.y=0,this.treeRightGroup.x=0,this.treeRightGroup.y=0,egret.Tween.get(this.treeLeftGroup).to({x:-100,y:-10},e),egret.Tween.get(this.treeRightGroup).to({x:100,y:-10},e)},s.stopBgAnim=function(){egret.Tween.removeTweens(this.sky),egret.Tween.removeTweens(this.treeLeftGroup),egret.Tween.removeTweens(this.treeRightGroup)},s.startProgressAnim=function(){this.progressBar.scaleX=0,egret.Tween.get(this.progressBar).to({scaleX:1},1e3*this.gameTimeLimit),this.progressSlider.x=this.progressBar.x,this.progressSlider.scaleX=1,this.progressSlider.scaleY=1,egret.Tween.get(this.progressSlider).to({x:this.progressBar.x+this.progressBar.width},1e3*this.gameTimeLimit),egret.Tween.get(this.progressSlider,{loop:!0}).to({scaleX:1.2,scaleY:1.2},300).to({scaleX:1,scaleY:1},300)},s.stopProgressAnim=function(){egret.Tween.removeTweens(this.progressBar),egret.Tween.removeTweens(this.progressSlider)},s.createItem=function(){this.curTimeCount++;var e,t;if(this.curTimeCount%this.curTimeLimit==0)for(var i=0;i<this.trackNum;i++){e=100*Math.random();var s=this.trackDataList[i];1==s.lastItemType&&s.fruitNum<s.shouldCreate?(t=this.getFruit(s.fruitType),s.fruitNum++):2==s.lastItemType?e<this.mapFruitList[this.curLevel]?(s.fruitType=NumberTool.getRandomInt(0,1),s.lastItemType=1,s.shouldCreate=NumberTool.getRandomInt(this.mapMultiFruit[0],this.mapMultiFruit[1]),s.fruitNum=0,t=this.getFruit(s.fruitType)):(t=null,s.lastItemType=0):1==s.lastItemType?e<this.mapBarrList[this.curLevel]?(t=this.getRandomBarrior(),s.lastItemType=2):(t=null,s.lastItemType=0):e<this.mapFruitList[this.curLevel]?(s.lastItemType=1,s.fruitType=NumberTool.getRandomInt(0,1),s.shouldCreate=NumberTool.getRandomInt(this.mapMultiFruit[0],this.mapMultiFruit[1]),s.fruitNum=0,t=this.getFruit(s.fruitType)):e<this.mapFruitList[this.curLevel]+this.mapBarrList[this.curLevel]?(t=this.getRandomBarrior(),s.lastItemType=2):(t=null,s.lastItemType=0),null!=t&&(t.x=this.farPotList[i].x,t.y=this.farPotList[i].y,t.track=i,t.scaleX=.05,t.scaleY=.05,t.moveSpeedY=this.moveSpeed,this.itemGroup.addChild(t),this.itemList.push(t),this.itemGroup.setChildIndex(t,1))}},s.getRandomFruit=function(){return this.scorePoolList[NumberTool.getRandomInt(0,1)].getObject()},s.getFruit=function(e){return this.scorePoolList[e].getObject()},s.getRandomBarrior=function(){return this.zhangAiPoolList[NumberTool.getRandomInt(0,4)].getObject()},s.moveItem=function(){for(var e,t,i=this.itemList.length,s=i-1;s>=0;s--){e=this.itemList[s],t=e.track,e.moveSpeedY+=this.moveAcc,e.y+=e.moveSpeedY+e.moveSpeedY*e.scaleX;var n=(e.y-this.farPotList[t].y)/this.trackYList[t];if(e.x=this.farPotList[t].x+n*this.trackXList[t],this.trackNum==this.singleTrackNum)var r=.6*n;else var r=.5*n;if(e.scaleX=.05+r,e.scaleY=.05+r,e.y>this.stageHeight+e.height)e.recycle(),this.itemList.splice(s,1);else for(var o=this.playerList.length,a=0;o>a;a++){var h=this.playerList[a];if(h.track==e.track&&0==h.isDie){var c=h.shadow.y-e.y;if(c>0&&c<e.height/2){if(0==e.type){if(h.isJumping&&e.y-h.y>h.height/2);else if(!h.isDie){this.itemList.splice(s,1),e.flyToHead(h.gameHead),h.score+=e.score,h.gameHead.setScoreLabel(h.score),this.snd.play(this.snd.coin);break}}else 1==e.type?h.isJumping&&e.y-h.y>h.height/2||(h.die(),this.snd.playDie()):2==e.type&&(h.die(),this.snd.playDie())}}}}},s.clearItem=function(){for(var e=this.itemList.length,t=0;e>t;t++){var i=this.itemList[t];i.recycle()}this.itemList.length=0},s.createGrass=function(){if(this.grassCount++,this.grassCount%80==0){if(this.grassList.length>=6)return;var e=(Math.random(),this.grassPool.getObject());e.randomSkin(),e.scaleX=.05,e.scaleY=.05,e.x=this.grassFarList[0].x,e.y=this.grassFarList[0].y,e.speedX=-1,e.speedY=this.moveSpeed,this.grassGroup.addChild(e),this.grassList.push(e),e=this.grassPool.getObject(),e.randomSkin(),e.x=this.grassFarList[1].x,e.y=this.grassFarList[1].y,e.speedX=1,e.speedY=this.moveSpeed,this.grassGroup.addChild(e),this.grassList.push(e)}},s.moveGrass=function(){for(var e,t=this.grassList.length,i=t-1;i>=0;i--){e=this.grassList[i];var s=(e.y-this.grassFarList[0].y)/(this.grassNearList[0].y-this.grassFarList[0].y);e.speedY+=this.moveAcc,e.y+=e.speedY,e.speedX>0?e.x=this.grassFarList[1].x-(this.grassFarList[1].x-this.grassNearList[1].x)*s:e.x=this.grassFarList[0].x-(this.grassFarList[0].x-this.grassNearList[0].x)*s,e.scaleX=.05+s,e.scaleY=.05+s,e.y>this.stageHeight&&(e.recycle(),this.grassList.splice(i,1))}},s.clearGrass=function(){for(var e,t=this.grassList.length,i=0;t>i;i++)e=this.grassList[i],e.recycle();this.grassList.length=0},s.resetProgressBar=function(){this.progressSlider.x=this.progressBar.x,this.progressBar.scaleX=0},s.startGameTimer=function(){this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this),this.gameTimer.reset(),this.gameTimer.start()},s.onGameTimerHandler=function(){var e=this.gameTimer.currentCount,t=Math.floor(e/(this.gameTimeLimit/this.mapCreateTimeList.length));t!=this.curLevel&&(this.curLevel=t>=this.mapCreateTimeList.length?this.mapCreateTimeList.length-1:t,this.curTimeCount=0,this.curTimeLimit=this.mapCreateTimeList[this.curLevel],this.moveAcc=this.accList[this.curLevel],console.log("当前关卡等级:",this.curLevel));var i=this.gameTimeLimit-e;3>=i&&(0==i?(this.gameOver(),this.gameOverLabel.visible=!1):(this.snd.playCountDown(i),this.setGameOverLabel(i)))},s.setGameOverLabel=function(e){this.gameOverLabel.visible=!0,this.gameOverLabel.scaleX=0,this.gameOverLabel.scaleY=0,this.gameOverLabel.text=e+"",egret.Tween.get(this.gameOverLabel).to({scaleX:2,scaleY:2},800,egret.Ease.elasticOut)},s.stopGameTimer=function(){this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this),this.gameTimer.stop()},s.startCountDown=function(){this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.reset(),this.countDownTimer.start()},s.onCountDownHandler=function(){var e=this.countDownLimit-this.countDownTimer.currentCount;0>=e&&(this.stopCountDown(),this.startGame())},s.stopCountDown=function(){this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.stop()},s.deleteUser=function(e){var t=UserManager.getInstance();0==t.getUserNum()&&this.gameOver()},s.revAction=function(e){if(this.gameStatus==this.status_gameing){var t=e.actionType,i=e.openid,s=this.getPlayerByOpenid(i);if(null==s)return void egret.log("行动的Player为null");if(!(s.isMoving||s.isDie||s.isJumping)){var n=s.track,r=n;if("left"==t){if(n>0){r-=1;for(var o=0;o<this.playerList.length;o++)s.openid!=this.playerList[o].openid&&r==this.playerList[o].track&&(r-=1,o=-1);if(0>r)return;s.isMoving=!0;var a=this.nearPotList[r].x-this.nearPotList[n].x;egret.Tween.get(s).to({x:s.x+a},300),egret.Tween.get(s.shadow).to({x:s.shadow.x+a},300).call(function(){s.isMoving=!1}),s.track=r}}else if("right"==t){if(n<this.trackNum-1){r+=1;for(var o=0;o<this.playerList.length;o++)s.openid!=this.playerList[o].openid&&r==this.playerList[o].track&&(r+=1,o=-1);if(r>this.trackNum-1)return;s.isMoving=!0;var a=this.nearPotList[r].x-this.nearPotList[n].x;egret.Tween.get(s).to({x:s.x+a},300),egret.Tween.get(s.shadow).to({x:s.shadow.x+a},300).call(function(){s.isMoving=!1}),s.track=r}}else"up"==t&&(s.jump(),this.snd.playJump())}}},s.sendGameOver=function(){console.log("sendGameOver");for(var e={scoreList:[]},t=this.playerList.length,i=0;t>i;i++){var s={openid:"",score:0};s.openid=this.playerList[i].openid,s.score=this.playerList[i].score,e.scoreList.push(s)}for(var i=0;t>i;i++)for(var n=i+1;t>n;n++){var r=e.scoreList[i],o=e.scoreList[n];if(r.score<o.score){var a=r.openid;r.openid=o.openid,o.openid=a,a=r.score,r.score=o.score,o.score=a}}this.resultData.scoreList=e.scoreList,this.socket.sendMessage("gameOver",e,this.revGameOver,this)},s.revGameOver=function(e){console.log("revGameOver",e),GameConst.debug?this.resultData.rankList=[{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999},{nickName:"AA",headUrl:"resource/assets/home/home_arrow0.png",score:999}]:(this.resultData.rankList=e.rankList,this.resultData.gameRankList=e.gameRankList),SoundManager.getInstance().stopBgm(),LayerManager.getInstance().runScene(GameManager.getInstance().resultScene)},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var BaseItem=function(e){function t(){e.call(this),this.score=0,this.track=0,this.className=egret.getQualifiedClassName(this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.flyToHead=function(e){var t=this;egret.Tween.get(this).to({y:this.y-200},200).to({x:e.x,y:e.y,scaleX:.1,scaleY:.1},1e3,egret.Ease.circIn).call(function(){t.recycle()})},s.recycle=function(){this.scaleX=1,this.scaleY=1,this.parent&&this.parent.removeChild(this),ObjectPool.getPool(this.className).returnObject(this)},t}(egret.Bitmap);egret.registerClass(BaseItem,"BaseItem");var Banana=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_banana_png"),this.type=0,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.score=10}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="Banana",t}(BaseItem);egret.registerClass(Banana,"Banana");var Carrot=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_carrot_png"),this.score=10,this.type=0,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="Carrot",t}(BaseItem);egret.registerClass(Carrot,"Carrot");var HighWood=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_highwood_png"),this.type=2,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2
}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="HighWood",t}(BaseItem);egret.registerClass(HighWood,"HighWood");var LowWood=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_lowwood_png"),this.type=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="LowWood",t}(BaseItem);egret.registerClass(LowWood,"LowWood");var Mice=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_mice_png"),this.type=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="Mice",t}(BaseItem);egret.registerClass(Mice,"Mice");var Stone=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_stone_png"),this.type=2,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="Stone",t}(BaseItem);egret.registerClass(Stone,"Stone");var Water=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("item_water_png"),this.type=1,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t);i.prototype;return t.NAME="Water",t}(BaseItem);egret.registerClass(Water,"Water");var GameHead=function(e){function t(){e.call(this,"GameHeadSkin"),this.imgWidth=65,this.imgHeight=65,this.imageLoader=new egret.ImageLoader}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.headImg=new egret.Bitmap,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headGroup.addChild(this.headImg)},s.setNameLabel=function(e){this.nameLabel.text=e},s.setScoreLabel=function(e){this.scoreLabel.text=e+""},s.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},s.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data},s.onLoadError=function(){egret.log("加载头像错误")},s.isEmpty=function(){return""==this.nameLabel.text?!0:!1},s.clear=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.scoreLabel.text="0",this.openid=""},s.hide=function(){this.parent&&this.parent.removeChild(this)},t}(BaseUI);egret.registerClass(GameHead,"GameHead");var Grass=function(e){function t(t){e.call(this),this.speedX=3,this.speedY=1}__extends(t,e);var i=(__define,t),s=i.prototype;return s.randomSkin=function(){this.texture=RES.getRes("game_grass"+NumberTool.getRandomInt(0,2)+"_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},s.recycle=function(){this.parent&&this.parent.removeChild(this),ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="Grass",t}(egret.Bitmap);egret.registerClass(Grass,"Grass");var HeadUI=function(e){function t(){e.call(this,"HeadUI2Skin"),this.imgX=8,this.imgY=7,this.imgWidth=75,this.imgHeight=75,this.imageLoader=new egret.ImageLoader}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.headImg=new egret.Bitmap,this.headImg.x=this.imgX,this.headImg.y=this.imgY,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headImg.mask=this.headMask,this.addChild(this.headImg)},s.setUserInfo=function(e){0==this.isEmpty()&&this.clear(),this.setNameLabel(e.nickName),this.loadImg(e.headUrl),this.openid=e.openid},s.setNameLabel=function(e){this.nameLabel.text=e},s.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},s.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data},s.onLoadError=function(){egret.log("加载头像错误")},s.isEmpty=function(){return""==this.nameLabel.text?!0:!1},s.clear=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.openid=""},t}(BaseUI);egret.registerClass(HeadUI,"HeadUI");var Player=function(e){function t(t,i,s){e.call(this,t,i,s),this.isJumping=!1,this.isMoving=!1,this.isDie=!1,this.shadow=new egret.Bitmap(RES.getRes("shadow_png")),this.shadow.anchorOffsetX=this.shadow.width/2,this.shadow.anchorOffsetY=this.shadow.height/2}__extends(t,e);var i=(__define,t),s=i.prototype;return s.modifyPos=function(){this.x+=this.offerX,this.y+=this.offerY},s.stand=function(){this.gotoAndStop(4)},s.run=function(){this.gotoAndPlay("run",-1)},s.jump=function(){if(0==this.isJumping){this.isJumping=!0,this.gotoAndPlay("jump",1);var e=this;egret.Tween.get(this).to({y:this.initY-150},300).to({y:this.initY},300).call(function(){e.isJumping=!1,e.run()},this)}},s.die=function(){this.isDie=!0,this.gotoAndPlay("die",1);var e=this;egret.Tween.get(this.shadow).to({y:GameConst.stage.stageHeight+this.width},900),egret.Tween.get(this).to({y:GameConst.stage.stageHeight+this.width},1e3).call(function(){GameManager.getInstance().gameScene.resetPlayer(e)})},s.hide=function(){this.parent&&this.parent.removeChild(this),this.shadow.parent&&this.shadow.parent.removeChild(this.shadow),this.stop()},s.clearStatus=function(){this.isJumping=!1,this.isMoving=!1,this.isDie=!1},s.reset=function(){this.clearStatus(),this.gameHead=null,this.score=0,this.track=0,this.roleID=0,this.openid=""},t}(SimpleMC);egret.registerClass(Player,"Player");var ScoreUI=function(e){function t(){e.call(this,"ScoreUISkin")}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},s.show=function(e){var t=this;this.x=e.x,this.y=e.y,this.scoreLabel.text="+"+e.score,e.parent.addChild(this),egret.Tween.get(this).to({y:this.y-300},500).call(function(){t.recycle()})},s.recycle=function(){this.parent&&this.parent.removeChild(this),ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="ScoreUI",t}(BaseUI);egret.registerClass(ScoreUI,"ScoreUI");var TrackData=function(){function e(){this.lastItemType=0,this.fruitNum=0,this.fruitType=0,this.shouldCreate=0}var t=(__define,e),i=t.prototype;return i.clear=function(){this.lastItemType=0,this.fruitNum=0,this.shouldCreate=0,this.fruitType=0},e}();egret.registerClass(TrackData,"TrackData");var HomeScene=function(e){function t(){e.call(this,"HomeSceneSkin"),this.codeLoader=new QRCodeLoader,this.countDownTimer=new egret.Timer(1e3),this.countDownLimit=15,this.headList=new Array,this.snd=SoundManager.getInstance()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance(),this.countDownLimit=GameConst.gameCofig.homeTime,this.initView()},s.onEnable=function(){window.changeBgColor("#35ed94"),this.resetScene(),this.snd.playBgm(this.snd.bgm_home)},s.onRemove=function(){this.snd.stopBgm()},s.initView=function(){this.initHead(),this.introduceGroup.visible=!0,this.countDownGroup.visible=!1,this.introduceLabel.text=GameConst.gameCofig.introduceText},s.resetScene=function(){this.countDownLabel.text="",this.createQRCode(),this.clearHead(),this.clearUserManager(),this.startPlayerAnim()},s.startPlayerAnim=function(){null==this.player&&(this.player=new Player("player0_png","player0_json","player0"),this.player.scaleX=.5,this.player.scaleY=.5,this.playerGroup.addChild(this.player));var e=this.playerGroup.width/2-this.player.width/2,t=this.playerGroup.height/2-this.player.height/2;this.player.x=e,this.player.y=t,this.player.run(),egret.Tween.get(this.player,{loop:!0}).wait(1500).to({x:-80},100).wait(1500).to({x:e},100).wait(1500).to({y:-100},200).to({y:t},200),this.phone0.rotation=0,this.phone0.visible=!0,this.phone1.visible=!1;var i=this;egret.Tween.get(this.phone0,{loop:!0}).wait(1500).to({rotation:-30},200).to({rotation:0},200).wait(1200).to({rotation:30},200).to({rotation:0},200).wait(1200).call(function(){i.changePhoneVisible(!1)}).wait(200).call(function(){i.changePhoneVisible(!0)}).wait(200)},s.changePhoneVisible=function(e){e?(this.phone0.visible=!0,this.phone1.visible=!1):(this.phone0.visible=!1,this.phone1.visible=!0)},s.stopPlayerAnim=function(){},s.initHead=function(){this.headList.push(this.head1,this.head2,this.head0),this.head0.infoLabel.text="选择暴躁鹿",this.head1.infoLabel.text="选择嘻哈兔",this.head2.infoLabel.text="选择悠悠熊猫"},s.clearHead=function(){this.head0.clear(),this.head1.clear(),this.head2.clear()},s.clearUserManager=function(){UserManager.getInstance().clearAllUser()},s.createQRCode=function(){this.rid=window.createQRCode();var e=new QRCodeLoader,t=GameConst.gameCofig;e.load(t.codeData,t.codeWidth,t.codeHeight,t.logoUrl),this.codeGroup.addChild(e),egret.log("upRid:",this.rid),this.socket.sendMessage("upRid",{rid:this.rid})},s.startCountDown=function(){this.countDownGroup.visible=!0,this.introduceGroup.visible=!1,this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.reset(),this.countDownTimer.start(),this.countDownLabel.text=this.countDownLimit+""},s.onCountDownHandler=function(){var e=this.countDownLimit-this.countDownTimer.currentCount;this.countDownLabel.text=e+"",0>=e&&(this.stopCountDown(),LayerManager.getInstance().runScene(GameManager.getInstance().lockScene),this.sendStartLock())},s.stopCountDown=function(){this.countDownGroup.visible=!1,this.introduceGroup.visible=!0,this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.stop()},s.sendLogin=function(){console.log("sendLogin：",this.rid);var e=this.rid;GameConst.debug?this.socket.sendMessage("login",{rid:e,userType:"pc"},this.revLogin,this):this.socket.sendMessage("login",{rid:e},this.revLogin,this)},s.revLogin=function(e){console.log("rev login:",e);var t=e.success,i=e.msg;t||alert(i)},s.revUserJoin=function(e){console.log("rev userJoin:",e);var t=UserManager.getInstance();if(t.isOverUserLimit())return void egret.log("超出人数");if(t.isExsit(e.openid))return void egret.log("玩家已存在");if(!this.parent)return void egret.log("游戏已开始");GameConst.debug&&(e.headUrl="resource/assets/home/home_player.png",e.nickName="ABC");var i=new UserVO;i.openid=e.openid,i.headUrl=e.headimgurl,i.nickName=e.nickname,t.addUser(i);for(var s=0;3>s;s++){var n=this.headList[s];if(n.isEmpty()){n.setUserInfo(i),i.role=s,this.sendRole(i.role,i.openid);break}}1==UserManager.getInstance().userList.length&&this.startCountDown()},s.revUserQuit=function(e){console.log("rev userQuit:",e);var t=e.openid,i=GameManager.getInstance().gameScene;if(this.parent){var s=UserManager.getInstance();s.deleteUser(t);for(var n=0;3>n;n++){var r=this.headList[n];r.openid==t&&r.clear()}if(0==UserManager.getInstance().userList.length){this.stopCountDown(),this.countDownLabel.text="";for(var n=0;3>n;n++)this.headList[n].clear()}}else i.parent&&i.deleteUser(t)},s.sendStartLock=function(){console.log("sendStartLock"),this.socket.sendMessage("startLock")},s.sendRole=function(e,t){console.log("assignRole:","openid:",t,"roleType:",e),this.socket.sendMessage("assignRole",{roleType:e,openid:t})},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var LockScene=function(e){function t(){e.call(this,"LockSceneSkin"),this.countDownTimer=new egret.Timer(1e3),this.countDownLimit=10,this.lockNum=0}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance(),this.initHandY=this.hand.y,this.countDownLimit=GameConst.gameCofig.lockTime},s.onEnable=function(){this.resetScene(),this.startCountDown(),this.startHandAnim()},s.onRemove=function(){this.stopHandAnim()},s.resetScene=function(){this.lockNum=0},s.startHandAnim=function(){egret.Tween.get(this.hand,{loop:!0}).to({y:this.initHandY-100},400).to({y:this.initHandY},400)},s.stopHandAnim=function(){egret.Tween.removeTweens(this.hand),this.hand.y=this.initHandY},s.startCountDown=function(){this.countDownGroup.visible=!0,this.goImg.visible=!1,this.countDownLabel.text=this.countDownLimit+"",this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimerHandler,this),this.countDownTimer.reset(),this.countDownTimer.start()},s.onTimerHandler=function(){var e=this.countDownLimit-this.countDownTimer.currentCount;0>=e&&this.parent&&this.startGame(),this.countDownLabel.text=e+""},s.stopCountDown=function(){this.countDownGroup.visible=!1,this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimerHandler,this),this.countDownTimer.stop()},s.startGame=function(){this.stopCountDown();var e=this;this.goImg.scaleX=.1,this.goImg.scaleY=.1,this.goImg.visible=!0,egret.Tween.get(this.goImg).to({scaleX:1.2,scaleY:1.2},1200,egret.Ease.elasticOut).call(function(){e.sendStartGame(),LayerManager.getInstance().runScene(GameManager.getInstance().gameScene)})},s.revLock=function(e){console.log("revLock:",e);e.openid;if(this.lockNum++,this.parent)if(GameConst.debug)this.startGame();else{var t=UserManager.getInstance().getUserNum();this.lockNum>=t&&this.startGame()}},s.sendStartGame=function(){console.log("sendStartGame"),window.czcStartGame(UserManager.getInstance().getUserNum()),this.socket.sendMessage("startGame")},t}(BaseScene);egret.registerClass(LockScene,"LockScene");var PreloadScene=function(e){function t(){e.call(this,"PreloadSceneSkin")}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.progressLabel.text="0%"},s.setProgress=function(e){this.inited&&(this.progressLabel.text=e.toString()+"%")},t}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var ResultScene=function(e){function t(){e.call(this,"ResultSceneSkin"),this.scoreHeadList=new Array,this.rankHeadList=new Array,this.countDownTimer=new egret.Timer(1e3),this.countDownLimit=0,this.snd=SoundManager.getInstance()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this);for(var t=0;3>t;t++)this.scoreHeadList.push(this["scoreHead"+t]);for(var t=0;10>t;t++)this.rankHeadList.push(this["rankHead"+t]);this.countDownLimit=GameConst.gameCofig.resultTime},s.onEnable=function(){window.changeBgColor("#5b7cf2"),this.showResult(),this.snd.play(this.snd.gameover)},s.showResult=function(){for(var e=GameManager.getInstance().gameScene.resultData,t=e.gameRankList,i=e.rankList,t=e.gameRankList,s=0;3>s;s++)this.scoreHeadList[s].clear();for(var n=t.length,s=0;n>s;s++){var r=this.scoreHeadList[s];r.setNameLabel(t[s].nickName),r.loadImg(t[s].headUrl),r.setScoreLabel(t[s].score)}for(var s=0;10>s;s++)this.rankHeadList[s].clear();n=i.length;for(var s=0;n>s;s++){var o=this.rankHeadList[s];o.setNameLabel(i[s].nickName),o.setScoreLabel(i[s].score),o.setRankLabel(s+1),o.loadImg(i[s].headUrl)}this.countDownLabel.text="",this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onTimerHander,this),this.countDownTimer.reset(),this.countDownTimer.start()},s.onTimerHander=function(){var e=this.countDownLimit-this.countDownTimer.currentCount;0>=e&&(this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER,this.onTimerHander,this),this.countDownTimer.stop(),UserManager.getInstance().clearAllUser(),LayerManager.getInstance().runScene(GameManager.getInstance().homeScene)),this.countDownLabel.text=e+""},t}(BaseScene);egret.registerClass(ResultScene,"ResultScene");var RankHead=function(e){function t(){e.call(this,"GameHeadSkin"),this.imgWidth=50,this.imgHeight=50,this.imageLoader=new egret.ImageLoader}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.headImg=new egret.Bitmap,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headGroup.addChild(this.headImg)},s.setNameLabel=function(e){this.nameLabel.text=e},s.setScoreLabel=function(e){this.scoreLabel.text=e+""},s.setRankLabel=function(e){this.rankLabel.text=e+""},s.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},s.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data},s.onLoadError=function(){egret.log("加载头像错误")},s.isEmpty=function(){return""==this.nameLabel.text?!0:!1},s.clear=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.scoreLabel.text="0",this.rankLabel.text="",this.openid=""},s.hide=function(){this.parent&&this.parent.removeChild(this)},t}(BaseUI);egret.registerClass(RankHead,"RankHead");var ScoreHead=function(e){function t(){e.call(this,"GameHeadSkin"),this.imgWidth=150,this.imgHeight=150,this.imageLoader=new egret.ImageLoader}__extends(t,e);var i=(__define,t),s=i.prototype;return s.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.scoreLabel.text="",this.headImg=new egret.Bitmap,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headGroup.addChild(this.headImg)},s.setNameLabel=function(e){this.nameLabel.text="昵称："+e},s.setScoreLabel=function(e){this.scoreLabel.text="得分："+e},s.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},s.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data},s.onLoadError=function(){egret.log("加载头像错误")},s.isEmpty=function(){return""==this.nameLabel.text?!0:!1},s.clear=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.scoreLabel.text="",this.openid=""},s.hide=function(){this.parent&&this.parent.removeChild(this)},t}(BaseUI);egret.registerClass(ScoreHead,"ScoreHead");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},s.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},s.onPreloadComplete=function(e){this.preloadScene=new PreloadScene,this.preloadScene.setProgress(0),this.addChild(this.preloadScene),LoadManager.getInstance().loadGroup("home",this,this.onHomeComplete,this.onHomeProgress)},s.onHomeProgress=function(e){this.preloadScene.setProgress(Math.round(e.itemsLoaded/e.itemsTotal*100))},s.onHomeComplete=function(){this.removeChild(this.preloadScene),this.preloadScene=null,GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,s){function n(e){t.call(s,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);