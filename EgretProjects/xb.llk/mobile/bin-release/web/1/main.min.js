var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ArrayTool=function(){function e(){}var t=(__define,e);t.prototype;return e.randomArr=function(e){for(var t,i,n,s=e.length;s;)i=s-1,n=Math.floor(Math.random()*s),s--,i!=n&&(t=e[i],e[i]=e[n],e[n]=t)},e.random2DArr=function(t){for(var i=[],n=t.length,s=t[0].length,o=0;n>o;o++)for(var r=0;s>r;r++)i.push(t[o][r]);e.randomArr(i);for(var o=0;n>o;o++)for(var r=0;s>r;r++)t[o][r]=i[o*s+r]},e.copy2DArr=function(e){for(var t=new Array,i=e.length,n=e[0].length,s=0;i>s;s++){var o=new Array;t.push(o);for(var r=0;n>r;r++)o.push(e[s][r])}return t},e.getObjectLen=function(e){var t=0;for(var i in e)t++;return t},e}();egret.registerClass(ArrayTool,"ArrayTool");var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},n.onEnable=function(){},n.onRemove=function(){},n.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var LayerManager=function(){function e(){}var t=(__define,e),i=t.prototype;return i.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.popLayer.touchThrough=!0,this.main.addChild(this.popLayer)},i.runScene=function(e,t){void 0===t&&(t=!1),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.sceneLayer.addChild(e),e.inited&&e.onEnable(),this.curScene=e},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.loadGroup=function(e,t,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.loadComplete[e]=i,this.loadError[e]=s,this.loadProgress[e]=n,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},i.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var i=this.loadComplete[t];null!=i&&i.call(this.thisObject[t],e),this.clearCallBack(t)},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},i.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},i.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var MapManager=function(){function e(){this.rowMax=10,this.colMax=9,this.level=new Array}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.getBlockNum=function(){for(var e=this.level.length,t=0,i=0;e>i;i++)for(var n=this.level[i],s=0;s<this.rowMax;s++)for(var o=0;o<this.colMax;o++)n[s][o]>0&&t++;return egret.log("方块总数:",t),t},e}();egret.registerClass(MapManager,"MapManager");var NumberTool=function(){function e(){}var t=(__define,e);t.prototype;return e.getRandomInt=function(e,t){return Math.round(Math.random()*(t-e))+e},e.getTimeString=function(e){var t="";return t=10>e?"0"+e:e.toString()},e}();egret.registerClass(NumberTool,"NumberTool");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),i=t.prototype;return i.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},i.returnObject=function(e){this.list.push(e)},e.getPool=function(t,i){if(void 0===i&&(i=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=i))for(var n=egret.getDefinitionByName(t),s=e.pool[t],o=0;i>o;o++)s.returnObject(new n);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var ShakeTool=function(){function e(){this.count=0,this.timer=new egret.Timer(1e3)}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.shakeObj=function(e,t,i,n){this.target=e,this.initX=e.x,this.initY=e.y,this.maxDis=n,this.count=t*i,this.rate=i,this.timer.delay=1e3/i,this.timer.repeatCount=this.count,this.timer.addEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this),this.timer.reset(),this.timer.start()},i.shaking=function(){egret.Tween.removeTweens(this),this.target.x=this.initX-this.maxDis+Math.random()*this.maxDis*2,this.target.y=this.initY-this.maxDis+Math.random()*this.maxDis*2,egret.Tween.get(this.target).to({x:this.initX,y:this.initY},999/this.rate)},i.shakeComplete=function(){egret.Tween.removeTweens(this),this.target.x=this.initX,this.target.y=this.initY,this.timer.removeEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this)},e}();egret.registerClass(ShakeTool,"ShakeTool");var SoundManager=function(){function e(){this.click="click",this.line="line",this.soundList={},this.channelList={},this.soundList[this.click]=RES.getRes("click_mp3"),this.soundList[this.line]=RES.getRes("line_mp3")}var t=(__define,e),i=t.prototype;return i.play=function(e,t){void 0===t&&(t=1);var i=this.soundList[e];i&&(this.channelList[e]=i.play(0,t))},i.stop=function(e){var t=this.channelList[e];t&&t.stop()},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(SoundManager,"SoundManager");var UserManager=function(){function e(){this.luckyUser="",this.bLuckUser=!1}var t=(__define,e);t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(UserManager,"UserManager");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function e(){this.homeScene=new HomeScene,this.gameScene=new GameScene,this.messageBox=new MessageBox,this.bReconnect=!1}var t=(__define,e),i=t.prototype;return i.startup=function(e){this.socket=new ClientSocket,this.socket.homeScene=this.homeScene,this.socket.gameScene=this.gameScene,this.homeScene.socket=this.socket,this.gameScene.socket=this.socket,GameConst.stage=e.stage,LayerManager.getInstance().initialize(e),LayerManager.getInstance().runScene(this.homeScene),this.socket.startConnect()},i.onConnect=function(){this.sendLogin()},i.onDisconnect=function(){this.gameScene.parent&&this.gameScene.reset(),LayerManager.getInstance().runScene(this.homeScene),this.messageBox.showMessage("已与服务器断开连接\n请尝试重新加入游戏")},i.onError=function(){this.messageBox.showMessage("服务器连接错误")},i.revLogin=function(e){var t=e;switch(egret.log("接收登录:"+t),t){case 1:this.bReconnect&&(this.homeScene.sendUserReady(),this.bReconnect=!1);break;case-1:this.messageBox.showMessage("房间不存在\n请重新扫描二维码");break;case 0:this.messageBox.showMessage("用户信息错误\n请重新扫描二维码")}},i.sendLogin=function(){egret.log("发送登录");var e={uid:window.srvConfig.uid,rid:window.srvConfig.rid};this.socket.sendMessage(NetConst.C2S_login,e,this.revLogin,this)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var ClientSocket=function(){function e(){}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.isConnected=function(){return this.socket&&this.socket.connected?!0:!1},i.closeSocket=function(){egret.log("主动断开连接"),this.socket.disconnect()},i.startConnect=function(){this.socket=io.connect(window.server,{reconnection:!1,"force new connection":!0});var e=this;this.socket.on("connect",function(){e.onConnect()}),this.socket.on("error",function(t){e.onError(t)}),this.socket.on("disconnect",function(){e.onDisconnect()}),this.socket.on("reconnect_attempt",function(){e.onReconnectAttempt()}),this.socket.on("connect_timeout",function(){}),this.socket.on("chooseForScreen",function(e){console.log("大屏幕"),UserManager.getInstance().bLuckUser=!0}),this.socket.on("queueInfo",function(t){e.homeScene.revQueue(t)}),this.socket.on(NetConst.S2C_pro,function(t){e.gameScene.revPro(t)}),this.socket.on(NetConst.S2C_mapData,function(t){e.homeScene.revMapData(t)}),this.socket.on(NetConst.S2C_gameOver,function(t){e.gameScene.revGameOver(t)})},i.onConnect=function(){egret.log("connenct succss"),GameManager.getInstance().onConnect()},i.onError=function(e){egret.log("connenct erro"),GameManager.getInstance().onError()},i.onDisconnect=function(){egret.log("connenct close"),GameManager.getInstance().onDisconnect()},i.onReconnectAttempt=function(){egret.log("reconnect")},i.sendMessage=function(e,t,i,n){void 0===t&&(t=null),void 0===i&&(i=null),void 0===n&&(n=null),this.socket&&this.socket.connected&&this.socket.emit(e,t,function(e){i&&n&&i.call(n,e)})},e}();egret.registerClass(ClientSocket,"ClientSocket");var NetConst=function(){function e(){}var t=(__define,e);t.prototype;return e.S2C_login="login",e.S2C_mapData="mapData",e.S2C_pro="pro",e.S2C_gameOver="gameOver",e.C2S_login="login",e.C2S_barrage="barrage",e.C2S_upMap="upMap",e.C2S_eliminate="eliminate",e.C2S_usePro="usePro",e}();egret.registerClass(NetConst,"NetConst");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin"),this.blockPool=ObjectPool.getPool(BlockUI.NAME,10),this.boomPool=ObjectPool.getPool(Boom.NAME,1),this.selectOld=new SelectUI,this.selectNew=new SelectUI,this.lineSuPool=ObjectPool.getPool(LineSu.NAME,10),this.lineZhePool=ObjectPool.getPool(LineZhe.NAME,4),this.barStart=.15,this.barEnd=1.45,this.blockNum=0,this.blockData=new Array,this.tempMap=new Array,this.blockArr=new Array,this.rowMax=10,this.colMax=9,this.blockWidth=60,this.blockHeight=60,this.mapStartY=0,this.mapStartX=0,this.isSelect=!1,this.curLevel=1,this.cancelBlockNum=0,this.totalBlock=0,this.minRoadPoint=1e4,this.route=new Array}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.initView()},n.onEnable=function(){this.startGame()},n.onRemove=function(){UserManager.getInstance().bLuckUser=!1},n.reset=function(){this.resetGame(),this.deConfigListener(),this.hideResult(),MapManager.getInstance().level.length=0},n.startGame=function(){this.curLevel=1,this.cancelBlockNum=0,this.progressBar.scaleX=this.barStart,this.waitGroup.visible=!1,this.totalBlock=MapManager.getInstance().getBlockNum(),this.skillLabel0.text="3",this.skillLabel1.text="3",this.skillLabel2.text="3",this.hideResult(),this.createMap(),this.configListener()},n.resetGame=function(){for(var e=0;e<this.rowMax;e++){for(var t=0;t<this.colMax;t++)null!=this.blockArr[e][t]&&this.blockArr[e][t].hideImmediately();this.blockArr[e].length=0}this.isSelect=!1,this.oldTarget=null,this.newTarget=null,this.minRoadPoint=1e4,this.route.length=0,this.blockNum=0,this.blockData.length=0,this.tempMap=null,this.selectOld.hide(),this.selectNew.hide()},n.gameOver=function(){console.log("game over")},n.nextLevel=function(){return this.curLevel++,this.resetGame(),null==MapManager.getInstance().level[this.curLevel-1]?(this.waitGroup.visible=!0,void(this.waitLabel.text="您已完成游戏\n请等待其他玩家")):(this.createMap(),void this.configListener())},n.configListener=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.skillResetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onResetTouch,this),this.skillIceBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onIceTouch,this),this.skillTipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTipTouch,this)},n.deConfigListener=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.skillResetBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onResetTouch,this),this.skillIceBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onIceTouch,this),this.skillTipBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTipTouch,this)},n.onResetTouch=function(){this.sendUserPro("disturb")},n.onIceTouch=function(){this.sendUserPro("ice")},n.onTipTouch=function(){this.sendUserPro("find")},n.initView=function(){this._stage=GameConst.stage;for(var e=0;e<this.rowMax;e++)this.blockArr.push(new Array)},n.showResult=function(e){var t=e.rank,i=e.spend;if(this.addChild(this.resultGroup),this.rankLabel.text=t.toString(),i>0){var n=Math.floor(i/1e3/60),s=Math.floor(i/1e3%60);this.timeLabel.text=NumberTool.getTimeString(n)+":"+NumberTool.getTimeString(s)}else this.timeLabel.text="未完成";this.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgainBtnTouch,this)},n.onAgainBtnTouch=function(){var e=window._czc;e.push(["_trackEvent","xbFree","点击","再来一次","1","play"]),this.reset(),LayerManager.getInstance().runScene(GameManager.getInstance().homeScene)},n.hideResult=function(){this.againBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgainBtnTouch,this),this.resultGroup.parent&&this.resultGroup.parent.removeChild(this.resultGroup)},n.setStarPos=function(){},n.playDisturbSkill=function(){this.deConfigListener(),this.skillBang.visible=!0,this.skillBang.rotation=-10,this.skillWave.alpha=1,this.skillWave.scaleX=.1,this.skillWave.scaleY=.1;var e=this;egret.Tween.get(this.skillBang).to({rotation:-120},500),egret.Tween.get(this.skillBang).wait(500).call(function(){ShakeTool.getInstance().shakeObj(e,1,20,20),e.skillWave.visible=!0}),egret.Tween.get(this.skillWave).wait(500).to({alpha:0,scaleX:2,scaleY:2},1e3).call(function(){e.configListener(),e.skillBang.visible=!1,e.skillWave.visible=!1})},n.createMap=function(e){void 0===e&&(e=!0);var t=MapManager.getInstance().level[this.curLevel-1];if(null!=t){this.tempMap=ArrayTool.copy2DArr(t);for(var i=0,n=0;n<this.rowMax;n++)for(var s=0;s<this.colMax;s++)if(this.tempMap[n][s]>0){var o=this.blockPool.getObject();o.setSkin(this.tempMap[n][s]),o.row=n,o.col=s,o.x=this.mapStartX+s*this.blockWidth,o.y=this.mapStartY+n*this.blockHeight-this._stage.stageHeight,this.blockGroup.addChild(o),this.blockArr[o.row][o.col]=o,e?egret.Tween.get(o).to({y:this.mapStartY+n*this.blockHeight},500):o.y=this.mapStartY+n*this.blockHeight,i++}}},n.onTouchTap=function(e){e.target instanceof BlockUI&&(window.playClick(),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this),this.checkBlock(e.target),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchTap,this))},n.checkBlock=function(e){if(this.isSelect&&(this.oldTarget=this.newTarget,this.selectOld.play(this.oldTarget)),this.newTarget=e,this.selectNew.play(this.newTarget),this.isSelect){if(this.newTarget!=this.oldTarget&&this.newTarget.skinID==this.oldTarget.skinID){if(this.checkRoad(this.oldTarget,this.newTarget)){this.linkRoad();var t=this.boomPool.getObject(),i=this.boomPool.getObject();return this.addChild(t),this.addChild(i),t.playAnim(this.newTarget),i.playAnim(this.oldTarget),this.sendEliminate(this.oldTarget,this.newTarget),this.oldTarget.hide(),this.newTarget.hide(),this.tempMap[this.oldTarget.row][this.oldTarget.col]=0,this.tempMap[this.newTarget.row][this.newTarget.col]=0,this.blockArr[this.oldTarget.row][this.oldTarget.col]=null,this.blockArr[this.newTarget.row][this.newTarget.col]=null,this.oldTarget=this.newTarget=null,window.playLine(),this.cancelBlockNum+=2,this.progressBar.scaleX=this.barStart+this.cancelBlockNum/this.totalBlock*(this.barEnd-this.barStart),this.selectOld.hide(),this.selectNew.hide(),this.isSelect=!1,this.checkGameOver()?void this.nextLevel():void(0==this.bangzhu()&&(console.log("重排前数组:",this.tempMap),this.sortBlock(),this.sendUpMap()))}return this.oldTarget=null,this.newTarget=null,this.selectOld.hide(),this.selectNew.hide(),void(this.isSelect=!1)}this.selectOld.hide();var n=this.selectOld;return this.selectOld=this.selectNew,void(this.selectNew=n)}this.isSelect=!0},n.checkRoad=function(e,t){var i=e.row,n=e.col,s=t.row,o=t.col,r=!1;if(i==s){if(this.lineCheck(i,n,s,o))return this.saveLinePath(i,n,s,o),!0;for(var a=0;a<this.rowMax;a++)0==this.tempMap[a][n]&&0==this.tempMap[a][o]&&this.lineCheck(i,n,a,n)&&this.lineCheck(a,n,a,o)&&this.lineCheck(a,o,s,o)&&(this.theShortest(i,n,a,n,a,o,s,o),r=!0)}else if(n==o){if(this.lineCheck(i,n,s,o))return this.saveLinePath(i,n,s,o),!0;for(a=0;a<this.colMax;a++)0==this.tempMap[i][a]&&0==this.tempMap[s][a]&&this.lineCheck(i,n,i,a)&&this.lineCheck(i,a,s,a)&&this.lineCheck(s,a,s,o)&&(this.theShortest(i,n,i,a,s,a,s,o),r=!0)}else{if(0==this.tempMap[s][n]&&this.lineCheck(i,n,s,n)&&this.lineCheck(s,n,s,o))return this.saveLinePath(i,n,s,n),this.route.pop(),this.saveLinePath(s,n,s,o),!0;if(0==this.tempMap[i][o]&&this.lineCheck(i,n,i,o)&&this.lineCheck(s,o,i,o))return this.saveLinePath(i,n,i,o),this.route.pop(),this.saveLinePath(i,o,s,o),!0;for(a=0;a<this.colMax;a++)0==this.tempMap[i][a]&&0==this.tempMap[s][a]&&this.lineCheck(i,n,i,a)&&this.lineCheck(i,a,s,a)&&this.lineCheck(s,a,s,o)&&(this.theShortest(i,n,i,a,s,a,s,o),r=!0);for(a=0;a<this.rowMax;a++)0==this.tempMap[a][n]&&0==this.tempMap[a][o]&&this.lineCheck(i,n,a,n)&&this.lineCheck(a,n,a,o)&&this.lineCheck(a,o,s,o)&&(this.theShortest(i,n,a,n,a,o,s,o),r=!0)}return r},n.lineCheck=function(e,t,i,n){if(e==i){if(t>n){var s=t;t=n,n=s}if(t+1==n)return!0;for(var o=t+1;n>o;o++)if(this.tempMap[e][o]>0)return!1;return!0}if(t==n){if(e>i&&(s=e,e=i,i=s),e+1==i)return!0;for(o=e+1;i>o;o++)if(this.tempMap[o][t]>0)return!1;return!0}return!1},n.saveLinePath=function(e,t,i,n){if(e==i)if(t>n)for(var s=t;s>=n;s--)this.route.push({x:s,y:e});else for(var s=t;n>=s;s++)this.route.push({x:s,y:e});else if(t==n)if(e>i)for(var s=e;s>=i;s--)this.route.push({x:t,y:s});else for(var s=e;i>=s;s++)this.route.push({x:t,y:s})},n.linkRoad=function(){for(var e=this.route.length-1,t=new Array,i=0;e>i;i++){var n=this.route[i],s=this.route[i+1];if(e>=i+2)var o=this.route[i+2],r=o.x,a=o.y;if(i+1==e)break;var h=n.x,c=n.y,l=s.x,u=s.y;if(h!=l||null!=o&&l!=r)if(c!=u||null!=o&&u!=a){if(o){var g=this.lineZhePool.getObject();g.x=l*this.blockWidth+this.blockWidth/2,g.y=u*this.blockHeight+this.blockHeight/2,this.blockGroup.addChild(g),t.push(g),h==l&&u>c&&u==a&&r>l||c==u&&h>l&&l==r&&u>a?g.rotation=0:h==l&&c>u&&u==a&&r>l||c==u&&h>l&&l==r&&a>u?g.rotation=90:c==u&&l>h&&l==r&&a>u||h==l&&c>u&&u==a&&l>r?g.rotation=180:g.rotation=270}}else{var d=this.lineSuPool.getObject();d.rotation=90,d.x=l*this.blockWidth+this.blockWidth/2,d.y=u*this.blockHeight+this.blockHeight/2,t.push(d),this.blockGroup.addChild(d)}else{var d=this.lineSuPool.getObject();d.rotation=0,d.x=l*this.blockWidth+this.blockWidth/2,d.y=u*this.blockHeight+this.blockHeight/2,t.push(d),this.blockGroup.addChild(d)}}this.route.length=0,this.minRoadPoint=1e4;for(var e=t.length,i=0;e>i;i++)t[i].recycle()},n.theShortest=function(e,t,i,n,s,o,r,a){var h=0;h=Math.abs(i-e)+Math.abs(s-i)+Math.abs(r-s)+Math.abs(n-t)+Math.abs(o-n)+Math.abs(a-o),h<=this.minRoadPoint&&(this.route.length=0,this.saveLinePath(e,t,i,n),this.route.pop(),this.saveLinePath(i,n,s,o),this.route.pop(),this.saveLinePath(s,o,r,a),this.minRoadPoint=h)},n.sortBlock=function(){for(var e,t=new Array,i=0;i<this.rowMax;i++)for(var n=0;n<this.colMax;n++)e=this.blockArr[i][n],null!=e&&t.push(e);ArrayTool.randomArr(t);for(var s,o,r=t.length/2,i=0;r>i;i+=2){s=t[i],o=t[i+1];var a=s.skinID;s.setSkin(o.skinID),o.setSkin(a),a=this.tempMap[s.row][s.col],this.tempMap[s.row][s.col]=this.tempMap[o.row][o.col],this.tempMap[o.row][o.col]=a}},n.checkGameOver=function(){for(var e=0;e<this.rowMax;e++)for(var t=0;t<this.colMax;t++)if(this.tempMap[e][t]>0)return!1;return!0},n.tishi=function(){this.oldTarget&&this.selectOld.hide(),this.newTarget&&this.selectNew.hide(),this.oldTarget=null,this.newTarget=null,this.isSelect=!1,this.bangzhu()&&(egret.log("提示方块:",this.oldTarget.row,this.oldTarget.col,this.newTarget.row,this.newTarget.col),this.selectOld.play(this.oldTarget),this.selectNew.play(this.newTarget))},n.bangzhu=function(){for(var e=0;e<this.rowMax;e++)for(var t=0;t<this.colMax;t++)if(this.tempMap[e][t]>0)for(var i=e;i<this.rowMax;i++){var n;for(n=i==e?t+1:0;n<this.colMax;n++)if(this.tempMap[i][n]>0){var s=this.blockArr[e][t],o=this.blockArr[i][n];if(s.skinID==o.skinID&&this.checkRoad(s,o))return this.route.length=0,this.minRoadPoint=1e4,this.oldTarget=s,this.newTarget=o,!0}}return!1},n.sendBarrage=function(e){var t={msg:e};this.socket.sendMessage(NetConst.C2S_barrage,t)},n.sendUpMap=function(){if(UserManager.getInstance().bLuckUser){egret.log("发送重排地图");var e={mapData:this.tempMap};this.socket.sendMessage(NetConst.C2S_upMap,e)}},n.sendEliminate=function(e,t){var i={pos:[[e.row,e.col],[t.row,t.col]]};this.socket.sendMessage(NetConst.C2S_eliminate,i)},n.sendUserPro=function(e){var t={type:e};switch(egret.log("使用道具:"+e),this.socket.sendMessage(NetConst.C2S_usePro,t,this.CB_userPro,this),e){case"disturb":var i=parseInt(this.skillLabel0.text);i--,i=i>0?i:0,this.skillLabel0.text=i.toString();break;case"ice":var i=parseInt(this.skillLabel1.text);i--,i=i>0?i:0,this.skillLabel1.text=i.toString();break;case"find":var i=parseInt(this.skillLabel2.text);i--,i=i>0?i:0,this.skillLabel2.text=i.toString()}},n.CB_userPro=function(e){var t=e.bSuccess,i=e.chance;egret.log("使用道具回调:",t,i)},n.revGameOver=function(e){var t=e.rank;egret.log("游戏结束，排名"+t),this.showResult(e)},n.revPro=function(e){var t=e.type,i=e.mapData,n=e.time;switch(egret.log("被使用道具:",t,n),console.log("被使用道具:",i),t){case"disturb":this.playDisturbSkill(),this.sendUpMap();break;case"ice":this.deConfigListener(),this.skillIce.visible=!0,this.blockGroup.addChild(this.skillIce);var s=this;egret.Tween.removeTweens(this.skillIce),egret.Tween.get(this.skillIce).wait(n).call(function(){s.skillIce.parent&&s.skillIce.parent.removeChild(s.skillIce),s.configListener()});break;case"find":this.tishi()}},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var HomeScene=function(e){function t(){e.call(this,"HomeSceneSkin")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.initView()},n.onEnable=function(){this.ruleGroup.visible=!1,this.dmGroup.visible=!1,this.queueGroup.visible=!1,this.toolGroup.visible=!1,this.queueLabel.text="",this.showJoinBtn(),this.dmLabel.prompt="弹幕内容",this.danmuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDanMuBtnTouch,this),this.toolBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onToolBtnTouch,this),this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRuleBtnTouch,this)},n.onRemove=function(){this.danmuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onDanMuBtnTouch,this),this.toolBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onToolBtnTouch,this),this.ruleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRuleBtnTouch,this),this.dmGroup.visible=!1,this.ruleGroup.visible=!1},n.reset=function(){},n.initView=function(){this.initTitleY=this.title.y,this.title.y=this.joinBtn.y-300},n.showJoinBtn=function(){this.joinBtn.visible=!0;this.joinBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onJoinBtnTouch,this)},n.onJoinBtnTouch=function(){this.socket&&this.socket.isConnected()?(egret.log("发送用户准备"),this.sendUserReady()):(egret.log("请求连接"),GameManager.getInstance().bReconnect=!0,this.socket.startConnect())},n.onDanMuBtnTouch=function(){this.dmGroup.visible=!0,this.sendDmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendDmBtnTouch,this),this.closeDmBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseDmBtnTouch,this)},n.onToolBtnTouch=function(){this.toolGroup.visible=!0,this.closeToolBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseToolBtnTouch,this)},n.onCloseToolBtnTouch=function(){this.toolGroup.visible=!1,this.closeToolBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseToolBtnTouch,this)},n.onRuleBtnTouch=function(){this.ruleGroup.visible=!0,this.closeRuleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseRuleBtnTouch,this)},n.onSendDmBtnTouch=function(){this.dmGroup.visible=!1,this.sendDanMu(this.dmLabel.text),this.dmLabel.text=""},n.onCloseDmBtnTouch=function(){this.dmGroup.visible=!1,this.sendDmBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSendDmBtnTouch,this),this.closeDmBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseDmBtnTouch,this)},n.onCloseRuleBtnTouch=function(){this.ruleGroup.visible=!1,this.closeRuleBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRuleBtnTouch,this)},n.sendDanMu=function(e){egret.log("发送弹幕:"+e);var t={msg:e};this.socket.sendMessage(NetConst.C2S_barrage,t)},n.sendUserReady=function(){this.socket.sendMessage("userReady")},n.revQueue=function(e){var t=e.status,i=e.queue;egret.log("排队信息:"+t,i),this.title.y=this.initTitleY,"wait"==t?(this.queueGroup.visible=!0,10>i?this.queueLabel.text="0"+i.toString():99>=i?this.queueLabel.text=i.toString():this.queueLabel.text="99",this.tipLabel.text="\n\n游戏已经开始,请排队等待\n\n您前面的人数"):"ready"==t&&(this.queueGroup.visible=!0,this.tipLabel.text="\n\n\n已经加入游戏\n\n请耐心等待其他玩家",this.queueLabel.text=""),this.joinBtn.visible=!1},n.revMapData=function(e){var t=e.mapData;egret.log("下一关"),console.log(t),MapManager.getInstance().level.length=0,MapManager.getInstance().level.push(t[0],t[1],t[2]),LayerManager.getInstance().runScene(GameManager.getInstance().gameScene)},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var PreloadScene=function(e){function t(){e.call(this,"PreloadSceneSkin"),this.barStart=.15,this.barEnd=1.45}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this)},n.setProgress=function(e){this.inited&&(this.bar.scaleX=this.barStart+e*(this.barEnd-this.barStart))},t}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var BaseLine=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){},t}(egret.Bitmap);egret.registerClass(BaseLine,"BaseLine");var BlockUI=function(e){function t(){e.call(this),this.touchEnabled=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setSkin=function(e){this.touchEnabled=!0,this.texture=RES.getRes("block"+e+"_png"),this.skinID=e},n.hide=function(){var e=this;this.touchEnabled=!1,egret.Tween.get(this).to({alpha:.2},300,egret.Ease.quadOut).call(function(){e.parent&&e.parent.removeChild(e),ObjectPool.getPool(t.NAME).returnObject(e),e.alpha=1})},n.hideImmediately=function(){egret.Tween.removeTweens(this),this.touchEnabled=!1,this.parent&&this.parent.removeChild(this),this.alpha=1},t.NAME="BlockUI",t}(egret.Bitmap);egret.registerClass(BlockUI,"BlockUI");var Boom=function(e){function t(){e.call(this);var t=RES.getRes("boom_png"),i=RES.getRes("boom_json"),n=new egret.MovieClipDataFactory(i,t);this.movieClipData=n.generateMovieClipData("boom")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.playAnim=function(e){this.x=e.x-(140-e.width)/2,this.y=e.y-(140-e.height)/2,e.parent.addChild(this),this.addEventListener(egret.Event.COMPLETE,this.onComplete,this),this.gotoAndPlay(0,1)},n.onComplete=function(){this.parent&&this.parent.removeChild(this),ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="Boom",t}(egret.MovieClip);egret.registerClass(Boom,"Boom");var LineSu=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("line_su_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){var e=this;egret.Tween.get(this).to({alpha:.2},300).call(function(){e.parent&&e.parent.removeChild(e),e.alpha=1,ObjectPool.getPool(t.NAME).returnObject(e)},this)},t.NAME="LineSu",t}(BaseLine);egret.registerClass(LineSu,"LineSu");var LineZhe=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("line_zhe_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){var e=this;egret.Tween.get(this).to({alpha:.2},300).call(function(){e.parent&&e.parent.removeChild(e),e.alpha=1,ObjectPool.getPool(t.NAME).returnObject(e)},this)},t.NAME="LineZhe",t}(BaseLine);egret.registerClass(LineZhe,"LineZhe");var MessageBox=function(e){function t(){e.call(this,"MessageBoxSkin"),this._msg=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.msgLabel.text=this._msg,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onCloseTouch,this)},n.showMessage=function(e){this._msg=e,this.inited&&(this.msgLabel.text=e),LayerManager.getInstance().popLayer.addChild(this)},n.onCloseTouch=function(){this.parent&&this.parent.removeChild(this)},t}(BaseUI);egret.registerClass(MessageBox,"MessageBox");var SelectUI=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("select0_png")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.hide=function(){this.parent&&this.parent.removeChild(this)},n.play=function(e){this.x=e.x-(this.width-e.width)/2,this.y=e.y-(this.height-e.height)/2,e.parent.addChild(this)},t}(egret.Bitmap);egret.registerClass(SelectUI,"SelectUI");var StarParticle=function(e){function t(){e.call(this);var t=RES.getRes("skillBang_png"),i=RES.getRes("skillBang_json");this.system=new particle.GravityParticleSystem(t,i),this.addChild(this.system)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.play=function(){this.system.start()},n.stop=function(){this.system.stop()},t}(egret.DisplayObjectContainer);egret.registerClass(StarParticle,"StarParticle");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json?ver=1.0","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json?ver=1.0",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)
},n.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},n.onPreloadComplete=function(e){this.preloadScene=new PreloadScene,this.addChild(this.preloadScene),LoadManager.getInstance().loadGroup("game",this,this.onGameComplete,this.onGameProcess)},n.onGameProcess=function(e){this.preloadScene.setProgress(e.itemsLoaded/e.itemsTotal)},n.onGameComplete=function(e){this.preloadScene.parent&&this.removeChild(this.preloadScene),this.preloadScene=null,GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);