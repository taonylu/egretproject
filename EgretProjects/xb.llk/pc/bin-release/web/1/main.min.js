var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ArrayTool=function(){function e(){}var t=(__define,e);t.prototype;return e.randomArr=function(e){for(var t,i,n,s=e.length;s;)i=s-1,n=Math.floor(Math.random()*s),s--,i!=n&&(t=e[i],e[i]=e[n],e[n]=t)},e.copy2DArr=function(e){for(var t=new Array,i=e.length,n=e[0].length,s=0;i>s;s++){var r=new Array;t.push(r);for(var a=0;n>a;a++)r.push(e[s][a])}return t},e.getObjectLen=function(e){var t=0;for(var i in e)t++;return t},e}();egret.registerClass(ArrayTool,"ArrayTool");var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},n.onEnable=function(){},n.onRemove=function(){},n.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),i=t.prototype;return i.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.popLayer.touchThrough=!0,this.main.addChild(this.popLayer)},i.runScene=function(e,t){void 0===t&&(t=!1),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.sceneLayer.addChild(e),e.inited&&e.onEnable(),this.curScene=e},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.loadGroup=function(e,t,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.loadComplete[e]=i,this.loadError[e]=s,this.loadProgress[e]=n,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},i.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var i=this.loadComplete[t];null!=i&&i.call(this.thisObject[t],e),this.clearCallBack(t)},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},i.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},i.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var MapManager=function(){function e(){this.rowMax=10,this.colMax=9,this.level=new Array}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.getBlockNum=function(){for(var e=this.level.length,t=0,i=0;e>i;i++)for(var n=this.level[i],s=0;s<this.rowMax;s++)for(var r=0;r<this.colMax;r++)n[s][r]>0&&t++;return egret.log("方块总数:",t),t},e}();egret.registerClass(MapManager,"MapManager");var NumberTool=function(){function e(){}var t=(__define,e);t.prototype;return e.getRandomInt=function(e,t){return Math.round(Math.random()*(t-e))+e},e.getTimeString=function(e){var t="";return t=10>e?"0"+e:e.toString()},e}();egret.registerClass(NumberTool,"NumberTool");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),i=t.prototype;return i.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},i.returnObject=function(e){this.list.push(e)},e.getPool=function(t,i){if(void 0===i&&(i=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=i))for(var n=egret.getDefinitionByName(t),s=e.pool[t],r=0;i>r;r++)s.returnObject(new n);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var QRCodeLoader=function(e){function t(){e.apply(this,arguments),this.logoUrl=""}__extends(t,e);var i=(__define,t),n=i.prototype;return n.load=function(e,t,i,n){void 0===n&&(n=""),this.qrcodeWidth=t,this.qrcodeHeight=i,this.logoUrl=n;var s=new egret.ImageLoader;s.addEventListener(egret.Event.COMPLETE,this.onQRCodeComplete,this),s.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onQRCodeError,this),s.load(e)},n.onQRCodeError=function(){console.log("加载二维码错误")},n.onQRCodeComplete=function(e){var t=e.currentTarget,i=new egret.Bitmap(t.data);if(i.width=this.qrcodeWidth,i.height=this.qrcodeHeight,this.addChild(i),""!=this.logoUrl){var t=new egret.ImageLoader;t.addEventListener(egret.Event.COMPLETE,this.onlogoComplete,this),t.load(this.logoUrl)}},n.onlogoComplete=function(e){var t=e.currentTarget,i=new egret.Bitmap(t.data);i.width=this.qrcodeWidth/4,i.height=this.qrcodeHeight/4,i.x=(this.qrcodeWidth-i.width)/2,i.y=(this.qrcodeHeight-i.height)/2,this.addChild(i)},t}(egret.DisplayObjectContainer);egret.registerClass(QRCodeLoader,"QRCodeLoader");var SoundManager=function(){function e(){this.line="line",this.enterMan="enterMan",this.enterWoman="enterWoman",this.homeBgm="homeBgm",this.gameBgm="gameBgm",this.gameOver="gameOver",this.soundList={},this.channelList={},this.soundList[this.line]=RES.getRes("line_mp3"),this.soundList[this.enterMan]=RES.getRes("enter_man_mp3"),this.soundList[this.enterWoman]=RES.getRes("enter_woman_mp3"),this.soundList[this.homeBgm]=RES.getRes("bgm_home_mp3"),this.soundList[this.gameBgm]=RES.getRes("bgm_game_mp3"),this.soundList[this.gameOver]=RES.getRes("game_over_mp3")}var t=(__define,e),i=t.prototype;return i.play=function(e,t){void 0===t&&(t=1);var i=this.soundList[e];i&&(this.channelList[e]=i.play(0,t))},i.stop=function(e){var t=this.channelList[e];t&&t.stop()},i.playBgm=function(e){this.bgmChannel&&this.bgmChannel.stop();var t=this.soundList[e];t&&(this.bgmChannel=t.play())},i.stopBgm=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(SoundManager,"SoundManager");var UserManager=function(){function e(){this.luckyUser="",this.userList={}}var t=(__define,e),i=t.prototype;return i.storeUser=function(e){this.userList[e.uid]=e},i.getUser=function(e){return this.userList[e]},i.deleteUser=function(e){if(this.isExist(e)){var t=this.userList[e];t.clear()}delete this.userList[e]},i.isExist=function(e){return this.userList[e]?!0:!1},i.clear=function(){for(var e in this.userList){var t=this.userList[e];t.clear(),delete this.userList[e]}},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(UserManager,"UserManager");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function e(){this.homeScene=new HomeScene,this.gameScene=new GameScene}var t=(__define,e),i=t.prototype;return i.startup=function(e){this.socket=new ClientSocket,this.socket.homeScene=this.homeScene,this.socket.gameScene=this.gameScene,this.homeScene.socket=this.socket,this.gameScene.socket=this.socket,GameConst.stage=e.stage,LayerManager.getInstance().initialize(e),this.barrageUI=new BarrageUI,LayerManager.getInstance().popLayer.addChild(this.barrageUI),LayerManager.getInstance().runScene(this.homeScene),this.socket.startConnect(window.server)},i.onConnect=function(){this.sendLoginRequest()},i.revBarrage=function(e){var t=e.msg;this.barrageUI.showOneMsg(t)},i.sendLoginRequest=function(){var e={rid:window.srvConfig.rid};this.socket.sendMessage(NetConst.C2S_login,e,this.homeScene.revLogin,this.homeScene)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var UserVO=function(){function e(){this.uid="",this.name="",this.cancelBloukNum=0}var t=(__define,e),i=t.prototype;return i.clear=function(){this.headBmd=null,this.gameHeadUI&&(this.gameHeadUI.clear(),this.gameHeadUI=null),this.headUI&&(this.headUI.reset(),this.headUI=null)},e}();egret.registerClass(UserVO,"UserVO");var ClientSocket=function(){function e(){}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.startConnect=function(e){this.socket=io.connect(e,{reconnection:!1});var t=this;this.socket.on("connect",function(){t.onConnect()}),this.socket.on("error",function(e){t.onError(e)}),this.socket.on("disconnect",function(){t.onDisconnect()}),this.socket.on("reconnect_attempt",function(){t.onReconnectAttempt()}),this.socket.on(NetConst.S2C_barrage,function(e){GameManager.getInstance().revBarrage(e)}),this.socket.on(NetConst.S2C_userJoin,function(e){t.homeScene.revUserJoin(e)}),this.socket.on(NetConst.S2C_userQuit,function(e){t.homeScene.revUserQuit(e)}),this.socket.on(NetConst.S2C_gameStart,function(e){t.homeScene.revGameStart(e)}),this.socket.on(NetConst.S2C_eliminate,function(e){t.gameScene.revEliminate(e)}),this.socket.on(NetConst.S2C_pro,function(e){t.gameScene.revPro(e)}),this.socket.on(NetConst.S2C_luckyMap,function(e){t.gameScene.revLuckyMap(e)}),this.socket.on(NetConst.S2C_gameOver,function(e){t.gameScene.revGameOver(e)}),this.socket.on("countDown",function(e){t.homeScene.revCountDown(e)}),this.socket.on("clearCountDown",function(e){t.homeScene.revClearCountDown(e)})},i.onConnect=function(){egret.log("connenct succss"),GameManager.getInstance().onConnect()},i.onError=function(e){alert("连接失败，请尝试刷新网页"),egret.log("connenct erro")},i.onDisconnect=function(){alert("已与服务器断开连接，请尝试刷新网页"),egret.log("connenct close")},i.onReconnectAttempt=function(){egret.log("reconnect")},i.sendMessage=function(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this.socket.connected&&this.socket.emit(e,t,function(e){i&&n&&i.call(n,e)})},e}();egret.registerClass(ClientSocket,"ClientSocket");var NetConst=function(){function e(){}var t=(__define,e);t.prototype;return e.C2S_login="login",e.S2C_barrage="barrage",e.S2C_login="login",e.S2C_userJoin="userJoin",e.S2C_userQuit="userQuit",e.S2C_gameStart="gameStart",e.S2C_eliminate="eliminate",e.S2C_pro="pro",e.S2C_luckyMap="luckMap",e.S2C_mapData="mapData",e.S2C_gameOver="gameOver",e}();egret.registerClass(NetConst,"NetConst");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin"),this.snd=SoundManager.getInstance(),this.blockPool=ObjectPool.getPool(BlockUI.NAME,10),this.boomPool=ObjectPool.getPool(Boom.NAME,10),this.selectOld=new SelectUI,this.selectNew=new SelectUI,this.gameHeadUIList=new Array,this.lineSuPool=ObjectPool.getPool(LineSu.NAME,10),this.lineZhePool=ObjectPool.getPool(LineZhe.NAME,4),this.skillUIList=new Array,this.skillCount=0,this.nameLabelList=new Array,this.resultHeadList=new Array,this.resultTimeList=new Array,this.blockNum=0,this.blockData=new Array,this.tempMap=new Array,this.blockArr=new Array,this.rowMax=10,this.colMax=9,this.blockWidth=80,this.blockHeight=80,this.mapStartY=0,this.mapStartX=0,this.isSelect=!1,this.score=0,this.curLevel=1,this.totalScore=0,this.userMax=8,this.blockTotal=0,this.minRoadPoint=1e4,this.route=new Array}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.initView()},n.onEnable=function(){this.snd.playBgm(this.snd.gameBgm),this.startGame()},n.onRemove=function(){},n.reset=function(){},n.startGame=function(){this.curLevel=1,this.skillCount=0,this.blockTotal=MapManager.getInstance().getBlockNum(),this.hideResutl(),this.initGameHead(),this.createMap(),this.setLuckyInfo()},n.resetGame=function(){for(var e=0;e<this.rowMax;e++){for(var t=0;t<this.colMax;t++)null!=this.blockArr[e][t]&&this.blockArr[e][t].hideImmediately();this.blockArr[e].length=0}this.isSelect=!1,this.oldTarget=null,this.newTarget=null,this.blockNum=0,this.blockData.length=0,this.tempMap=null,this.selectOld.hide(),this.selectNew.hide()},n.gameOver=function(){console.log("game over")},n.nextLevel=function(){this.curLevel++,this.resetGame(),this.createMap()},n.initView=function(){this._stage=GameConst.stage;for(var e=0;e<this.rowMax;e++)this.blockArr.push(new Array);for(var e=0;4>e;e++)this.skillUIList.push(this["skillUI"+e]);for(var e=0;e<this.userMax;e++)this.gameHeadUIList.push(new GameHeadUI);for(var e=0;e<this.userMax;e++)this.nameLabelList.push(this["nameLabel"+e]),this.resultHeadList.push(this["resultHead"+e]),this.resultTimeList.push(this["resultTimeLabel"+e])},n.initGameHead=function(){var e,t,i=UserManager.getInstance().userList,n=0;for(var s in i)e=i[s],t=this.gameHeadUIList[n],t.x=0,n++,t.setHeadBmd(e.headBmd),e.gameHeadUI=t,this.headGroup.addChild(t)},n.moveGameHead=function(e){var t=UserManager.getInstance().userList[e];if(t){var i=t.gameHeadUI;i.x=t.cancelBloukNum/this.blockTotal*this.headGroup.width}},n.showResult=function(e){this.skillGroup.visible=!1,this.skillIntroGroup.visible=!1,this.gameOverBg.visible=!0,this.gameOverText.visible=!0,this.resultGroup.visible=!0;for(var t=0;t<this.userMax;t++)if(this.nameLabelList[t].text="",this.resultTimeList[t].text="",null!=e.winners[t]){var i=e.winners[t].uid,n=e.winners[t].spend,s=UserManager.getInstance().getUser(i);if(s){this.nameLabelList[t].text=s.name;var r=new egret.Bitmap(s.headBmd);if(r.width=65,r.height=65,this.resultHeadList[t].addChild(r),n>0){var a=Math.floor(n/1e3/60),o=Math.floor(n/1e3%60);this.resultTimeList[t].text=NumberTool.getTimeString(a)+":"+NumberTool.getTimeString(o)}else this.resultTimeList[t].text="0"}}},n.hideResutl=function(){this.skillGroup.visible=!0,this.skillIntroGroup.visible=!0,this.gameOverBg.visible=!1,this.gameOverText.visible=!1,this.resultGroup.visible=!1;for(var e=0;e<this.userMax;e++)if(this.resultHeadList[e].numChildren>0){var t=this.resultHeadList[e].getChildAt(0);t&&t.parent&&t.parent.removeChild(t)}},n.setLuckyInfo=function(){if(this.luckyGroup.visible=!1,this.luckyHeadGroup.numChildren>0){var e=this.luckyHeadGroup.getChildAt(0);e&&e.parent&&e.parent.removeChild(e)}this.luckNameLabel.text="";var t=UserManager.getInstance(),i=t.getUser(t.luckyUser);if(i){this.luckyGroup.visible=!0;var n=new egret.Bitmap(i.headBmd);n.width=55,n.height=55,this.luckyHeadGroup.addChild(n),this.luckNameLabel.text=i.name}},n.createMap=function(){var e=MapManager.getInstance().level[this.curLevel-1];if(null!=e){this.tempMap=ArrayTool.copy2DArr(e);for(var t=0,i=0;i<this.rowMax;i++)for(var n=0;n<this.colMax;n++)if(this.tempMap[i][n]>0){var s=this.blockPool.getObject();s.setSkin(this.tempMap[i][n]),s.row=i,s.col=n,s.x=this.mapStartX+n*this.blockWidth,s.y=this.mapStartY+i*this.blockHeight-this._stage.stageHeight,this.blockGroup.addChild(s),this.blockArr[s.row][s.col]=s,egret.Tween.get(s).to({y:this.mapStartY+i*this.blockHeight},500),t++}}},n.checkRoad=function(e,t){var i=e.row,n=e.col,s=t.row,r=t.col,a=!1;if(i==s){if(this.lineCheck(i,n,s,r))return this.saveLinePath(i,n,s,r),!0;for(var o=0;o<this.rowMax;o++)0==this.tempMap[o][n]&&0==this.tempMap[o][r]&&this.lineCheck(i,n,o,n)&&this.lineCheck(o,n,o,r)&&this.lineCheck(o,r,s,r)&&(this.theShortest(i,n,o,n,o,r,s,r),a=!0)}else if(n==r){if(this.lineCheck(i,n,s,r))return this.saveLinePath(i,n,s,r),!0;for(o=0;o<this.colMax;o++)0==this.tempMap[i][o]&&0==this.tempMap[s][o]&&this.lineCheck(i,n,i,o)&&this.lineCheck(i,o,s,o)&&this.lineCheck(s,o,s,r)&&(this.theShortest(i,n,i,o,s,o,s,r),a=!0)}else{if(0==this.tempMap[s][n]&&this.lineCheck(i,n,s,n)&&this.lineCheck(s,n,s,r))return this.saveLinePath(i,n,s,n),this.route.pop(),this.saveLinePath(s,n,s,r),!0;if(0==this.tempMap[i][r]&&this.lineCheck(i,n,i,r)&&this.lineCheck(s,r,i,r))return this.saveLinePath(i,n,i,r),this.route.pop(),this.saveLinePath(i,r,s,r),!0;for(o=0;o<this.colMax;o++)0==this.tempMap[i][o]&&0==this.tempMap[s][o]&&this.lineCheck(i,n,i,o)&&this.lineCheck(i,o,s,o)&&this.lineCheck(s,o,s,r)&&(this.theShortest(i,n,i,o,s,o,s,r),a=!0);for(o=0;o<this.rowMax;o++)0==this.tempMap[o][n]&&0==this.tempMap[o][r]&&this.lineCheck(i,n,o,n)&&this.lineCheck(o,n,o,r)&&this.lineCheck(o,r,s,r)&&(this.theShortest(i,n,o,n,o,r,s,r),a=!0)}return a},n.lineCheck=function(e,t,i,n){if(e==i){if(t>n){var s=t;t=n,n=s}if(t+1==n)return!0;for(var r=t+1;n>r;r++)if(this.tempMap[e][r]>0)return!1;return!0}if(t==n){if(e>i&&(s=e,e=i,i=s),e+1==i)return!0;for(r=e+1;i>r;r++)if(this.tempMap[r][t]>0)return!1;return!0}return!1},n.saveLinePath=function(e,t,i,n){if(e==i)if(t>n)for(var s=t;s>=n;s--)this.route.push({x:s,y:e});else for(var s=t;n>=s;s++)this.route.push({x:s,y:e});else if(t==n)if(e>i)for(var s=e;s>=i;s--)this.route.push({x:t,y:s});else for(var s=e;i>=s;s++)this.route.push({x:t,y:s})},n.linkRoad=function(){for(var e=this.route.length-1,t=new Array,i=0;e>i;i++){var n=this.route[i],s=this.route[i+1];if(e>=i+2)var r=this.route[i+2],a=r.x,o=r.y;if(i+1==e)break;var h=n.x,l=n.y,c=s.x,u=s.y;if(console.log(l,h,u,c),h!=c||null!=r&&c!=a)if(l!=u||null!=r&&u!=o){if(r){var g=this.lineZhePool.getObject();g.x=c*this.blockWidth+this.blockWidth/2,g.y=u*this.blockHeight+this.blockHeight/2,this.blockGroup.addChild(g),t.push(g),h==c&&u>l&&u==o&&a>c||l==u&&h>c&&c==a&&u>o?(g.rotation=0,console.log("L")):h==c&&l>u&&u==o&&a>c||l==u&&h>c&&c==a&&o>u?(g.rotation=90,console.log("|-")):l==u&&c>h&&c==a&&o>u||h==c&&l>u&&u==o&&c>a?(g.rotation=180,console.log("-|")):(g.rotation=270,console.log("_|"))}}else{var d=this.lineSuPool.getObject();d.rotation=90,d.x=c*this.blockWidth+this.blockWidth/2,d.y=u*this.blockHeight+this.blockHeight/2,t.push(d),this.blockGroup.addChild(d),console.log("同行")}else{var d=this.lineSuPool.getObject();d.rotation=0,d.x=c*this.blockWidth+this.blockWidth/2,d.y=u*this.blockHeight+this.blockHeight/2,t.push(d),this.blockGroup.addChild(d),console.log("同列")}}this.route.length=0,this.minRoadPoint=1e4;for(var e=t.length,i=0;e>i;i++)t[i].recycle()},n.theShortest=function(e,t,i,n,s,r,a,o){var h=0;h=Math.abs(i-e)+Math.abs(s-i)+Math.abs(a-s)+Math.abs(n-t)+Math.abs(r-n)+Math.abs(o-r),h<=this.minRoadPoint&&(this.route.length=0,this.saveLinePath(e,t,i,n),this.route.pop(),this.saveLinePath(i,n,s,r),this.route.pop(),this.saveLinePath(s,r,a,o),this.minRoadPoint=h)},n.cancelBlock=function(e,t){if(this.checkRoad(e,t)){this.linkRoad();var i=this.boomPool.getObject(),n=this.boomPool.getObject();i.playAnim(e),n.playAnim(t),e.hide(),t.hide(),this.tempMap[e.row][e.col]=0,this.tempMap[t.row][t.col]=0,this.blockArr[e.row][e.col]=null,this.blockArr[t.row][t.col]=null,this.checkGameOver()&&this.nextLevel()}},n.checkGameOver=function(){for(var e=0;e<this.rowMax;e++)for(var t=0;t<this.colMax;t++)if(this.tempMap[e][t]>0)return!1;return!0},n.tishi=function(){this.oldTarget&&this.selectOld.hide(),this.newTarget&&this.selectNew.hide(),this.oldTarget=null,this.newTarget=null,this.isSelect=!1,this.bangzhu()&&(egret.log("提示方块:",this.oldTarget.row,this.oldTarget.col,this.newTarget.row,this.newTarget.col),this.selectOld.play(this.oldTarget),this.selectNew.play(this.newTarget))},n.bangzhu=function(){for(var e=0;e<this.rowMax;e++)for(var t=0;t<this.colMax;t++)if(this.tempMap[e][t]>0)for(var i=e;i<this.rowMax;i++){var n;for(n=i==e?t+1:0;n<this.colMax;n++)if(this.tempMap[i][n]>0){var s=this.blockArr[e][t],r=this.blockArr[i][n];if(s.skinID==r.skinID&&this.checkRoad(s,r))return this.route.length=0,this.oldTarget=s,this.newTarget=r,!0}}return!1},n.revEliminate=function(e){var t=e.uid,i=e.pos;if(egret.log("玩家消除方块:",t,i),UserManager.getInstance().userList[t].cancelBloukNum+=2,this.moveGameHead(t),t==UserManager.getInstance().luckyUser){var n=this.blockArr[i[0][0]][i[0][1]],s=this.blockArr[i[1][0]][i[1][1]];n&&s&&(this.snd.play(this.snd.line),this.cancelBlock(n,s))}},n.revPro=function(e){var t=e.from,i=e.to,n=e.type,s=e.mapData,r=e.time;egret.log("使用道具:"+t,i,n,s,r),egret.log("是否大屏幕:",UserManager.getInstance().luckyUser==i);var a="";switch(n){case"disturb":a="打乱",UserManager.getInstance().luckyUser==i&&(MapManager.getInstance().level[this.curLevel-1]=s,this.resetGame(),this.createMap());break;case"ice":if(a="冻结",UserManager.getInstance().luckyUser==i){this.skillIce.visible=!0;var o=this;egret.Tween.removeTweens(this.skillIce),egret.Tween.get(this.skillIce).wait(r).call(function(){o.skillIce.visible=!1})}break;case"find":a="提示",UserManager.getInstance().luckyUser==i&&this.tishi()}if(""!=a&&UserManager.getInstance().getUser(t).headBmd&&UserManager.getInstance().getUser(i).headBmd){var h=new egret.Bitmap(UserManager.getInstance().getUser(t).headBmd),l=new egret.Bitmap(UserManager.getInstance().getUser(i).headBmd),c=this.skillCount%4;this.skillUIList[c].setSkill(h,l,a),this.skillCount++}},n.revLuckyMap=function(e){var t=e.mapData;MapManager.getInstance().level[this.curLevel-1]=t,this.resetGame(),this.createMap()},n.revGameOver=function(e){var t=(e.winners,e.rankLast);egret.log("游戏结束"),this.snd.play(this.snd.gameOver),this.showResult(e);var i=this;egret.Tween.get(this).wait(t).call(function(){i.resetGame(),UserManager.getInstance().clear(),LayerManager.getInstance().runScene(GameManager.getInstance().homeScene)},this)},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var HomeScene=function(e){function t(){e.call(this,"HomeSceneSkin"),this.snd=SoundManager.getInstance(),this.userMax=8,this.timeLimit=20,this.countDownTimer=new egret.Timer(1e3)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.initView()},n.onEnable=function(){this.snd.playBgm(this.snd.homeBgm),this.showShaLou()},n.onRemove=function(){},n.reset=function(){},n.initView=function(){this.headUIList=new Array;for(var e=0;e<this.userMax;e++)this.headUIList.push(this["headUI"+e]);var t=new QRCodeLoader;t.load(window.qrcodeUrl,window.codeWidth,window.codeHeight,window.logoUrl),this.qrcodeGroup.addChild(t),this.gameIntroLabel.text="1 扫描二维码，进入房间，点击“加入游戏”开始排队，每局最多8名玩家\n\n2 当玩家达到4名就开始倒计时，倒计时期间新玩家也可以加入游戏\n\n3 每局游戏有三个关卡，只要有三位玩家完成三关，游戏结束\n\n4 游戏期间借助道具让你更有优势\n"},n.showShaLou=function(){this.shaLou.visible=!0,this.countDownLabel.visible=!1},n.resetHeadUI=function(){for(var e=this.headUIList.length,t=0;e>t;t++)this.headUIList[t].reset()},n.startCountDown=function(){this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.reset(),this.countDownTimer.start(),this.countDownLabel.visible=!0,this.timeLimit<10?this.countDownLabel.text="0"+this.timeLimit.toString():this.countDownLabel.text=this.timeLimit.toString()},n.onCountDownHandler=function(e){var t=this.timeLimit-this.countDownTimer.currentCount;return 0>t?void this.stopCountDown():void(10>t?this.countDownLabel.text="0"+t.toString():this.countDownLabel.text=t.toString())},n.stopCountDown=function(){this.countDownTimer.removeEventListener(egret.TimerEvent.TIMER,this.onCountDownHandler,this),this.countDownTimer.stop()},n.revLogin=function(e){var t=e;switch(egret.log("登录返回，房间状态：",t),t){case 1:break;case 0:break;case-1:}},n.revUserJoin=function(e){var t=e.headimgurl,i=e.nickname,n=e.uid,s=e.sex;egret.log("玩家加入,头像:"+t,"名字:"+i,"ID:"+n,"sex:",s);var r=new UserVO;r.uid=n,r.name=i,UserManager.getInstance().storeUser(r);for(var a,o=0;o<this.userMax;o++)if(a=this.headUIList[o],a.isEmpty()){r.headUI=a,a.userID=n,a.setNameLabel(i),a.loadImg(t),1==s?this.snd.play(this.snd.enterMan):2==s&&this.snd.play(this.snd.enterWoman);break}},n.revCountDown=function(e){var t=e.time;egret.log("倒计时:"+t),this.timeLimit=t/1e3,this.shaLou.visible=!1,this.startCountDown()},n.revClearCountDown=function(e){egret.log("停止倒计时"),this.stopCountDown(),this.showShaLou()},n.revUserQuit=function(e){var t=e.uid;egret.log("玩家退出:",t),UserManager.getInstance().deleteUser(t)},n.revGameStart=function(e){var t=e.mapData,i=e.luckyUser;egret.log("游戏开始，幸运用户:",i),MapManager.getInstance().level.length=0,MapManager.getInstance().level.push(t[0],t[1],t[2]),UserManager.getInstance().luckyUser=i,LayerManager.getInstance().runScene(GameManager.getInstance().gameScene)},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var BarrageUI=function(e){function t(){e.call(this),this.textList=new Array,this.textMax=20,this.colorList=[16711680,16127176,9114814,255,11349787],this.msgPool=new Array,this.width=GameConst.stage.stageWidth,this.height=GameConst.stage.stageHeight,this.touchChildren=!1,this.touchEnabled=!1;for(var t=0;t<this.textMax;t++){var i=new egret.TextField;i.size=100,i.fontFamily="微软雅黑, 黑体",this.textList.push(i)}}__extends(t,e);var i=(__define,t),n=i.prototype;return n.showOneMsg=function(e){var t=this.textList.pop();if(null!=t){t.textColor=this.colorList[NumberTool.getRandomInt(0,this.colorList.length-1)],t.text=e,t.x=GameConst.stage.stageWidth+t.width,t.y=200+Math.random()*(GameConst.stage.stageHeight-400),this.addChild(t);var i=this;egret.Tween.get(t).to({x:-t.width},1e4).call(function(){i.textList.push(t),i.msgPool.length>0&&i.showOneMsg(i.msgPool.shift())})}else this.msgPool.push(e)},t}(egret.DisplayObjectContainer);egret.registerClass(BarrageUI,"BarrageUI");var BaseLine=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){},t}(egret.Bitmap);egret.registerClass(BaseLine,"BaseLine");var BlockUI=function(e){function t(){e.call(this),this.touchEnabled=!0}__extends(t,e);var i=(__define,t),n=i.prototype;return n.setSkin=function(e){this.touchEnabled=!0,this.texture=RES.getRes("block"+e+"_png"),this.skinID=e},n.hide=function(){var e=this;this.touchEnabled=!1,egret.Tween.get(this).to({alpha:.2},300,egret.Ease.quadOut).call(function(){e.parent&&e.parent.removeChild(e),ObjectPool.getPool(t.NAME).returnObject(e),e.alpha=1})},n.hideImmediately=function(){egret.Tween.removeTweens(this),this.touchEnabled=!1,this.parent&&this.parent.removeChild(this),this.alpha=1},t.NAME="BlockUI",t}(egret.Bitmap);egret.registerClass(BlockUI,"BlockUI");var Boom=function(e){function t(){e.call(this);var t=RES.getRes("boom_png"),i=RES.getRes("boom_json"),n=new egret.MovieClipDataFactory(i,t);this.movieClipData=n.generateMovieClipData("boom")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.playAnim=function(e){this.x=e.x-(140-e.width)/2,this.y=e.y-(140-e.height)/2,e.parent.addChild(this),this.addEventListener(egret.Event.COMPLETE,this.onComplete,this),this.gotoAndPlay(0,1)},n.onComplete=function(){this.parent&&this.parent.removeChild(this),ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="Boom",t}(egret.MovieClip);egret.registerClass(Boom,"Boom");var GameHeadUI=function(e){function t(){e.call(this,"GameHeadUISkin"),this.headImg=new egret.Bitmap,this.imgWidth=55,this.imgHeight=55}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.addChild(this.headImg),this.addChild(this.headMask),this.anchorOffsetX=this.width/2},n.setHeadBmd=function(e){this.headImg.bitmapData=e,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headImg.x=23,this.headImg.y=20},n.clear=function(){this.parent&&this.parent.removeChild(this),this.headImg.bitmapData=null},t}(BaseUI);egret.registerClass(GameHeadUI,"GameHeadUI");var HeadUI=function(e){function t(){e.call(this,"HeadUISkin"),this.imgX=10,this.imgY=17,this.imgWidth=45,this.imgHeight=45,this.imageLoader=new egret.ImageLoader}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.headImg=new egret.Bitmap,this.headImg.x=this.imgX,this.headImg.y=this.imgY,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headImg.mask=this.headMask,this.addChild(this.headImg)},n.setNameLabel=function(e){this.nameLabel.text=e},n.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},n.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data,UserManager.getInstance().isExist(this.userID)&&(UserManager.getInstance().getUser(this.userID).headBmd=t.data)},n.onLoadError=function(){egret.log("加载头像错误")},n.isEmpty=function(){return""==this.nameLabel.text?!0:!1},n.reset=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.userID=""},t}(BaseUI);egret.registerClass(HeadUI,"HeadUI");var LineSu=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("line_su_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){var e=this;egret.Tween.get(this).to({alpha:.2},300).call(function(){e.parent&&e.parent.removeChild(e),e.alpha=1,ObjectPool.getPool(t.NAME).returnObject(e)},this)},t.NAME="LineSu",t}(BaseLine);egret.registerClass(LineSu,"LineSu");var LineZhe=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("line_zhe_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){var e=this;egret.Tween.get(this).to({alpha:.2},300).call(function(){e.parent&&e.parent.removeChild(e),e.alpha=1,ObjectPool.getPool(t.NAME).returnObject(e)},this)},t.NAME="LineZhe",t}(BaseLine);egret.registerClass(LineZhe,"LineZhe");var SelectUI=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("select0_png")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.hide=function(){this.parent&&this.parent.removeChild(this)},n.play=function(e){this.x=(this.width-e.width)/2,this.y-(this.height-e.height)/2,e.parent.addChild(this)},t}(egret.Bitmap);egret.registerClass(SelectUI,"SelectUI");var SkillUI=function(e){function t(){e.call(this,"SkillUISkin")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.staticLabel0.visible=!1,this.staticLabel1.visible=!1,this.staticLabel2.visible=!1},n.setSkill=function(e,t,i){this.staticLabel0.visible=!0,this.staticLabel1.visible=!0,this.staticLabel2.visible=!0,this.toolLabel.text=i,e.width=80,e.height=80,t.width=80,t.height=80,this.headGroup0.addChild(e),this.headGroup1.addChild(t)},n.clear=function(){this.toolLabel.text="",this.staticLabel0.visible=!1,this.staticLabel1.visible=!1,this.staticLabel2.visible=!1;var e=this.headGroup0.getChildAt(0);e&&(e.parent&&e.parent.removeChild(e),e=null),e=this.headGroup1.getChildAt(0),e&&(e.parent&&e.parent.removeChild(e),e=null)},t}(BaseUI);egret.registerClass(SkillUI,"SkillUI");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var i=(__define,t),n=i.prototype;
return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},n.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},n.onPreloadComplete=function(e){LoadManager.getInstance().loadGroup("game",this,this.onGameComplete,this.onGameProcess)},n.onGameProcess=function(e){},n.onGameComplete=function(e){GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);