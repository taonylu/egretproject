var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?o(s):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),o=n.prototype;return o.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},o.onEnable=function(){},o.onRemove=function(){},o.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),o=n.prototype;return o.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),n=t.prototype;return n.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.main.addChild(this.popLayer)},n.runScene=function(e,t){void 0===t&&(t=!1),this.sceneLayer.addChild(e),e.inited&&e.onEnable(),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.curScene=e},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.loadGroup=function(e,t,n,o,s){void 0===n&&(n=null),void 0===o&&(o=null),void 0===s&&(s=null),this.loadComplete[e]=n,this.loadError[e]=s,this.loadProgress[e]=o,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},n.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var n=this.loadComplete[t];null!=n&&n.call(this.thisObject[t],e),this.clearCallBack(t)},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},n.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},n.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),n=t.prototype;return n.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},n.returnObject=function(e){this.list.push(e)},e.getPool=function(t,n){if(void 0===n&&(n=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=n))for(var o=egret.getDefinitionByName(t),s=e.pool[t],i=0;n>i;i++)s.returnObject(new o);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var GameManager=function(){function e(){}var t=(__define,e),n=t.prototype;return n.startup=function(e){this.isMobile=egret.Capabilities.isMobile,this.isMobile?(e.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,e.stage.orientation=egret.OrientationMode.PORTRAIT,e.stage.setContentSize(450,800),this.homeScene=new HomeScene("HomeSceneSkin"),this.gameScene=new GameScene):(e.stage.setContentSize(800,450),e.stage.scaleMode=egret.StageScaleMode.SHOW_ALL,e.stage.orientation=egret.OrientationMode.LANDSCAPE,this.homeScene=new HomeScene("PCHomeSceneSkin"),this.gameScene=new GameScene);var t=new ClientSocket;t.homeScene=this.homeScene,t.gameScene=this.gameScene,t.startConnect(NetConst.url),GameConst.stage=e.stage,LayerManager.getInstance().initialize(e),LayerManager.getInstance().runScene(this.homeScene)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var ClientSocket=function(){function e(){}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.startConnect=function(e){this.homeScene.setMsgLabel("连接中..."),this.socket=io.connect(e);var t=this;this.socket.on("connect",function(){t.onConnect()}),this.socket.on("error",function(e){t.onError(e)}),this.socket.on("disconnect",function(){t.onDisconnect()}),this.socket.on("reconnect_attempt",function(){t.onReconnectAttempt()}),this.socket.on(NetConst.screenReady,function(e){t.homeScene.revScreenReady(e)}),this.socket.on(NetConst.userJoin,function(e){t.homeScene.revUserJoin(e)}),this.socket.on(NetConst.userQuit,function(e){t.homeScene.revUserQuit(e)}),this.socket.on(NetConst.gameStart,function(e){t.homeScene.revGameStart(e)}),this.socket.on(NetConst.eliminate,function(e){t.gameScene.revEliminate(e)}),this.socket.on(NetConst.pro,function(e){t.gameScene.revPro(e)}),this.socket.on(NetConst.userPro,function(e){t.gameScene.revUserPro(e)}),this.socket.on(NetConst.luckyMap,function(e){t.gameScene.revLuckyMap(e)}),this.socket.on(NetConst.gameOver,function(e){t.gameScene.revGameOver(e)})},n.onConnect=function(){this.homeScene.setMsgLabel("连接成功")},n.onError=function(e){this.homeScene.setMsgLabel("连接失败")},n.onDisconnect=function(){this.homeScene.setMsgLabel("已断开连接")},n.onReconnectAttempt=function(){this.homeScene.setMsgLabel("尝试重新连接...")},n.sendMessage=function(e,t){console.log("send:"+t),this.socket.emit(e,t)},e}();egret.registerClass(ClientSocket,"ClientSocket");var NetConst=function(){function e(){}var t=(__define,e);t.prototype;return e.url="http://192.168.1.103:3000",e.screenReady="screenReady",e.userJoin="userJoin",e.userQuit="userQuit",e.gameStart="gameStart",e.eliminate="eliminate",e.pro="pro",e.userPro="userPro",e.luckyMap="luckMap",e.gameOver="gameOver",e.levelDone="levelDone",e}();egret.registerClass(NetConst,"NetConst");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin")}__extends(t,e);var n=(__define,t),o=n.prototype;return o.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance(),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},o.onEnable=function(){},o.onRemove=function(){},o.startGame=function(){},o.resetGame=function(){},o.gameOver=function(){},o.sendEliminate=function(e){this.socket.sendMessage(NetConst.eliminate,e)},o.sendUserPro=function(e){this.socket.sendMessage(NetConst.userPro,e)},o.sendLevelDone=function(e,t){this.socket.sendMessage(NetConst.levelDone,{isFinish:e,mapData:t})},o.revEliminate=function(e){e.id,e.pos},o.revPro=function(e){e.type,e.mapData},o.revUserPro=function(e){e.status,e.data.change},o.revLuckyMap=function(e){e.mapdata},o.revGameOver=function(e){if(egret.Capabilities.isMobile){e.rank}else{e.winners}},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var HomeScene=function(e){function t(t){e.call(this,t)}__extends(t,e);var n=(__define,t),o=n.prototype;return o.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance()},o.onEnable=function(){},o.onRemove=function(){},o.setMsgLabel=function(e){this.msgLabel.text=e},o.revScreenReady=function(e){var t=(e.status,e.msg);this.setMsgLabel(t)},o.revUserJoin=function(e){e.avatar,e.name,e.id},o.revUserQuit=function(e){e.id},o.revGameStart=function(e){e.mapData,e.luckyUser},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var PreloadScene=function(e){function t(){e.call(this,"PreloadSceneSkin")}__extends(t,e);var n=(__define,t),o=n.prototype;return o.componentCreated=function(){e.prototype.componentCreated.call(this)},o.onEnable=function(){},o.onRemove=function(){},t}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),o=n.prototype;return o.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},o.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},o.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},o.onPreloadComplete=function(e){LoadManager.getInstance().loadGroup("game",this,this.onGameComplete,this.onGameProcess)},o.onGameProcess=function(e){},o.onGameComplete=function(e){GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,o){function s(e){t.call(o,e)}function i(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),n.call(o))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);