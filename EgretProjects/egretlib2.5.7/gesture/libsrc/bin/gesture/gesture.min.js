var __define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},PropGesture=function(){function e(e,t,i,s,n,r,o,u){void 0===t&&(t="executeGestureRecognizedCallback"),void 0===i&&(i="checkGesture"),void 0===s&&(s="updateValue"),void 0===n&&(n=null),void 0===r&&(r=!1),void 0===o&&(o=0),void 0===u&&(u=1),this.n=0,this.p=!0,this.pr=0,this.t=e,this.c=r,n&&(n._prev=this,this._next=n),this.p0=t,this.p1=i,this.p2=s,this.n=u}var t=e;return p=t.prototype,e}();egret.registerClass(PropGesture,"PropGesture");var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},GestureEvent=function(e){function t(t,i,s){void 0===s&&(s=""),this.gm=i,this.state=s,e.call(this,t,!1,null)}__extends(t,e);var i=t;return p=i.prototype,t.ACHE_GESTURE="acheGesture",t}(egret.Event);egret.registerClass(GestureEvent,"GestureEvent");var __define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},GestureRecognizerPlugin=function(){function e(e,t,i,s,n){void 0===e&&(e=""),void 0===t&&(t=0),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===n&&(n=1),this._failed=!1,this._priority=0,this._numTouchesRequired=1,this._continuous=!1,this._possible=!0,this._gestureType=e,this._continuous=s,this._requireGestureRecognizerToFail=i,this._priority=t||0,this._numTouchesRequired=n}var t=e;return p=t.prototype,e.activate=function(e){for(var t=e.length;--t>-1;)GestureManager._gesturePlugins[(new e[t])._gestureName]=e[t]},p._onInitGesture=function(e,t,i){return this._callBack=e,this._config=t,this._g=i,null!=this._config&&null!=this._config.shouldReceiveTouch&&(this._shouldReceiveTouch=this._config.shouldReceiveTouch),this._result=new GestureEvent(GestureEvent.ACHE_GESTURE,this._g),!0},p.executeGestureRecognizedCallback=function(){this._callBack.recognized&&(this._result.state=GestureState.RECOGNIZED,this._callBack.recognized(this._result))},p.checkGesture=function(){return!1},p.updateValue=function(){return!0},p.gesturePossible=function(e){this._possible=e,this._callBack.possible&&(this._result.state=GestureState.POSSIBLE,this._result.possible=e,this._callBack.possible(this._result))},p.gestureBegan=function(){this._callBack.began&&(this._result.state=GestureState.BEGAN,this._callBack.began(this._result))},p.gestureEnded=function(){this._callBack.ended&&(this._result.state=GestureState.ENDED,this._callBack.ended(this._result))},e}();egret.registerClass(GestureRecognizerPlugin,"GestureRecognizerPlugin");var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},PinchGestureRecognizer=function(e){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=!1),e.call(this,GestureType.PINCH,t,i,!0,2),this._cx=0,this._cy=0,this._offsetX=0,this._offsetY=0,this.pZero=new egret.Point}__extends(t,e);var i=t;return p=i.prototype,p.checkGesture=function(e){if(2!=e.length)return this._cx=0,this._offsetX=this._offsetY=0,!1;var t=e[0],i=e[1];return t.type==egret.TouchEvent.TOUCH_END||i.type==egret.TouchEvent.TOUCH_END?(this._cx=0,this._offsetX=this._offsetY=0,!1):0!=this._cx?!0:(this._cx=.5*(t.stageX+i.stageX),this._cy=.5*(t.stageY+i.stageY),this._d1X=t.stageX-i.stageX,this._d1Y=t.stageY-i.stageY,this._localLocation=this._g.target.globalToLocal(this._cx,this._cy,this._localLocation),this._callBack.changed&&(this._result.dx=this._offsetX,this._result.dy=this._offsetY,this._result.dScale=1,this._result.localLocation=this._localLocation,this._callBack.changed(this._result)),!0)},p.updateValue=function(e){if(2!=e.length)return this._cx=0,!1;var t=e[0],i=e[1];if(t.type==egret.TouchEvent.TOUCH_END||i.type==egret.TouchEvent.TOUCH_END)return this._cx=0,this._offsetX=this._offsetY=0,!1;var s=this._cx,n=this._cy;this._cx=.5*(t.stageX+i.stageX),this._cy=.5*(t.stageY+i.stageY),this._offsetX=this._cx-s,this._offsetY=this._cy-n,this._d2X=t.stageX-i.stageX,this._d2Y=t.stageY-i.stageY,this._localLocation=this._g.target.globalToLocal(this._cx,this._cy,this._localLocation);var r=egret.Point.distance(new egret.Point(this._d2X,this._d2Y),this.pZero)/egret.Point.distance(new egret.Point(this._d1X,this._d1Y),this.pZero);return this._d1X=this._d2X,this._d1Y=this._d2Y,this._callBack.changed&&(this._result.dx=this._offsetX,this._result.dy=this._offsetY,this._result.dScale=r,this._result.localLocation=this._localLocation,this._callBack.changed(this._result)),!0},t}(GestureRecognizerPlugin);egret.registerClass(PinchGestureRecognizer,"PinchGestureRecognizer");var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);i.prototype=t.prototype,e.prototype=new i},__define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},DoubleTapGestureRecognizer=function(e){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=!1),e.call(this,GestureType.DOUBLE_TAP,t,i),this._interval=300,this._max_dist=80,this._count=0,this._validate=!1,this._sx=0,this._sy=0,this._t=new egret.Timer(this._interval,1),this._t.addEventListener(egret.TimerEvent.TIMER,this.onCheck,this),this._count=0}__extends(t,e);var i=t;return p=i.prototype,p.checkGesture=function(e){var t,i=e[0];return i.type==egret.TouchEvent.TOUCH_BEGIN&&0==this._count&&(this._failed=!1),i.type==egret.TouchEvent.TOUCH_MOVE,i.type==egret.TouchEvent.TOUCH_END&&(0==this._count?(this._count+=1,this._validate=!0,this._t.reset(),this._t.start(),this._sx=i.stageX,this._sy=i.stageY):1==this._count&&(this._validate&&Math.abs(i.stageX-this._sx)<this._max_dist&&Math.abs(i.stageY-this._sy)<this._max_dist&&(t=!0),this._count=0,this._t.stop())),t},p.onCheck=function(){this._failed=!0,this._validate=!1,this._count=0,this._requireGestureRecognizerToFail&&this._g.gestureRecognizerStateChange(this._gestureType,!1)},t}(GestureRecognizerPlugin);egret.registerClass(DoubleTapGestureRecognizer,"DoubleTapGestureRecognizer");var __define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},GestureType=function(){function e(){}var t=e;return p=t.prototype,e.DOUBLE_TAP="doubleTap",e.PINCH="pinch",e}();egret.registerClass(GestureType,"GestureType");var __define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},GestureState=function(){function e(){}var t=e;return p=t.prototype,e.POSSIBLE="possible",e.RECOGNIZED="recognized",e.FAILED="failed",e.BEGAN="began",e.CHANGED="changed",e.ENDED="ended",e.CANCELLED="cancelled",e}();egret.registerClass(GestureState,"GestureState");var __define=this.__define||function(e,t,i,s){Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:i,set:s})},GestureManager=function(){function e(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!1),this._ref={},this._ts=[],this._touchEventPool=[],this.vars=t||{},this.target=e,e.touchEnabled=!0,this._allowSimultaneous=i,this._initGesture()}var t=__define,i=e;return p=i.prototype,p._initGesture=function(){var t,i;for(t in this.vars)t in e._gesturePlugins&&(i=new e._gesturePlugins[t])._onInitGesture(this.vars[t],this.vars[t].config,this)&&(this._firstG=new PropGesture(i,"executeGestureRecognizedCallback","checkGesture","updateValue",this._firstG,i._continuous,i._priority,i._numTouchesRequired),this._ref[i._gestureType]=this._firstG);this.linkGestureCondition(),this.target.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouched,this),this.target.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouched,this),this.target.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouched,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.leaveStage,this)},p.leaveStage=function(){for(;this._ts.length>0;){var e=this._ts.splice(0,1)[0];this._touchEventPool.push(e)}},p.linkGestureCondition=function(){for(var e=this._firstG;e;){if(e.t._callBack.hasOwnProperty("requireGestureToFail")&&null!=e.t._callBack.requireGestureToFail){var t=this._ref[e.t._callBack.requireGestureToFail.type];e._f=t,t._o=e,t.t._requireGestureRecognizerToFail=!0,e.t._requireGestureRecognizerToFail=!0}e=e._next}},p.gestureRecognizerStateChange=function(e,t){var i,s=this._ref[e];if(null!=s._o?t?(s.t[s.p0](),s._o.h&&(s._o.h=!1),s.r=!0,s.c&&(i=this._allowSimultaneous?null:s),i=s):(s.f=!0,s._o.h&&(s._o.t[s._o.p0](),s._o.c&&(s._o.r=!0),s.f=!1,s._o.h=!1)):t&&(s.t[s.p0](),s.r=!0,i=s),null!=i)for(s=this._firstG;s;){if(s==i){s!=this._firstG&&(s._prev._next=s._next,null!=s._next&&(s._next._prev=s._prev),this._firstG._prev=s,s._next=this._firstG,s._prev=null,this._firstG=s);break}s=s._next}},p.removeTouch=function(e){for(var t=0;t<this._ts.length;t++)if(this._ts[t].touchPointID==e.touchPointID){var i=this._ts.splice(t,1)[0];this._touchEventPool.push(i);break}},p.cloneTouchEvent=function(e){var t=this._touchEventPool.pop();return t||(t={}),t.stageX=e.stageX,t.stageY=e.stageY,t.type=e.type,t.touchDown=e.touchDown,t.touchPointID=e.touchPointID,t},p.onTouched=function(e){function t(){var e=r._firstG;if(null!=e&&(!e.r||e.c||(e.r=!1,r._allowSimultaneous)))if(e.r&&!r._allowSimultaneous&&e.c)e.r=e.t[e.p2](i);else{for(var t;e;){if(null!=e.t._shouldReceiveTouch&&!e.t._shouldReceiveTouch())return void(e=e._next);var s=e.n>=n?e.t[e.p1](i):!1;s?(null!=e._o&&e._o.h&&(e._o.h=!1),null!=e._f?e._f.r?(e._f.c||(e._f.r=!1),e=e._next):e._f.f?(null!=e._o&&e._o.h&&(e._o.h=!1),e._f.f=!1,e.t[e.p0](),null!=e._o&&(e.r=!0),e.c&&(e.r=!0,e.t[e.p2](i),t=r._allowSimultaneous?null:e),e=r._allowSimultaneous?e._next:null):(e.h||(e.h=!0),e=e._next):(null!=e._o&&e._o.h&&(e._o.h=!1),e.t[e.p0](),null!=e._o&&e.c&&(e.r=!0),e.c&&(e.r=!0,e.t[e.p2](i),t=r._allowSimultaneous?null:e),e=r._allowSimultaneous?e._next:null)):null!=e._o?(e.f=e.t._failed,e.f&&e._o.h?(e._o.t[e._o.p0](),e._o.c&&(e._o.t[e._o.p2](i),e._o.r=!0),e.f=!1,e._o.h=!1,e=null):e=e._next):e=e._next}if(null!=t&&!r._allowSimultaneous)for(e=r._firstG;e;){if(e==t){e!=r._firstG&&(e._prev._next=e._next,null!=e._next&&(e._next._prev=e._prev),r._firstG._prev=e,e._next=r._firstG,e._prev=null,r._firstG=e);break}e=e._next}}}this.removeTouch(e),this._ts.push(this.cloneTouchEvent(e));var i=this._ts;if(0!=i.length){var s=i[0],n=i.length;if(s){s.type==egret.TouchEvent.TOUCH_BEGIN&&(this.startGlobalX=s.stageX,this.startGlobalY=s.stageY);var r=this;t(),null!=this.vars.onTouch&&this.vars.onTouch instanceof Function&&this.vars.onTouch(i),e.type==egret.TouchEvent.TOUCH_END&&this.removeTouch(e)}}},e.add=function(t,i,s){void 0===i&&(i=null),void 0===s&&(s=!1);var n=new e(t,i,s);if(null==e._gestures[t.hashCode])e._gestures[t.hashCode]=[n];else{var r=e._gestures[t.hashCode];r.push(n)}return n},e.removeAll=function(t){var i=e._gestures[t.hashCode];if(i&&i.length>0){for(var s=0;s<i.length;s++)i[s].dispose();i.length=0}},p.add=function(t){var i,s;for(i in t)i in e._gesturePlugins&&(s=new e._gesturePlugins[i])._onInitGesture(t[i],t[i].config,this)&&(this._firstG=new PropGesture(s,"executeGestureRecognizedCallback","checkGesture","updateValue",this._firstG,s._continuous,s._priority,s._numTouchesRequired),this._ref[s._gestureType]=this._firstG)},p.remove=function(e){for(var t,i=this._firstG;i;)i.t._gestureType==e&&(t=i,null!=t._prev&&(t._prev._next=t._next),null!=t._next&&(t._next._prev=t._prev),t==this._firstG&&(this._firstG=t._next)),i=i._next;return null!=t},p.dispose=function(){this.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouched,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouched,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouched,this),egret.MainContext.instance.stage.removeEventListener(egret.Event.LEAVE_STAGE,this.leaveStage,this)},t(p,"allowSimultaneous",function(){return this._allowSimultaneous},function(e){this._allowSimultaneous=e}),e._gesturePlugins={doubleTap:DoubleTapGestureRecognizer,pinch:PinchGestureRecognizer},e._gestures={},e}();egret.registerClass(GestureManager,"GestureManager");