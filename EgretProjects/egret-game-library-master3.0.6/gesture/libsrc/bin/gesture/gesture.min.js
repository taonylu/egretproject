var PropGesture=function(){function t(t,e,s,i,r,n,o,u){void 0===e&&(e="executeGestureRecognizedCallback"),void 0===s&&(s="checkGesture"),void 0===i&&(i="updateValue"),void 0===r&&(r=null),void 0===n&&(n=!1),void 0===o&&(o=0),void 0===u&&(u=1),this.n=0,this.p=!0,this.pr=0,this.t=t,this.c=n,r&&(r._prev=this,this._next=r),this.p0=e,this.p1=s,this.p2=i,this.n=u}var e=(__define,t);e.prototype;return t}();egret.registerClass(PropGesture,"PropGesture");var GestureEvent=function(t){function e(e,s,i){void 0===i&&(i=""),t.call(this,e,!1,null),this.gm=s,this.state=i}__extends(e,t);var s=(__define,e);s.prototype;return e.ACHE_GESTURE="acheGesture",e}(egret.Event);egret.registerClass(GestureEvent,"GestureEvent");var GestureRecognizerPlugin=function(){function t(t,e,s,i,r){void 0===t&&(t=""),void 0===e&&(e=0),void 0===s&&(s=!1),void 0===i&&(i=!1),void 0===r&&(r=1),this._failed=!1,this._priority=0,this._numTouchesRequired=1,this._continuous=!1,this._possible=!0,this._gestureType=t,this._continuous=i,this._requireGestureRecognizerToFail=s,this._priority=e||0,this._numTouchesRequired=r}var e=(__define,t),s=e.prototype;return t.activate=function(t){for(var e=t.length;--e>-1;)GestureManager._gesturePlugins[(new t[e])._gestureName]=t[e]},s._onInitGesture=function(t,e,s){return this._callBack=t,this._config=e,this._g=s,null!=this._config&&null!=this._config.shouldReceiveTouch&&(this._shouldReceiveTouch=this._config.shouldReceiveTouch),this._result=new GestureEvent(GestureEvent.ACHE_GESTURE,this._g),!0},s.executeGestureRecognizedCallback=function(){this._callBack.recognized&&(this._result.state=GestureState.RECOGNIZED,this._callBack.recognized(this._result))},s.checkGesture=function(t){return!1},s.updateValue=function(t){return!0},s.gesturePossible=function(t){this._possible=t,this._callBack.possible&&(this._result.state=GestureState.POSSIBLE,this._result.possible=t,this._callBack.possible(this._result))},s.gestureBegan=function(){this._callBack.began&&(this._result.state=GestureState.BEGAN,this._callBack.began(this._result))},s.gestureEnded=function(){this._callBack.ended&&(this._result.state=GestureState.ENDED,this._callBack.ended(this._result))},t}();egret.registerClass(GestureRecognizerPlugin,"GestureRecognizerPlugin");var PinchGestureRecognizer=function(t){function e(e,s){void 0===e&&(e=0),void 0===s&&(s=!1),t.call(this,GestureType.PINCH,e,s,!0,2),this._cx=0,this._cy=0,this._offsetX=0,this._offsetY=0,this.pZero=new egret.Point}__extends(e,t);var s=(__define,e),i=s.prototype;return i.checkGesture=function(t){if(2!=t.length)return this._cx=0,this._offsetX=this._offsetY=0,!1;var e=t[0],s=t[1];return e.type==egret.TouchEvent.TOUCH_END||s.type==egret.TouchEvent.TOUCH_END?(this._cx=0,this._offsetX=this._offsetY=0,!1):0!=this._cx?!0:(this._cx=.5*(e.stageX+s.stageX),this._cy=.5*(e.stageY+s.stageY),this._d1X=e.stageX-s.stageX,this._d1Y=e.stageY-s.stageY,this._localLocation=this._g.target.globalToLocal(this._cx,this._cy,this._localLocation),this._callBack.changed&&(this._result.dx=this._offsetX,this._result.dy=this._offsetY,this._result.dScale=1,this._result.localLocation=this._localLocation,this._callBack.changed(this._result)),!0)},i.updateValue=function(t){if(2!=t.length)return this._cx=0,!1;var e=t[0],s=t[1];if(e.type==egret.TouchEvent.TOUCH_END||s.type==egret.TouchEvent.TOUCH_END)return this._cx=0,this._offsetX=this._offsetY=0,!1;var i=this._cx,r=this._cy;this._cx=.5*(e.stageX+s.stageX),this._cy=.5*(e.stageY+s.stageY),this._offsetX=this._cx-i,this._offsetY=this._cy-r,this._d2X=e.stageX-s.stageX,this._d2Y=e.stageY-s.stageY,this._localLocation=this._g.target.globalToLocal(this._cx,this._cy,this._localLocation);var n=egret.Point.distance(new egret.Point(this._d2X,this._d2Y),this.pZero)/egret.Point.distance(new egret.Point(this._d1X,this._d1Y),this.pZero);return this._d1X=this._d2X,this._d1Y=this._d2Y,this._callBack.changed&&(this._result.dx=this._offsetX,this._result.dy=this._offsetY,this._result.dScale=n,this._result.localLocation=this._localLocation,this._callBack.changed(this._result)),!0},e}(GestureRecognizerPlugin);egret.registerClass(PinchGestureRecognizer,"PinchGestureRecognizer");var DoubleTapGestureRecognizer=function(t){function e(e,s){void 0===e&&(e=0),void 0===s&&(s=!1),t.call(this,GestureType.DOUBLE_TAP,e,s),this._interval=300,this._max_dist=80,this._count=0,this._validate=!1,this._sx=0,this._sy=0,this._t=new egret.Timer(this._interval,1),this._t.addEventListener(egret.TimerEvent.TIMER,this.onCheck,this),this._count=0}__extends(e,t);var s=(__define,e),i=s.prototype;return i.checkGesture=function(t){var e,s=t[0];return s.type==egret.TouchEvent.TOUCH_BEGIN&&0==this._count&&(this._failed=!1),s.type==egret.TouchEvent.TOUCH_MOVE,s.type==egret.TouchEvent.TOUCH_END&&(0==this._count?(this._count+=1,this._validate=!0,this._t.reset(),this._t.start(),this._sx=s.stageX,this._sy=s.stageY):1==this._count&&(this._validate&&Math.abs(s.stageX-this._sx)<this._max_dist&&Math.abs(s.stageY-this._sy)<this._max_dist&&(e=!0),this._count=0,this._t.stop())),e},i.onCheck=function(t){this._failed=!0,this._validate=!1,this._count=0,this._requireGestureRecognizerToFail&&this._g.gestureRecognizerStateChange(this._gestureType,!1)},e}(GestureRecognizerPlugin);egret.registerClass(DoubleTapGestureRecognizer,"DoubleTapGestureRecognizer");var GestureType=function(){function t(){}var e=(__define,t);e.prototype;return t.DOUBLE_TAP="doubleTap",t.PINCH="pinch",t}();egret.registerClass(GestureType,"GestureType");var GestureState=function(){function t(){}var e=(__define,t);e.prototype;return t.POSSIBLE="possible",t.RECOGNIZED="recognized",t.FAILED="failed",t.BEGAN="began",t.CHANGED="changed",t.ENDED="ended",t.CANCELLED="cancelled",t}();egret.registerClass(GestureState,"GestureState");var GestureManager=function(){function t(t,e,s){void 0===e&&(e=null),void 0===s&&(s=!1),this._ref={},this._ts=[],this._touchEventPool=[],this.vars=e||{},this.target=t,t.touchEnabled=!0,this._allowSimultaneous=s,this._initGesture()}var e=__define,s=t,i=s.prototype;return i._initGesture=function(){var e,s;for(e in this.vars)e in t._gesturePlugins&&(s=new t._gesturePlugins[e])._onInitGesture(this.vars[e],this.vars[e].config,this)&&(this._firstG=new PropGesture(s,"executeGestureRecognizedCallback","checkGesture","updateValue",this._firstG,s._continuous,s._priority,s._numTouchesRequired),this._ref[s._gestureType]=this._firstG);this.linkGestureCondition(),this.target.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouched,this),this.target.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouched,this),this.target.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouched,this),egret.MainContext.instance.stage.addEventListener(egret.Event.LEAVE_STAGE,this.leaveStage,this)},i.leaveStage=function(t){for(;this._ts.length>0;){var e=this._ts.splice(0,1)[0];this._touchEventPool.push(e)}},i.linkGestureCondition=function(){for(var t=this._firstG;t;){if(t.t._callBack.hasOwnProperty("requireGestureToFail")&&null!=t.t._callBack.requireGestureToFail){var e=this._ref[t.t._callBack.requireGestureToFail.type];t._f=e,e._o=t,e.t._requireGestureRecognizerToFail=!0,t.t._requireGestureRecognizerToFail=!0}t=t._next}},i.gestureRecognizerStateChange=function(t,e){var s,i=this._ref[t];if(null!=i._o?e?(i.t[i.p0](),i._o.h&&(i._o.h=!1),i.r=!0,i.c&&(s=this._allowSimultaneous?null:i),s=i):(i.f=!0,i._o.h&&(i._o.t[i._o.p0](),i._o.c&&(i._o.r=!0),i.f=!1,i._o.h=!1)):e&&(i.t[i.p0](),i.r=!0,s=i),null!=s)for(i=this._firstG;i;){if(i==s){i!=this._firstG&&(i._prev._next=i._next,null!=i._next&&(i._next._prev=i._prev),this._firstG._prev=i,i._next=this._firstG,i._prev=null,this._firstG=i);break}i=i._next}},i.removeTouch=function(t){for(var e=0;e<this._ts.length;e++)if(this._ts[e].touchPointID==t.touchPointID){var s=this._ts.splice(e,1)[0];this._touchEventPool.push(s);break}},i.cloneTouchEvent=function(t){var e=this._touchEventPool.pop();return e||(e={}),e.stageX=t.stageX,e.stageY=t.stageY,e.type=t.type,e.touchDown=t.touchDown,e.touchPointID=t.touchPointID,e},i.onTouched=function(t){function e(){var t=n._firstG;if(null!=t&&(!t.r||t.c||(t.r=!1,n._allowSimultaneous)))if(t.r&&!n._allowSimultaneous&&t.c)t.r=t.t[t.p2](s);else{for(var e;t;){if(null!=t.t._shouldReceiveTouch&&!t.t._shouldReceiveTouch())return void(t=t._next);var i=t.n>=r?t.t[t.p1](s):!1;i?(null!=t._o&&t._o.h&&(t._o.h=!1),null!=t._f?t._f.r?(t._f.c||(t._f.r=!1),t=t._next):t._f.f?(null!=t._o&&t._o.h&&(t._o.h=!1),t._f.f=!1,t.t[t.p0](),null!=t._o&&(t.r=!0),t.c&&(t.r=!0,t.t[t.p2](s),e=n._allowSimultaneous?null:t),t=n._allowSimultaneous?t._next:null):(t.h||(t.h=!0),t=t._next):(null!=t._o&&t._o.h&&(t._o.h=!1),t.t[t.p0](),null!=t._o&&t.c&&(t.r=!0),t.c&&(t.r=!0,t.t[t.p2](s),e=n._allowSimultaneous?null:t),t=n._allowSimultaneous?t._next:null)):null!=t._o?(t.f=t.t._failed,t.f&&t._o.h?(t._o.t[t._o.p0](),t._o.c&&(t._o.t[t._o.p2](s),t._o.r=!0),t.f=!1,t._o.h=!1,t=null):t=t._next):t=t._next}if(null!=e&&!n._allowSimultaneous)for(t=n._firstG;t;){if(t==e){t!=n._firstG&&(t._prev._next=t._next,null!=t._next&&(t._next._prev=t._prev),n._firstG._prev=t,t._next=n._firstG,t._prev=null,n._firstG=t);break}t=t._next}}}this.removeTouch(t),this._ts.push(this.cloneTouchEvent(t));var s=this._ts;if(0!=s.length){var i=s[0],r=s.length;if(i){i.type==egret.TouchEvent.TOUCH_BEGIN&&(this.startGlobalX=i.stageX,this.startGlobalY=i.stageY);var n=this;e(),null!=this.vars.onTouch&&this.vars.onTouch instanceof Function&&this.vars.onTouch(s),t.type==egret.TouchEvent.TOUCH_END&&this.removeTouch(t)}}},t.add=function(e,s,i){void 0===s&&(s=null),void 0===i&&(i=!1);var r=new t(e,s,i);if(null==t._gestures[e.hashCode])t._gestures[e.hashCode]=[r];else{var n=t._gestures[e.hashCode];n.push(r)}return r},t.removeAll=function(e){var s=t._gestures[e.hashCode];if(s&&s.length>0){for(var i=0;i<s.length;i++)s[i].dispose();s.length=0}},i.add=function(e){var s,i;for(s in e)s in t._gesturePlugins&&(i=new t._gesturePlugins[s])._onInitGesture(e[s],e[s].config,this)&&(this._firstG=new PropGesture(i,"executeGestureRecognizedCallback","checkGesture","updateValue",this._firstG,i._continuous,i._priority,i._numTouchesRequired),this._ref[i._gestureType]=this._firstG)},i.remove=function(t){for(var e,s=this._firstG;s;)s.t._gestureType==t&&(e=s,null!=e._prev&&(e._prev._next=e._next),null!=e._next&&(e._next._prev=e._prev),e==this._firstG&&(this._firstG=e._next)),s=s._next;return null!=e},i.dispose=function(){this.target.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouched,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouched,this),this.target.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouched,this),egret.MainContext.instance.stage.removeEventListener(egret.Event.LEAVE_STAGE,this.leaveStage,this)},e(i,"allowSimultaneous",function(){return this._allowSimultaneous},function(t){this._allowSimultaneous=t}),t._gesturePlugins={doubleTap:DoubleTapGestureRecognizer,pinch:PinchGestureRecognizer},t._gestures={},t}();egret.registerClass(GestureManager,"GestureManager");