var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var o=RES.getRes(e);o?i(o):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var UserManager=function(){function e(){}var t=(__define,e);t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(UserManager,"UserManager");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var ActionEnum;!function(e){e[e.up=0]="up",e[e.down=1]="down",e[e.left=2]="left",e[e.right=3]="right",e[e.stopMove=4]="stopMove",e[e.stopShoot=5]="stopShoot",e[e.shoot=6]="shoot"}(ActionEnum||(ActionEnum={}));var GameManager=function(){function e(){this.homeScene=new HomeScene,this.resultScene=new ResultScene}var t=(__define,e),n=t.prototype;return n.startup=function(e){GameConst.gameConfig=window.gameConfig,GameConst.stage=e.stage,LayerManager.getInstance().initialize(e);var t=ClientSocket.getInstance();t.homeScene=this.homeScene,LayerManager.getInstance().runScene(this.homeScene)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var ClientSocket=function(){function e(){}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.isConnected=function(){return this.socket&&this.socket.connected?!0:!1},n.closeSocket=function(){egret.log("主动断开连接"),this.socket.disconnect()},n.startConnect=function(){this.socket=io.connect(GameConst.gameConfig.server,{reconnection:!1,"force new connection":!0});var e=this;this.socket.on("connect",function(){egret.log("connenct succss"),e.homeScene.connect()}),this.socket.on("error",function(e){egret.log("connenct erro")}),this.socket.on("disconnect",function(){egret.log("connenct close")}),this.socket.on("reconnect_attempt",function(){egret.log("reconnect")}),this.socket.on("connect_timeout",function(){}),this.socket.on("login",function(t){e.homeScene.revLogin(t)}),this.socket.on("startGame",function(t){e.homeScene.revStartGame()}),this.socket.on("gameOver",function(t){e.homeScene.revGameOver(t)})},n.sendMessage=function(e,t,n,i){void 0===t&&(t=null),void 0===n&&(n=null),void 0===i&&(i=null),this.socket&&this.socket.connected&&this.socket.emit(e,t,function(e){n&&i&&n.call(i,e)})},e}();egret.registerClass(ClientSocket,"ClientSocket");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),n=t.prototype;return n.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.popLayer.touchThrough=!0,this.main.addChild(this.popLayer)},n.runScene=function(e,t){void 0===t&&(t=!1),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.curScene=e,this.sceneLayer.addChild(e),e.inited&&e.onEnable()},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.loadGroup=function(e,t,n,i,o){void 0===n&&(n=null),void 0===i&&(i=null),void 0===o&&(o=null),this.loadComplete[e]=n,this.loadError[e]=o,this.loadProgress[e]=i,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},n.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var n=this.loadComplete[t];null!=n&&n.call(this.thisObject[t],e),this.clearCallBack(t)},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},n.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},n.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},i.onEnable=function(){},i.onRemove=function(){},i.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var HttpUtil=function(){function e(){this.httpMethod=egret.HttpMethod.GET,this.request=new egret.HttpRequest,this.request.responseType=egret.HttpResponseType.TEXT,this.request.addEventListener(egret.Event.COMPLETE,this.onPostComplete,this),this.request.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onPostIOError,this)}var t=(__define,e),n=t.prototype;return n.send=function(e,t,n){this.thisObject=n,this.request.open(e,this.httpMethod),this.request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),""!=t?this.request.send(t):this.request.send()},n.onPostComplete=function(e){this.completeHandler&&this.completeHandler.call(this.thisObject,this.request.response)},n.onPostIOError=function(e){egret.log("http error"),this.errorHandler&&this.errorHandler.call(this.thisObject,e)},e}();egret.registerClass(HttpUtil,"HttpUtil");var StringTool=function(){function e(){}var t=(__define,e);t.prototype;return e.getTimeString=function(e){var t="";return t=10>e?"0"+e:e.toString()},e.checkPhoneNum=function(e){var t=/^1\d{10}$/,n=t.test(e);return n},e}();egret.registerClass(StringTool,"StringTool");var HeadUI=function(e){function t(){e.call(this,"HeadUISkin"),this.imgX=10,this.imgY=17,this.imgWidth=45,this.imgHeight=45,this.imageLoader=new egret.ImageLoader}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),this.nameLabel.text="",this.headImg=new egret.Bitmap,this.headImg.x=this.imgX,this.headImg.y=this.imgY,this.headImg.width=this.imgWidth,this.headImg.height=this.imgHeight,this.headImg.mask=this.headMask,this.addChild(this.headImg)},i.setNameLabel=function(e){this.nameLabel.text=e},i.loadImg=function(e){this.imageLoader.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadError,this),this.imageLoader.addEventListener(egret.Event.COMPLETE,this.loadCompleteHandler,this),this.imageLoader.load(e)},i.loadCompleteHandler=function(e){var t=e.currentTarget;this.headImg.bitmapData=t.data},i.onLoadError=function(){egret.log("加载头像错误")},i.isEmpty=function(){return""==this.nameLabel.text?!0:!1},i.clear=function(){this.nameLabel.text="",this.headImg.bitmapData=null,this.userID=""},t}(BaseUI);egret.registerClass(HeadUI,"HeadUI");var HomeScene=function(e){function t(){e.call(this,"HomeSceneSkin")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance()},i.onEnable=function(){this.startConnect(),this.handler.visible=!1,egret.log("用户id:",GameConst.gameConfig.openid),egret.log("用户昵称:",GameConst.gameConfig.nickname)},i.onRemove=function(){},i.configListeners=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.handler.configListeners()},i.deConfigListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.handler.deConfigListeners()},i.onTouchBegin=function(e){switch(e.target){case this.aBtn:case this.bBtn:this.sendAction(ActionEnum.shoot);break;case this.directionBg:this.handler.x=e.stageX-this.handler.width/2,this.handler.y=e.stageY-this.handler.height/2,this.handler.visible=!0}},i.onTouchEnd=function(e){switch(e.target){case this.aBtn:case this.bBtn:this.sendAction(ActionEnum.stopShoot)}},i.startConnect=function(){0==this.socket.isConnected()&&this.socket.startConnect()},i.connect=function(){this.sendLogin()},i.sendLogin=function(){egret.log("send login");var e=GameConst.gameConfig,t={rid:e.rid,openid:e.openid,headimgurl:e.headimgurl,nickname:e.nickname,group:e.group,count:e.count,userType:"mobile"};this.socket.sendMessage("login",t)},i.revLogin=function(e){var t=e.success,n=e.msg;egret.log("rev login:"," success:",t," msg:",n)},i.revStartGame=function(){egret.log("rev startGame"),this.configListeners()},i.sendAction=function(e){this.socket.sendMessage("action",{actionType:e,openid:GameConst.gameConfig.openid})},i.revGameOver=function(e){egret.log("rev gameOver");var t=e.message;LayerManager.getInstance().runScene(GameManager.getInstance().resultScene),GameManager.getInstance().resultScene.setResult(t)},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var PreloadScene=function(e){function t(){e.call(this,"PreloadSceneSkin")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this)},i.setProgress=function(e){this.inited&&(this.progressLabel.text="Loading..."+e.toString()+"%")},t}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var ResultScene=function(e){function t(){e.call(this,"ResultSceneSkin")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),null!=this.dataBuffer&&this.setResult(this.dataBuffer)},i.setResult=function(e){if(this.dataBuffer=e,0!=this.inited){var t=e.wave,n=e.heroRank,i=e.p1Openid,o=e.p2Openid,s=e.p1KillRank,r=e.p2KillRank,a=e.p1Kill,c=e.p2Kill;console.log("test1"),this.waveLabel.text=t+"",this.heroRankLabel.text=n+"",this.killLabel.text="",this.killRankLabel.text="",console.log("test2"),GameConst.gameConfig.openid==i?(this.killLabel.text=a+"",this.killRankLabel.text=s+""):GameConst.gameConfig.openid==o&&(this.killLabel.text=c+"",this.killRankLabel.text=r+""),console.log("test3")}},t}(BaseScene);egret.registerClass(ResultScene,"ResultScene");var Handler=function(e){function t(){e.call(this,"HandlerSkin")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),this.socket=ClientSocket.getInstance()},i.configListeners=function(){this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.deConfigListeners=function(){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.onTouchMove=function(e){this.checkDirection(e.localX,e.localY)},i.onTouchBegin=function(e){this.checkDirection(e.localX,e.localY)},i.onTouchEnd=function(){this.sendAction(ActionEnum.stopMove),this.visible=!1},i.checkDirection=function(e,t){var n=180*Math.atan2(t-250,e-250)/Math.PI+180;n>=45&&135>=n?this.sendAction(ActionEnum.up):n>=135&&225>=n?this.sendAction(ActionEnum.right):n>=225&&315>=n?this.sendAction(ActionEnum.down):this.sendAction(ActionEnum.left)},i.sendAction=function(e){this.curAction!=e&&(this.curAction=e,this.socket.sendMessage("action",{actionType:e,openid:GameConst.gameConfig.openid}))},t}(BaseUI);egret.registerClass(Handler,"Handler");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},i.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},i.onPreloadComplete=function(e){this.preloadScene=new PreloadScene,this.addChild(this.preloadScene),LoadManager.getInstance().loadGroup("game",this,this.onGameComplete,this.onGameProgress)},i.onGameProgress=function(e){this.preloadScene.setProgress(Math.round(e.itemsLoaded/e.itemsTotal*100))},i.onGameComplete=function(){this.removeChild(this.preloadScene),this.preloadScene=null,GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,i){function o(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);