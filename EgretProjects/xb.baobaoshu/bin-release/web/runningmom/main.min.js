var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},n.onEnable=function(){},n.onRemove=function(){},n.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),i=t.prototype;return i.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.main.addChild(this.popLayer)},i.runScene=function(e,t){void 0===t&&(t=!1),this.sceneLayer.addChild(e),e.inited&&e.onEnable(),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.curScene=e},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),i=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},i.loadGroup=function(e,t,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.loadComplete[e]=i,this.loadError[e]=s,this.loadProgress[e]=n,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},i.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var i=this.loadComplete[t];null!=i&&i.call(this.thisObject[t],e),this.clearCallBack(t)},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},i.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},i.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),i=t.prototype;return i.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},i.returnObject=function(e){this.list.push(e)},e.getPool=function(t,i){if(void 0===i&&(i=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=i))for(var n=egret.getDefinitionByName(t),s=e.pool[t],o=0;i>o;o++)s.returnObject(new n);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var SoundManager=function(){function e(){this.bgm=RES.getRes("bgm_mp3"),this.click=RES.getRes("click_mp3"),this.run=RES.getRes("run_mp3"),this.box=RES.getRes("box_mp3"),this.countdown=RES.getRes("countdown_mp3")}var t=(__define,e),i=t.prototype;return i.playBGM=function(){null!=this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null),this.bgmChannel=this.bgm.play(0,-1)},i.stopBGM=function(){this.bgmChannel&&(this.bgmChannel.stop(),this.bgmChannel=null)},e}();egret.registerClass(SoundManager,"SoundManager");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function e(){this.preloadScene=new PreloadScene,this.gameScene=new GameScene,this.submitScene=new SubmitScene}var t=(__define,e),i=t.prototype;return i.startup=function(e){GameConst.stage=e.stage,LayerManager.getInstance().initialize(e),LayerManager.getInstance().runScene(this.gameScene)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin"),this.runTimer=new egret.Timer(300),this.leftFootPool=ObjectPool.getPool(LeftFoot.NAME,4),this.rightFootPool=ObjectPool.getPool(RightFoot.NAME,4),this.footList=[],this.numList=[],this.countDownTimer=new egret.Timer(700,4),this.boxList=[],this.boxCount=0,this.tipList=[],this.gameTimeLimit=20,this.gameTimer=new egret.Timer(1e3),this.packetTimer=new egret.Timer(1e3),this.snd=new SoundManager}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.boxList.push(this.box0,this.box1,this.box2),this.numList.push(this.num3,this.num2,this.num1,this.title),this.tipList.push(this.tip0,this.tip1,this.tip2),this.manStartY=this.runManGroup.y},n.onEnable=function(){this.snd.playBGM(),this.resetRunMan(),this.resetBtn(),this.resetRule(),this.resetCountDown(),this.resetGameTimer(),this.resetBox(),this.resetTip(),this.resetResult(),this.resetShareFloat()},n.onRemove=function(){},n.gameOver=function(){console.log("gameover"),this.runBtn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRunBtnTouch,this),this.runBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onRunBtnEnd,this),this.stopGameTimer(),this.stopRunTimer(),this.resetTip(),this.showResultMan(),this.removeChild(this.runManGroup),this.numGroup.removeChild(this.runBtn)},n.onStartBtnTouch=function(){this.numGroup.removeChild(this.startBtn),this.countDown()},n.countDown=function(){this.snd.countdown.play(0,1),this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onCountDown,this),this.countDownTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onCountDownComplete,this),this.countDownTimer.reset(),this.countDownTimer.start(),this.numList[0].visible=!0},n.onCountDown=function(){for(var e=this.numList.length,t=0;e>t;t++)this.numList[t].visible=!1;this.numList[this.countDownTimer.currentCount]&&(this.numList[this.countDownTimer.currentCount].visible=!0)},n.onCountDownComplete=function(){for(var e=this.numList.length,t=0;e>t;t++)this.numGroup.removeChild(this.numList[t]);this.startGame()},n.startGame=function(){this.numGroup.addChild(this.runBtn),this.addChild(this.boxGroup),this.startGameTimer(),this.startRunTimer()},n.onRunBtnTouch=function(){this.snd.click.play(0,1),egret.Tween.get(this.runBtn).to({scaleX:.95,scaleY:.95},200),this.runManGroup.y+=4,this.runManGroup.scaleX+=.01,this.runManGroup.scaleY+=.01,this.runManGroup.y>550?this.gameOver():this.boxCount<3&&this.runManGroup.y>500?(this.boxList[2].visible=!0,this.showTip(2),this.boxCount=3,this.snd.box.play(0,1)):this.boxCount<2&&this.runManGroup.y>350?(this.boxList[1].visible=!0,this.showTip(1),this.boxCount=2,this.snd.box.play(0,1)):this.boxCount<1&&this.runManGroup.y>200&&(this.boxList[0].visible=!0,this.showTip(0),this.boxCount=1,this.snd.box.play(0,1))},n.onRunBtnEnd=function(){egret.Tween.get(this.runBtn).to({scaleX:1,scaleY:1},200)},n.onAgainBtnTouch=function(){this.onEnable()},n.onShareBtnTouch=function(){this.addChild(this.shareGroup);var e=this;this.shareGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shareGroup.parent&&e.shareGroup.parent.removeChild(e.shareGroup)},this)},n.onGetRedPacketTouch=function(){this.snd.stopBGM(),LayerManager.getInstance().runScene(GameManager.getInstance().submitScene)},n.onRuleBtnTouch=function(){this.removeChild(this.ruleGroup)},n.startGameTimer=function(){this.addChild(this.gameTimeGroup),this.gameTimeGroup.addChild(this.gameTimeLabel),this.gameTimeGroup.addChild(this.gameSecondLabel),this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this),this.gameTimer.reset(),this.gameTimer.start()},n.onGameTimerHandler=function(){return this.gameTimeLimit-this.gameTimer.currentCount<0?void this.gameOver():void(this.gameTimeLabel.text=(this.gameTimeLimit-this.gameTimer.currentCount).toString())},n.stopGameTimer=function(){this.gameTimer.stop(),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this)},n.startRunTimer=function(){this.runTimer.addEventListener(egret.TimerEvent.TIMER,this.onRunTimerHandler,this),this.runTimer.reset(),this.runTimer.start(),this.addEventListener(egret.Event.ENTER_FRAME,this.onRunEnterFrame,this)},n.onRunTimerHandler=function(){var e;this.runMan0.visible?(this.runMan0.visible=!1,this.runMan1.visible=!0,e=this.rightFootPool.getObject(),e.x=this.runMan1.x+110,e.y=this.runMan1.y+185):(this.runMan0.visible=!0,this.runMan1.visible=!1,e=this.leftFootPool.getObject(),e.x=this.runMan1.x+60,e.y=this.runMan1.y+185),e.scaleX=1,e.scaleY=1,this.runManGroup.addChild(e),this.footList.push(e)},n.onRunEnterFrame=function(){for(var e,t=this.footList.length,i=t-1;i>=0;i--)e=this.footList[i],e.y+=3,e instanceof RightFoot?e.x+=.4:e.x-=.4,e.scaleX+=.005,e.scaleY+=.005,e.y>=GameConst.stage.stageHeight&&(this.runManGroup.removeChild(e),this.footList.splice(i,1),e.recycle())},n.stopRunTimer=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onRunEnterFrame,this),this.runTimer.removeEventListener(egret.TimerEvent.TIMER,this.onRunTimerHandler,this),this.runTimer.stop()},n.startPacketTimer=function(){this.packetTimer.addEventListener(egret.TimerEvent.TIMER,this.showManGetAnim,this),this.packetTimer.reset(),this.packetTimer.start()},n.showManGetAnim=function(){this.man_get0.visible?(this.man_get0.visible=!1,this.man_get1.visible=!0):(this.man_get0.visible=!0,this.man_get1.visible=!1)},n.stopPacketTimer=function(){this.packetTimer.stop(),this.packetTimer.removeEventListener(egret.TimerEvent.TIMER,this.showManGetAnim,this)},n.showTip=function(e){for(var t=this.tipList.length,i=0;t>i;i++)this.tipList[i].visible=!1;this.tipList[e].visible=!0},n.resetRule=function(){this.addChild(this.ruleGroup),this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRuleBtnTouch,this)},n.resetCountDown=function(){for(var e=this.numList.length,t=0;e>t;t++)this.numList[t].visible=!1,this.numGroup.addChild(this.numList[t])},n.resetGameTimer=function(){this.removeChild(this.gameTimeGroup),this.gameTimeLabel.text=this.gameTimeLimit.toString()},n.resetBox=function(){this.removeChild(this.boxGroup);for(var e=this.boxList.length,t=0;e>t;t++)this.boxList[t].visible=!1;this.boxCount=0},n.resetTip=function(){for(var e=this.tipList.length,t=0;e>t;t++)this.tipList[t].visible=!1},n.resetRunMan=function(){this.addChild(this.runManGroup),this.runMan0.visible=!0,this.runMan1.visible=!1,this.runManGroup.y=this.manStartY,this.runManGroup.scaleX=1,this.runManGroup.scaleY=1,this.runBtn.scaleX=1,this.runBtn.scaleY=1;for(var e,t=this.footList.length,i=0;t>i;i++)e=this.footList[i],this.runManGroup.removeChild(e),e.recycle();this.footList.length=0},n.resetBtn=function(){this.addChild(this.numGroup),this.numGroup.addChild(this.startBtn),this.runBtn.parent&&this.numGroup.removeChild(this.runBtn),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartBtnTouch,this),this.runBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRunBtnTouch,this),this.runBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onRunBtnEnd,this)},n.resetResult=function(){this.stopPacketTimer(),this.removeChild(this.resultGroup),this.man_success.visible=!1,this.man_fail.visible=!1,this.man_get0.visible=!1,this.man_get1.visible=!1,this.shareBtn.visible=!1,this.againBtn.visible=!1},n.resetShareFloat=function(){this.shareGroup.parent&&this.removeChild(this.shareGroup)},n.showResultMan=function(){this.gameTimeGroup.removeChild(this.gameTimeLabel),this.gameTimeGroup.removeChild(this.gameSecondLabel),this.addChild(this.resultGroup),this.boxCount<=2?this.man_fail.visible=!0:3==this.boxCount&&(this.man_success.visible=!0);var e=this;egret.Tween.get(this).wait(2e3).call(function(){e.shareBtn.visible=!0,e.againBtn.visible=!0,e.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgainBtnTouch,this),e.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this),3==e.boxCount&&(e.man_success.visible=!1,e.getRedPacketBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetRedPacketTouch,this),e.man_get0.visible=!0,e.man_get1.visible=!1,e.startPacketTimer())},this)},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var PreloadScene=function(e){function t(){e.call(this,"PreloadSceneSkin"),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onEnable,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.boxStartY=this.box.y,this.boxEndY=this.boxStartY-500},n.onEnable=function(){this.box.y=this.boxStartY,this.playAnimThrow()},n.onRemove=function(){egret.Tween.removeAllTweens(),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onEnable,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},n.setProcessLabel=function(e){this.processLabel.text="Loading "+e+"%"},n.playAnimThrow=function(){this.man0.visible=!1,this.man1.visible=!0,this.box.visible=!0;var e=this;egret.Tween.get(this.box).to({y:this.boxEndY,rotation:360},800).call(function(){e.playAnimFall()})},n.playAnimFall=function(){this.man0.visible=!1,this.man1.visible=!0;var e=this;egret.Tween.get(this.box).to({y:this.boxStartY,rotation:360},800).call(function(){e.playAnimHold()})},n.playAnimHold=function(){this.man0.visible=!0,this.man1.visible=!1,this.box.visible=!1;var e=this;egret.Tween.get(this.box).wait(300).call(function(){e.playAnimThrow()})},t}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var SubmitScene=function(e){function t(){e.call(this,"SubmitSceneSkin")}__extends(t,e);var i=(__define,t),n=i.prototype;return n.componentCreated=function(){e.prototype.componentCreated.call(this),this.phoneLabel.border=!0,this.phoneLabel.verticalAlign=egret.VerticalAlign.MIDDLE,this.phoneLabel.textAlign=egret.HorizontalAlign.CENTER},n.onEnable=function(){this.phoneLabel.prompt="请输入手机号",this.submitBtn.visible=!0,this.successBtn.visible=!1,this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this)},n.onRemove=function(){},n.onSubmitBtnTouch=function(){var e=/^1\d{10}$/,t=e.test(this.phoneLabel.text);if(0==t)return void alert("手机号码不正确");this.submitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this);var i="http://m.meitun.com/mobile/user/receivecouponbymobile.htm",n=new egret.URLLoader;n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this),n.addEventListener(egret.Event.COMPLETE,this.onPostComlete,this);var s=new egret.URLRequest(i);s.method=egret.URLRequestMethod.POST,n.dataFormat=egret.URLLoaderDataFormat.TEXT,s.data=new egret.URLVariables("couponnumber=81682F81D828C180&mobile="+this.phoneLabel.text),n.load(s)},n.onError=function(e){alert("提交失败"),this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this)},n.onPostComlete=function(e){var t=e.target.data;console.log(t);var i=JSON.parse(t);console.log(i.rescode.code),console.log(i.rescode.info),0==i.rescode.code?(this.submitBtn.visible=!1,this.successBtn.visible=!0,egret.Tween.get(this).wait(2e3).call(function(){window.location.href="http://m.meitun.com/download.html?tcode=sdtgsp1212"})):(alert(i.rescode.info),this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this))},t}(BaseScene);egret.registerClass(SubmitScene,"SubmitScene");var BaseFoot=function(e){function t(){e.call(this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){},t}(egret.Bitmap);egret.registerClass(BaseFoot,"BaseFoot");var LeftFoot=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("game_foot0_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.touchEnabled=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="LeftFoot",t}(BaseFoot);egret.registerClass(LeftFoot,"LeftFoot");var RightFoot=function(e){function t(){e.call(this),this.bitmapData=RES.getRes("game_foot1_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.touchEnabled=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.recycle=function(){ObjectPool.getPool(t.NAME).returnObject(this)},t.NAME="RightFoot",t}(BaseFoot);egret.registerClass(RightFoot,"RightFoot");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isPreloadEnd=!1}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.loadGameResource()},n.onPreloadComplete=function(e){this.isPreloadEnd=!0,this.loadGameResource()},n.loadGameResource=function(){this.isThemeLoadEnd&&this.isPreloadEnd&&(this.preloadScene=new PreloadScene,this.addChild(this.preloadScene),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGameResourceComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGameResourceError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGameResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("game"))},n.onGameResourceError=function(e){alert("error:"+e.itemsLoaded+","+e.resItem)},n.onItemLoadError=function(e){alert("item error:"+e.itemsLoaded)},n.onGameResourceProgress=function(e){this.preloadScene.setProcessLabel(Math.round(e.itemsLoaded/e.itemsTotal*100))},n.onGameResourceComplete=function(e){egret.log("load complete"),this.removeChild(this.preloadScene),GameManager.getInstance().startup(this)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,n){function s(e){t.call(n,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);