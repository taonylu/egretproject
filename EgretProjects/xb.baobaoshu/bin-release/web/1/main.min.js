var AssetAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?n(s):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BaseScene=function(t){function e(e){t.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=e}__extends(e,t);var i=(__define,e),n=i.prototype;return n.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},n.onEnable=function(){},n.onRemove=function(){},n.onDestroy=function(){},e}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var LayerManager=function(){function t(){this.tweenTime=500}var e=(__define,t),i=e.prototype;return i.initialize=function(t){this.main=t,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.main.addChild(this.popLayer)},i.runScene=function(t,e){void 0===e&&(e=!1),this.sceneLayer.addChild(t),t.inited&&t.onEnable(),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),e&&this.curScene.onDestroy()),this.curScene=t},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function t(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var e=(__define,t),i=e.prototype;return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},i.loadGroup=function(t,e,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),this.loadComplete[t]=i,this.loadError[t]=s,this.loadProgress[t]=n,this.thisObject[t]=e,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(t)},i.onResourceLoadComplete=function(t){var e=t.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var i=this.loadComplete[e];null!=i&&i.call(this.thisObject[e],t),this.clearCallBack(e)},i.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load");var e=this.loadError[t.groupName];null!=e&&e.call(this.thisObject[t.groupName],t),this.clearCallBack(t.groupName)},i.onResourceProgress=function(t){var e=this.loadProgress[t.groupName];null!=e&&e.call(this.thisObject[t.groupName],t)},i.clearCallBack=function(t){this.loadComplete[t]=null,this.loadError[t]=null,this.loadProgress[t]=null},t}();egret.registerClass(LoadManager,"LoadManager");var ObjectPool=function(){function t(t){this.className=t,this.list=[]}var e=(__define,t),i=e.prototype;return i.getObject=function(){if(this.list.length>0)return this.list.shift();var t=egret.getDefinitionByName(this.className);return new t},i.returnObject=function(t){this.list.push(t)},t.getPool=function(e,i){if(void 0===i&&(i=0),!t.pool[e]&&(t.pool[e]=new t(e),0!=i))for(var n=egret.getDefinitionByName(e),s=t.pool[e],o=0;i>o;o++)s.returnObject(new n);return t.pool[e]},t.pool={},t}();egret.registerClass(ObjectPool,"ObjectPool");var GameConst=function(){function t(){}var e=(__define,t);e.prototype;return t}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function t(){this.preloadScene=new PreloadScene,this.gameScene=new GameScene,this.submitScene=new SubmitScene}var e=(__define,t),i=e.prototype;return i.startup=function(t){GameConst.stage=t.stage,LayerManager.getInstance().initialize(t),LayerManager.getInstance().runScene(this.gameScene),console.log("submit"),window.submit(),egret.Tween.get(this).wait(3e3).call(function(){window.sendGetPrize()})},t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t}();egret.registerClass(GameManager,"GameManager");var GameScene=function(t){function e(){t.call(this,"GameSceneSkin"),this.runTimer=new egret.Timer(150),this.leftFootPool=ObjectPool.getPool(LeftFoot.NAME,4),this.rightFootPool=ObjectPool.getPool(RightFoot.NAME,4),this.footList=[],this.numList=[],this.countDownTimer=new egret.Timer(720,4),this.boxList=[],this.boxCount=0,this.tipList=[],this.gameTimeLimit=15,this.gameTimer=new egret.Timer(1e3),this.packetTimer=new egret.Timer(1e3),this.bgCount=1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.componentCreated=function(){t.prototype.componentCreated.call(this),this.boxList.push(this.box0,this.box1,this.box2),this.numList.push(this.num3,this.num2,this.num1,this.title),this.tipList.push(this.tip0,this.tip1,this.tip2),this.manStartY=this.runManGroup.y,this.initTipPosY=this.tip0.y},n.onEnable=function(){this.resetBg(),this.resetRunMan(),this.resetBtn(),this.resetRule(),this.resetCountDown(),this.resetGameTimer(),this.resetBox(),this.resetTip(),this.resetResult(),this.resetShareFloat()},n.onRemove=function(){},n.gameOver=function(){console.log("gameover"),this.runBtn.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRunBtnTouch,this),this.runBtn.removeEventListener(egret.TouchEvent.TOUCH_END,this.onRunBtnEnd,this),this.stopGameTimer(),this.stopRunTimer(),this.resetTip(),this.showResultMan(),this.removeChild(this.runManGroup),this.numGroup.removeChild(this.runBtn)},n.onStartBtnTouch=function(){this.numGroup.removeChild(this.startBtn),this.countDown()},n.countDown=function(){this.countDownTimer.addEventListener(egret.TimerEvent.TIMER,this.onCountDown,this),this.countDownTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onCountDownComplete,this),this.countDownTimer.reset(),this.countDownTimer.start(),this.numList[0].visible=!0},n.onCountDown=function(){for(var t=this.numList.length,e=0;t>e;e++)this.numList[e].visible=!1;this.numList[this.countDownTimer.currentCount]&&(this.numList[this.countDownTimer.currentCount].visible=!0)},n.onCountDownComplete=function(){for(var t=this.numList.length,e=0;t>e;e++)this.numGroup.removeChild(this.numList[e]);this.startGame()},n.startGame=function(){this.numGroup.addChild(this.runBtn),this.addChild(this.boxGroup),this.startGameTimer(),this.startRunTimer()},n.onRunBtnTouch=function(){window.playClick(),this.runBtn.scaleX=.95,this.runBtn.scaleY=.95,this.runManGroup.y+=3.5,this.runManGroup.scaleX+=.01,this.runManGroup.scaleY+=.01,this.runManGroup.y>550?this.gameOver():this.boxCount<3&&this.runManGroup.y>500?(this.boxList[2].visible=!0,this.showTip(2),this.boxCount=3,window.playBox()):this.boxCount<2&&this.runManGroup.y>350?(this.boxList[1].visible=!0,this.showTip(1),this.boxCount=2,window.playBox()):this.boxCount<1&&this.runManGroup.y>250&&(this.boxList[0].visible=!0,this.showTip(0),this.boxCount=1,window.playBox())},n.onRunBtnEnd=function(){this.runBtn.scaleX=1,this.runBtn.scaleY=1},n.onAgainBtnTouch=function(){window.playBGM(),this.onEnable()},n.onShareBtnTouch=function(){this.addChild(this.shareGroup);var t=this;this.shareGroup.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.shareGroup.parent&&t.shareGroup.parent.removeChild(t.shareGroup)},this)},n.onGetRedPacketTouch=function(){window.pauseBGM(),LayerManager.getInstance().runScene(GameManager.getInstance().submitScene)},n.onRuleBtnTouch=function(){this.numGroup.addChild(this.startBtn),this.removeChild(this.ruleGroup)},n.startGameTimer=function(){this.addChild(this.gameTimeGroup),this.gameTimeGroup.addChild(this.gameTimeLabel),this.gameTimeGroup.addChild(this.gameSecondLabel),this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this),this.gameTimer.reset(),this.gameTimer.start()},n.onGameTimerHandler=function(){return this.gameTimeLimit-this.gameTimer.currentCount<0?void this.gameOver():void(this.gameTimeLabel.text=(this.gameTimeLimit-this.gameTimer.currentCount).toString())},n.stopGameTimer=function(){this.gameTimer.stop(),this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.onGameTimerHandler,this)},n.startRunTimer=function(){this.runTimer.addEventListener(egret.TimerEvent.TIMER,this.onRunTimerHandler,this),this.runTimer.reset(),this.runTimer.start(),this.addEventListener(egret.Event.ENTER_FRAME,this.onRunEnterFrame,this)},n.onRunTimerHandler=function(){var t;this.runMan0.visible?(this.runMan0.visible=!1,this.runMan1.visible=!0,t=this.rightFootPool.getObject(),t.x=this.runMan1.x+110,t.y=this.runMan1.y+185):(this.runMan0.visible=!0,this.runMan1.visible=!1,t=this.leftFootPool.getObject(),t.x=this.runMan1.x+60,t.y=this.runMan1.y+185),t.scaleX=1,t.scaleY=1,this.runManGroup.addChild(t),this.footList.push(t)},n.onRunEnterFrame=function(){this.bgCount++,this.bgCount>18&&(this.bgCount=1),6==this.bgCount?(this.bg1.visible=!1,this.bg2.visible=!0,this.bg3.visible=!1):12==this.bgCount?(this.bg1.visible=!1,this.bg2.visible=!1,this.bg3.visible=!0):18==this.bgCount&&(this.bg1.visible=!0,this.bg2.visible=!1,this.bg3.visible=!1);for(var t,e=this.footList.length,i=e-1;i>=0;i--)t=this.footList[i],t.y+=5,t instanceof RightFoot?t.x+=.4:t.x-=.4,t.scaleX+=.005,t.scaleY+=.005,t.y>=GameConst.stage.stageHeight&&(this.runManGroup.removeChild(t),this.footList.splice(i,1),t.recycle())},n.stopRunTimer=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.onRunEnterFrame,this),this.runTimer.removeEventListener(egret.TimerEvent.TIMER,this.onRunTimerHandler,this),this.runTimer.stop()},n.startPacketTimer=function(){this.packetTimer.addEventListener(egret.TimerEvent.TIMER,this.showManGetAnim,this),this.packetTimer.reset(),this.packetTimer.start()},n.showManGetAnim=function(){this.man_get0.visible?(this.man_get0.visible=!1,this.man_get1.visible=!0):(this.man_get0.visible=!0,this.man_get1.visible=!1)},n.stopPacketTimer=function(){this.packetTimer.stop(),this.packetTimer.removeEventListener(egret.TimerEvent.TIMER,this.showManGetAnim,this)},n.showTip=function(t){for(var e=this.tipList.length,i=0;e>i;i++)this.tipList[i].visible=!1;var n=this.tipList[t];n.alpha=0,n.y=this.initTipPosY+150,n.visible=!0,egret.Tween.get(n).to({y:this.initTipPosY,alpha:1},500)},n.resetRule=function(){this.addChild(this.ruleGroup),this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRuleBtnTouch,this)},n.resetCountDown=function(){for(var t=this.numList.length,e=0;t>e;e++)this.numList[e].visible=!1,this.numGroup.addChild(this.numList[e])},n.resetGameTimer=function(){this.removeChild(this.gameTimeGroup),this.gameTimeLabel.text=this.gameTimeLimit.toString()},n.resetBox=function(){this.removeChild(this.boxGroup);for(var t=this.boxList.length,e=0;t>e;e++)this.boxList[e].visible=!1;this.boxCount=0},n.resetTip=function(){for(var t=this.tipList.length,e=0;t>e;e++)this.tipList[e].visible=!1},n.resetBg=function(){this.bgCount=0,this.bg1.visible=!0,this.bg2.visible=!1,this.bg3.visible=!1},n.resetRunMan=function(){this.addChild(this.runManGroup),this.runMan0.visible=!0,this.runMan1.visible=!1,this.runManGroup.y=this.manStartY,this.runManGroup.scaleX=1,this.runManGroup.scaleY=1,this.runBtn.scaleX=1,this.runBtn.scaleY=1;for(var t,e=this.footList.length,i=0;e>i;i++)t=this.footList[i],this.runManGroup.removeChild(t),t.recycle();this.footList.length=0},n.resetBtn=function(){this.addChild(this.numGroup),this.startBtn.parent&&this.numGroup.removeChild(this.startBtn),this.runBtn.parent&&this.numGroup.removeChild(this.runBtn),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartBtnTouch,this),this.runBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onRunBtnTouch,this),this.runBtn.addEventListener(egret.TouchEvent.TOUCH_END,this.onRunBtnEnd,this)},n.resetResult=function(){this.stopPacketTimer(),this.removeChild(this.resultGroup),this.man_success.visible=!1,this.man_fail.visible=!1,this.man_get0.visible=!1,this.man_get1.visible=!1,this.shareBtn.visible=!1,this.againBtn.visible=!1},n.resetShareFloat=function(){this.shareGroup.parent&&this.removeChild(this.shareGroup)},n.showResultMan=function(){this.gameTimeGroup.removeChild(this.gameTimeLabel),this.gameTimeGroup.removeChild(this.gameSecondLabel),this.addChild(this.resultGroup),this.boxCount<=2?this.man_fail.visible=!0:3==this.boxCount&&(this.man_success.visible=!0);var t=this;egret.Tween.get(this).wait(2e3).call(function(){t.shareBtn.visible=!0,t.againBtn.visible=!0,t.againBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onAgainBtnTouch,this),t.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this),3==t.boxCount&&(t.man_success.visible=!1,t.getRedPacketBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGetRedPacketTouch,this),t.man_get0.visible=!0,t.man_get1.visible=!1,t.startPacketTimer())},this)},e}(BaseScene);egret.registerClass(GameScene,"GameScene");var PreloadScene=function(t){function e(){t.call(this,"PreloadSceneSkin"),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onEnable,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.componentCreated=function(){t.prototype.componentCreated.call(this),this.boxStartY=this.box.y,this.boxEndY=this.boxStartY-500},n.onEnable=function(){this.box.y=this.boxStartY,this.playAnimThrow()},n.onRemove=function(){egret.Tween.removeAllTweens(),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onEnable,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this)},n.setProcessLabel=function(t){this.processLabel.text="Loading "+t+"%"},n.playAnimThrow=function(){this.man0.visible=!1,this.man1.visible=!0,this.box.visible=!0;var t=this;egret.Tween.get(this.box).to({y:this.boxEndY,rotation:360},800).call(function(){t.playAnimFall()})},n.playAnimFall=function(){this.man0.visible=!1,this.man1.visible=!0;var t=this;egret.Tween.get(this.box).to({y:this.boxStartY,rotation:360},800).call(function(){t.playAnimHold()})},n.playAnimHold=function(){this.man0.visible=!0,this.man1.visible=!1,this.box.visible=!1;var t=this;egret.Tween.get(this.box).wait(300).call(function(){t.playAnimThrow()})},e}(BaseScene);egret.registerClass(PreloadScene,"PreloadScene");var SubmitScene=function(t){function e(){t.call(this,"SubmitSceneSkin")}__extends(e,t);var i=(__define,e),n=i.prototype;return n.componentCreated=function(){t.prototype.componentCreated.call(this),this.phoneLabel.border=!0,this.phoneLabel.verticalAlign=egret.VerticalAlign.MIDDLE,this.phoneLabel.textAlign=egret.HorizontalAlign.CENTER,this.phoneLabel.border=!1,this.initPhoneLabelY=this.phoneLabel.y,this.stageHeight=GameConst.stage.stageHeight,this.contentGroup.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onContentGroupBegin,this),this.contentGroup.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onContentGroupMove,this),window.submitScene=this},n.onEnable=function(){this.phoneLabel.prompt="请输入手机号",this.submitBtn.visible=!0,this.successBtn.visible=!1,this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this)},n.onRemove=function(){},n.onContentGroupBegin=function(t){this.beginY=t.stageY},n.onContentGroupMove=function(t){this.endY=this.contentGroup.y+t.stageY-this.beginY,this.endY<this.stageHeight-this.contentGroup.height?this.contentGroup.y=this.stageHeight-this.contentGroup.height:this.endY>0?this.contentGroup.y=0:this.contentGroup.y=this.endY},n.onSubmitBtnTouch=function(){var t=/^1\d{10}$/,e=t.test(this.phoneLabel.text);if(0==e)return void alert("手机号码不正确");this.submitBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this);var i={couponnumber:"81682F81D828C180",mobile:this.phoneLabel.text};window.submit(i)},n.onResult=function(t){1==t?(this.submitBtn.visible=!1,this.successBtn.visible=!0,egret.Tween.get(this).wait(2e3).call(function(){window.location.href="http://m.meitun.com/download.html?tcode=sdtgsp1212"})):this.submitBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSubmitBtnTouch,this)},e}(BaseScene);egret.registerClass(SubmitScene,"SubmitScene");var BaseFoot=function(t){function e(){t.call(this)}__extends(e,t);var i=(__define,e),n=i.prototype;return n.recycle=function(){},e}(egret.Bitmap);egret.registerClass(BaseFoot,"BaseFoot");var LeftFoot=function(t){function e(){t.call(this),this.bitmapData=RES.getRes("game_foot0_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.touchEnabled=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.recycle=function(){ObjectPool.getPool(e.NAME).returnObject(this)},e.NAME="LeftFoot",e}(BaseFoot);egret.registerClass(LeftFoot,"LeftFoot");var RightFoot=function(t){function e(){t.call(this),this.bitmapData=RES.getRes("game_foot1_png"),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.touchEnabled=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.recycle=function(){ObjectPool.getPool(e.NAME).returnObject(this)},e.NAME="RightFoot",e}(BaseFoot);egret.registerClass(RightFoot,"RightFoot");var Main=function(t){function e(){t.apply(this,arguments),this.isThemeLoadEnd=!1,this.isPreloadEnd=!1}__extends(e,t);var i=(__define,e),n=i.prototype;return n.createChildren=function(){t.prototype.createChildren.call(this);var e=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",e),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},n.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.loadGameResource()},n.onPreloadComplete=function(t){this.isPreloadEnd=!0,this.loadGameResource()},n.loadGameResource=function(){this.isThemeLoadEnd&&this.isPreloadEnd&&(this.preloadScene=new PreloadScene,this.addChild(this.preloadScene),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onGameResourceComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onGameResourceError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onGameResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("game"))},n.onGameResourceError=function(t){alert("error:"+t.itemsLoaded+","+t.resItem)},n.onItemLoadError=function(t){alert("item error:"+t.itemsLoaded)},n.onGameResourceProgress=function(t){this.preloadScene.setProcessLabel(Math.round(t.itemsLoaded/t.itemsTotal*100))},n.onGameResourceComplete=function(t){this.removeChild(this.preloadScene),GameManager.getInstance().startup(this)},e}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function t(){}var e=(__define,t),i=e.prototype;return i.getTheme=function(t,e,i,n){function s(t){e.call(n,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),i.call(n))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT)},t}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);