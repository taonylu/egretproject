var AssetAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getAsset=function(e,t,n){function i(i){t.call(n,i,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?i(s):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var BaseScene=function(e){function t(t){e.call(this),this.inited=!1,this.percentWidth=100,this.percentHeight=100,this.touchEnabled=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},i.onEnable=function(){},i.onRemove=function(){},i.onDestroy=function(){},t}(eui.Component);egret.registerClass(BaseScene,"BaseScene");var BaseUI=function(e){function t(t){e.call(this),this.inited=!1,this.addEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.skinName=t}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.componentCreated,this),this.inited=!0},t}(eui.Component);egret.registerClass(BaseUI,"BaseUI");var LayerManager=function(){function e(){this.tweenTime=500}var t=(__define,e),n=t.prototype;return n.initialize=function(e){this.main=e,this.sceneLayer=new eui.Group,this.sceneLayer.percentWidth=100,this.sceneLayer.percentHeight=100,this.main.addChild(this.sceneLayer),this.popLayer=new eui.Group,this.popLayer.percentWidth=100,this.popLayer.percentHeight=100,this.popLayer.touchEnabled=!1,this.main.addChild(this.popLayer)},n.runScene=function(e,t){void 0===t&&(t=!1),this.sceneLayer.addChild(e),e.inited&&e.onEnable(),null!=this.curScene&&this.curScene&&(this.sceneLayer.removeChild(this.curScene),this.curScene.onRemove(),t&&this.curScene.onDestroy()),this.curScene=e},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(LayerManager,"LayerManager");var LoadManager=function(){function e(){this.loadComplete=new Object,this.loadError=new Object,this.loadProgress=new Object,this.thisObject=new Object}var t=(__define,e),n=t.prototype;return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},n.loadGroup=function(e,t,n,i,s){void 0===n&&(n=null),void 0===i&&(i=null),void 0===s&&(s=null),this.loadComplete[e]=n,this.loadError[e]=s,this.loadProgress[e]=i,this.thisObject[e]=t,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup(e)},n.onResourceLoadComplete=function(e){var t=e.groupName;RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var n=this.loadComplete[t];null!=n&&n.call(this.thisObject[t],e),this.clearCallBack(t)},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load");var t=this.loadError[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e),this.clearCallBack(e.groupName)},n.onResourceProgress=function(e){var t=this.loadProgress[e.groupName];null!=t&&t.call(this.thisObject[e.groupName],e)},n.clearCallBack=function(e){this.loadComplete[e]=null,this.loadError[e]=null,this.loadProgress[e]=null},e}();egret.registerClass(LoadManager,"LoadManager");var ObjectPool=function(){function e(e){this.className=e,this.list=[]}var t=(__define,e),n=t.prototype;return n.getObject=function(){if(this.list.length>0)return this.list.shift();var e=egret.getDefinitionByName(this.className);return new e},n.returnObject=function(e){this.list.push(e)},e.getPool=function(t,n){if(void 0===n&&(n=0),!e.pool[t]&&(e.pool[t]=new e(t),0!=n))for(var i=egret.getDefinitionByName(t),s=e.pool[t],o=0;n>o;o++)s.returnObject(new i);return e.pool[t]},e.pool={},e}();egret.registerClass(ObjectPool,"ObjectPool");var GameConst=function(){function e(){}var t=(__define,e);t.prototype;return e}();egret.registerClass(GameConst,"GameConst");var GameManager=function(){function e(){this.homeScene=new HomeScene,this.gameScene=new GameScene}var t=(__define,e),n=t.prototype;return n.startup=function(e){GameConst.stage=e.stage,LayerManager.getInstance().initialize(e),LayerManager.getInstance().runScene(this.homeScene)},e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e}();egret.registerClass(GameManager,"GameManager");var GameScene=function(e){function t(){e.call(this,"GameSceneSkin"),this.totalMoney=0,this.moneyValue=100,this.timeLimit=3,this.resultUI=new ResultUI,this.isDrag=!1}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),this.initFallMoney(),this.initCountMoney()},i.onEnable=function(){this.startGame()},i.onRemove=function(){},i.startGame=function(){this.resetGame(),this.addEventListener(egret.TouchEvent.ENTER_FRAME,this.onFallMoney,this),this.staticMoney.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.resetGame=function(){this.resetAllFallMoney(),this.setTimeLabel(this.timeLimit.toString()),this.totalMoney=0,this.setMoneyLabel(this.totalMoney.toString())},i.gameOver=function(){this.stopTimer(),this.staticMoney.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.resultUI.showInScene(this,this.totalMoney)},i.onTouchBegin=function(e){this.beginY=e.stageY,this.isDrag=!0,this.curCountMoney=this.countMoneyList.pop(),this.curCountMoney.x=this.staticMoney.x,this.curCountMoney.y=this.staticMoney.y,this.addChild(this.curCountMoney)},i.onTouchMove=function(e){this.isDrag&&this.curCountMoney&&(this.curCountMoney.y+=e.stageY-this.beginY,this.beginY=e.stageY)},i.onTouchEnd=function(e){if(this.isDrag&&this.curCountMoney&&Math.abs(this.curCountMoney.y-this.staticMoney.y)>10){var t=this.curCountMoney.y/this.staticMoney.y*200,n=this.curCountMoney;this.curCountMoney=null;var i=this;egret.Tween.get(n).to({y:-n.height},t).call(function(){i.countMoneyList.push(n)}),this.totalMoney+=this.moneyValue,this.setMoneyLabel(this.totalMoney.toString()),this.totalMoney==this.moneyValue&&this.startTimer()}this.isDrag=!1},i.initCountMoney=function(){this.countMoneyList=new Array;for(var e,t=0;10>t;t++)e=new egret.Bitmap(RES.getRes("m0_png")),this.countMoneyList.push(e)},i.initFallMoney=function(){this.fallMoneyList=new Array;for(var e,t=0;3>t;t++)e=new egret.Bitmap(RES.getRes("d0_png")),e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,this.fallMoneyList.push(e),this.resetFallMoneyPos(e),this.fallMoneyGroup.addChild(e);this.fallEdge=GameConst.stage.stageHeight+e.height},i.onFallMoney=function(){for(var e,t=this.fallMoneyList.length,n=0;t>n;n++)e=this.fallMoneyList[n],e.rotation+=10,e.y+=20,e.y>=this.fallEdge&&this.resetFallMoneyPos(e)},i.resetFallMoneyPos=function(e){e.y=-e.height-600*Math.random(),e.x=640*Math.random()},i.resetAllFallMoney=function(){for(var e=this.fallMoneyList.length,t=0;e>t;t++)this.resetFallMoneyPos(this.fallMoneyList[t])},i.setMoneyLabel=function(e){this.moneyLabel.text=e},i.setTimeLabel=function(e){this.timeLabel.text=e},i.startTimer=function(){null==this.gameTimer&&(this.gameTimer=new egret.Timer(800)),this.gameTimer.addEventListener(egret.TimerEvent.TIMER,this.onGameTimer,this),this.gameTimer.reset(),this.gameTimer.start()},i.onGameTimer=function(){var e=this.timeLimit-this.gameTimer.currentCount;this.setTimeLabel(e.toString()),0>=e&&this.gameOver()},i.stopTimer=function(){null!=this.gameTimer&&this.gameTimer.removeEventListener(egret.TimerEvent.TIMER,this.onGameTimer,this)},t}(BaseScene);egret.registerClass(GameScene,"GameScene");var HomeScene=function(e){function t(){e.call(this,"HomeSceneSkin"),this.isDrag=!1}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this),this.initMoneyPosY=this.money.y},i.onEnable=function(){this.money.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.onRemove=function(){this.money.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.onTouchBegin=function(e){this.isDrag=!0,this.beginY=e.stageY},i.onTouchMove=function(e){this.isDrag&&(this.money.y+=e.stageY-this.beginY,this.beginY=e.stageY)},i.onTouchEnd=function(e){if(this.isDrag&&Math.abs(this.money.y-this.initMoneyPosY)>10){var t=this.money.y/this.initMoneyPosY*200;egret.Tween.get(this.money).to({y:-this.money.height},t).call(function(){LayerManager.getInstance().runScene(GameManager.getInstance().gameScene)})}},t}(BaseScene);egret.registerClass(HomeScene,"HomeScene");var ResultUI=function(e){function t(){e.call(this,"ResultUISkin")}__extends(t,e);var n=(__define,t),i=n.prototype;return i.componentCreated=function(){e.prototype.componentCreated.call(this)},i.showInScene=function(e,t){this.y=(GameConst.stage.stageHeight-this.height)/2,e.addChild(this),this.setResultLabel(t),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartBtnTouch,this),this.rankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRankBtnTouch,this),this.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this)},i.hide=function(){this.parent&&this.parent.removeChild(this),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartBtnTouch,this),this.rankBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRankBtnTouch,this),this.shareBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShareBtnTouch,this)},i.onStartBtnTouch=function(){this.hide(),GameManager.getInstance().gameScene.startGame()},i.onRankBtnTouch=function(){},i.onShareBtnTouch=function(){},i.setResultLabel=function(e){this.resultLabel.text="获得了xxxxx，超过了xxxx"},t}(BaseUI);egret.registerClass(ResultUI,"ResultUI");var Main=function(e){function t(){e.apply(this,arguments)}__extends(t,e);var n=(__define,t),i=n.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this)},i.onThemeLoadComplete=function(){LoadManager.getInstance().loadGroup("preload",this,this.onPreloadComplete)},i.onPreloadComplete=function(e){GameManager.getInstance().startup(this)},i.onGameProgress=function(e){},i.onGameComplete=function(e){},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),n=t.prototype;return n.getTheme=function(e,t,n,i){function s(e){t.call(i,e)}function o(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);